<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Design of Experiments | industRial data science</title>
  <meta name="description" content="Design of Experiments | industRial data science" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Design of Experiments | industRial data science" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/img/cover3.png" />
  
  <meta name="github-repo" content="J-Ramalho/industRialds" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Design of Experiments | industRial data science" />
  
  
  <meta name="twitter:image" content="/img/cover3.png" />

<meta name="author" content="João Ramalho" />


<meta name="date" content="2021-05-31" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="MSA.html"/>
<link rel="next" href="SPC.html"/>
<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-122820355-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-122820355-1');
</script>


<script type="text/javascript">
mattcrump=1;
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/industRialds.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">industRial data science</a></li>

<li class="divider"></li>
<li class="part"><span><b>I INTRODUCTION</b></span></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html"><i class="fa fa-check"></i>Toolbox</a>
<ul>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html#r-and-rstudio"><i class="fa fa-check"></i>R and RStudio</a></li>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html#packages"><i class="fa fa-check"></i>Packages</a>
<ul>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html#installation"><i class="fa fa-check"></i>Installation</a></li>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html#highlights"><i class="fa fa-check"></i>Highlights</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html#datasets"><i class="fa fa-check"></i>Datasets</a></li>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html#functions"><i class="fa fa-check"></i>Functions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tutorials.html"><a href="tutorials.html"><i class="fa fa-check"></i>Tutorials</a>
<ul>
<li class="chapter" data-level="" data-path="tutorials.html"><a href="tutorials.html#on-the-web"><i class="fa fa-check"></i>On the web</a></li>
<li class="chapter" data-level="" data-path="tutorials.html"><a href="tutorials.html#locally"><i class="fa fa-check"></i>Locally</a></li>
</ul></li>
<li class="part"><span><b>II CASE STUDIES</b></span></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html"><i class="fa fa-check"></i>Design for Six Sigma</a>
<ul>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#pareto"><i class="fa fa-check"></i>Pareto</a>
<ul>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#collecting-defects"><i class="fa fa-check"></i>Collecting defects</a></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#paretochart"><i class="fa fa-check"></i>Pareto chart</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#ishikawa"><i class="fa fa-check"></i>Ishikawa</a>
<ul>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#listing-root-causes"><i class="fa fa-check"></i>Listing root causes</a></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#fishbone"><i class="fa fa-check"></i>Fishbone diagram</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#correlation"><i class="fa fa-check"></i>Correlation</a>
<ul>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#matrix"><i class="fa fa-check"></i>Matrix</a></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#tileplot"><i class="fa fa-check"></i>Tileplot</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#clustering"><i class="fa fa-check"></i>Clustering</a>
<ul>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#clustering-algorithms"><i class="fa fa-check"></i>Clustering algorithms</a></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#network_plot"><i class="fa fa-check"></i>Network plot</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html"><i class="fa fa-check"></i>Measurement System Analysis</a>
<ul>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#calibration"><i class="fa fa-check"></i>Calibration</a>
<ul>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#bias_plot"><i class="fa fa-check"></i>Bias plot</a></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#bias_report"><i class="fa fa-check"></i>Bias report</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#precision"><i class="fa fa-check"></i>Precision</a>
<ul>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#gageRnR"><i class="fa fa-check"></i>Gage r&amp;R</a></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#gage_acceptance"><i class="fa fa-check"></i>Gage acceptance</a></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#gage-plots"><i class="fa fa-check"></i>Gage plots</a></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#negative-variance"><i class="fa fa-check"></i>Negative variance</a></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#custom-functions"><i class="fa fa-check"></i>Custom functions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#uncertainty"><i class="fa fa-check"></i>Uncertainty</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html"><i class="fa fa-check"></i>Design of Experiments</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#direct-comparisons"><i class="fa fa-check"></i>Direct comparisons</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#histogram"><i class="fa fa-check"></i>Histogram</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#t.test"><i class="fa fa-check"></i>t-test one sample</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#geom_qq"><i class="fa fa-check"></i>Normality plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#var.test"><i class="fa fa-check"></i>F-test</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#levene.test"><i class="fa fa-check"></i>Levene test</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#t-test-two-samples"><i class="fa fa-check"></i>t-test two samples</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#linear-regression"><i class="fa fa-check"></i>Linear regression</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#lm"><i class="fa fa-check"></i>Linear model</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#contr.treatment"><i class="fa fa-check"></i>Contrasts</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#predict"><i class="fa fa-check"></i>Predict</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#augment"><i class="fa fa-check"></i>Model augment</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#residuals_timeseries"><i class="fa fa-check"></i>Timeseries plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#autocorrelation"><i class="fa fa-check"></i>Autocorrelation test</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#normality-plot"><i class="fa fa-check"></i>Normality plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#shapiroTest"><i class="fa fa-check"></i>Normality test</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#residuals_fit"><i class="fa fa-check"></i>Residuals-Fit plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#homocedasticity"><i class="fa fa-check"></i>Homocedasticity</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#std_residuals_fit"><i class="fa fa-check"></i>Standard Residuals-Fit plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#outliers"><i class="fa fa-check"></i>Outliers test</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#cooks"><i class="fa fa-check"></i>Cooks distance</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#R-squared"><i class="fa fa-check"></i>R-squared</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#anova-ancova"><i class="fa fa-check"></i>Anova &amp; Ancova</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#aov"><i class="fa fa-check"></i>Aov</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#tukey"><i class="fa fa-check"></i>Pairwise comparison</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#fisherLSD"><i class="fa fa-check"></i>Least significant difference</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#formula"><i class="fa fa-check"></i>Model formulae</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#interaction.plot"><i class="fa fa-check"></i>Interaction plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#simple_timeseries"><i class="fa fa-check"></i>Simplified timeseries</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#plot_model"><i class="fa fa-check"></i>Residuals summary</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#cooks_histogram"><i class="fa fa-check"></i>Cooks histogram</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#anova"><i class="fa fa-check"></i>Anova check</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#covariance"><i class="fa fa-check"></i>Covariance</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#cor.test"><i class="fa fa-check"></i>Correlation test</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#ancova"><i class="fa fa-check"></i>Ancova</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#general-designs"><i class="fa fa-check"></i>General designs</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#fac.design"><i class="fa fa-check"></i>Factorial design</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#main_effects"><i class="fa fa-check"></i>Main effects plots</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#interaction_plot"><i class="fa fa-check"></i>Interaction plots (custom)</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#anova_three"><i class="fa fa-check"></i>Anova with 3rd level interactions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#two-level-designs"><i class="fa fa-check"></i>Two level designs</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#coding_levels"><i class="fa fa-check"></i>Coding levels</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#plotMeans"><i class="fa fa-check"></i>Interaction plots with SE</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#adj_Rsquare"><i class="fa fa-check"></i>Adjusted R-squared</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#coding_inputs"><i class="fa fa-check"></i>Coding inputs</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#coded_prediction"><i class="fa fa-check"></i>Coded prediction</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#persp"><i class="fa fa-check"></i>Perspective plot</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#single-replicate-designs"><i class="fa fa-check"></i>Single replicate designs</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#qqPlot"><i class="fa fa-check"></i>Effects normal plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#effects_contribution"><i class="fa fa-check"></i>Effects contribution table</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html"><i class="fa fa-check"></i>Statistical Process Control</a>
<ul>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#xbar-r-charts"><i class="fa fa-check"></i>xbar-R charts</a>
<ul>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#xbar_chart"><i class="fa fa-check"></i>Mean chart</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#Rchart"><i class="fa fa-check"></i>Range chart</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#limits.xbar"><i class="fa fa-check"></i>Control limits</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#cpk-charts"><i class="fa fa-check"></i>Cpk charts</a>
<ul>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#off_spec"><i class="fa fa-check"></i>Off specification</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#process_Cpk"><i class="fa fa-check"></i>Process Capability</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#sigma_table"><i class="fa fa-check"></i>Sigma conversion table</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#process.capability"><i class="fa fa-check"></i>Capability chart</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#i-mr-charts"><i class="fa fa-check"></i>I-MR charts</a>
<ul>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#process_stats"><i class="fa fa-check"></i>Process statistics</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#chart_I"><i class="fa fa-check"></i>Individual chart</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#chart_IMR"><i class="fa fa-check"></i>Moving range chart</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#chart_Cpk"><i class="fa fa-check"></i>Capability chart (custom)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III APPENDIX</b></span></li>
<li class="chapter" data-level="" data-path="contents.html"><a href="contents.html"><i class="fa fa-check"></i>Index</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html"><i class="fa fa-check"></i>Glossary</a>
<ul>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#statistics"><i class="fa fa-check"></i>Statistics</a>
<ul>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#notation-conventions"><i class="fa fa-check"></i>Notation conventions</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#descriptive-statistics"><i class="fa fa-check"></i>Descriptive statistics</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#probability"><i class="fa fa-check"></i>Probability</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#statistical-inference"><i class="fa fa-check"></i>Statistical Inference</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#dfss"><i class="fa fa-check"></i>DFSS</a>
<ul>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#voice-of-customer"><i class="fa fa-check"></i>Voice of Customer</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#voice-of-process"><i class="fa fa-check"></i>Voice of Process</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#msa"><i class="fa fa-check"></i>MSA</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#doe"><i class="fa fa-check"></i>DOE</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#spc"><i class="fa fa-check"></i>SPC</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="" data-path="imprint.html"><a href="imprint.html"><i class="fa fa-check"></i>Imprint</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">indust<b style='color:#38598CFF'>R</b>ial data science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="DOE" class="section level1">
<h1>Design of Experiments</h1>
<p>Companies manufacturing goods in industrial quantities have a permanent need to improve the features of their products. This is visible in any such industry be it car parts, watches, electronic components for cell phones, chocolates, clothing, medical devices, medicine, … the list could go on forever. As consumers we expect flawless quality at affordable price and we want to remain free to choose another brand if our confidence has been damaged due to a defective product. Adding to this fortunately the last decades have seen an increasing pressure to develop sustainable products that are responsibly sourced, meet stringent regulations and can last for many years and be properly disposable. Another constraint that can be observed in Research and Development is the growing awareness of the public on ethical issues. There is an increasing expectation that trials generate minimal waste and are done in a way respectful of test subjects human and animal.</p>
<p>Experiment design provides ways to meet these important requirements by making us think upfront on what is required and how to best approach a test. Integrated in a complete solid design for quality approach it can provide deep insights on the principles of a system and support decision making based on data. A well prepared test plan minimizes trial and error and reduces the number of prototypes, measurements and time required.</p>
<p>There are many well tested approaches, the domain is very large and our textbook can only cover a subset of the many types of DoEs used in the industry. For all these cases statistical notions are key to have a minimal preparation of the test and a valid interpretation of the results. Some statistical concepts every engineer, technician or scientist has to understand go around sampling, sample size, probability, correlation and variability. It is important to be clear about the vocabulary and the mathematics that are behind the constantly used statistics such as the mean, median, variance, standard deviation and so on. We provide a glossary and good bibliography that can be both a good starting point or a refresher. In particular the text and the case studies follow what we consider to be the most important book in this the domain, the <em>Design and Analysis of Experiments</em> by <span class="citation"><a href="#ref-Montgomery2012" role="doc-biblioref">Montgomery</a> (<a href="#ref-Montgomery2012" role="doc-biblioref">2012</a>)</span>.</p>
<div id="direct-comparisons" class="section level2">
<h2>Direct comparisons</h2>
<div class="marginnote">
<p><b class="highlight">Winter Sports clothing manufacture</b></p>
<p>All winter sports clothing are virtually made with a mix of natural fibers and synthetic polymers. Upgrading to recyclable polymers while keeping performance requires extensive testing of raw material characteristics such as the tensile strength.</p>
<p><img src="img/tensile_test_bw.jpg" width="100%" /></p>
</div>
<p>We start by exploring simple tests that compare results obtained in two samples. These cases happen all the time as everyone needs one moment or another to compare things. It can be the result of a test before and after an improvement, it can be two different materials applied in the same assembly or still different results obtained by different teams at different moments.</p>
<p>In this case, a materials engineer working in the <b class="highlight">winter sports clothing industry</b> is working with a polymer company to develop a textile raw material based on PET for which the mean tensile strength has to be greater than 69.0 MPa. A first delivery of samples arrives, the materials laboratory measures 28 samples and reports that the test result is not meeting the contract specification. The materials engineer is informed and get hold of the raw data, in the lab system she can see the measurement summary:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="DOE.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pet_delivery<span class="sc">$</span>A)</span></code></pre></div>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   64.5    68.2    68.8    68.7    69.4    72.0 </code></pre>
<p>The mean is in fact slightly lower that the specified contract value of 69 and the materials engineer could think to confirm the rejection the batch right away. She decides nevertheless to observe how do the measurements vary. She plots the raw data on an histogram which is a very common plot showing counts for selected intervals.</p>
<div id="histogram" class="section level3">
<h3>Histogram</h3>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="DOE.html#cb77-1" aria-hidden="true" tabindex="-1"></a>pet_spec <span class="ot">&lt;-</span> <span class="dv">69</span></span>
<span id="cb77-2"><a href="DOE.html#cb77-2" aria-hidden="true" tabindex="-1"></a>pet_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(pet_delivery<span class="sc">$</span>A)</span>
<span id="cb77-3"><a href="DOE.html#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="DOE.html#cb77-4" aria-hidden="true" tabindex="-1"></a>pet_delivery <span class="sc">%&gt;%</span> </span>
<span id="cb77-5"><a href="DOE.html#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> A)) <span class="sc">+</span></span>
<span id="cb77-6"><a href="DOE.html#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="fu">viridis</span>(<span class="dv">12</span>)[<span class="dv">4</span>], <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>) <span class="sc">+</span></span>
<span id="cb77-7"><a href="DOE.html#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb77-8"><a href="DOE.html#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> pet_mean, <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb77-9"><a href="DOE.html#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> pet_spec, <span class="at">color =</span> <span class="st">&quot;darkred&quot;</span>, <span class="at">linetype =</span> <span class="dv">2</span>, </span>
<span id="cb77-10"><a href="DOE.html#cb77-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb77-11"><a href="DOE.html#cb77-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;PET raw material delivery&quot;</span>,</span>
<span id="cb77-12"><a href="DOE.html#cb77-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Histogram of resistance measurements&quot;</span>,</span>
<span id="cb77-13"><a href="DOE.html#cb77-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Count&quot;</span>,</span>
<span id="cb77-14"><a href="DOE.html#cb77-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Tensile strength [MPa]&quot;</span>, </span>
<span id="cb77-15"><a href="DOE.html#cb77-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Specification min in red, Batch mean in blue¨&quot;</span>)</span></code></pre></div>
<p><img src="5_comparisons_files/figure-html/fig-pethistogram-1.png" width="100%" /></p>
<p>She also observes a certain variability in the batch with many samples with measurements below specification getting close to 64 MPa. She remembers that in this case a t-test could help assessing if the mean that was obtained can be really be considered statistically different from the target value.</p>
</div>
<div id="t.test" class="section level3">
<h3>t-test one sample</h3>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="DOE.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(<span class="at">x =</span> pet_delivery<span class="sc">$</span>A, <span class="at">mu =</span> pet_spec)</span></code></pre></div>
<pre><code>
    One Sample t-test

data:  pet_delivery$A
t = -1.08, df = 27, p-value = 0.29
alternative hypothesis: true mean is not equal to 69
95 percent confidence interval:
 68.157 69.263
sample estimates:
mean of x 
    68.71 </code></pre>
<p>The basic assumption of the test is that the mean and the reference value are identical and the alternative hypothesis is that their different. The confidence interval selected is 95% as it is common practice in the laboratory. The test result tells us that for a population average of 69, the probability of obtaining a sample with a value as extreme as 68.71 is 29% (p = 0.29). This probability value higher than the limit of 5% that she usually uses to reject the null hypothesis. In fact she cannot conclude that the sample comes from a population with a mean different than 69.</p>
<p>She’s not sure what to do of this result and decides asking help to a colleague statistician from R&amp;D: has she applied the right? is the specification correctly defined or should it refer to the minimum sample value? Her colleague confirms that to compare means this is a good approach and as the standard deviation of the production is not available it is reasonable to use the standard deviation from the sample. This is an important detail that was not introduced explicitely as an argument in the R function. As we they are still in the initial steps of the new development they agree that it is a good idea to accept the batch. For the next deliveries the statistic recommends to try to improve the tensile strength average and reduce the variability. For the next delivery she also recommends to agree on a minimum sample size of 30 parts and to redo the t.test but for regular production the team should consider implementing a proper AQL protocol.</p>
<p>Improving recyclability while keeping current performance is no easy task. Often novel materials are expensive as their commercial volumes are small and suppliers claim a premium on their own R&amp;D efforts. Consumers of clothing are getting more and more sensitive to waste and to recycling but they don’t always choose products with a higher price to compensate.</p>
<p>Following the not fully successful experience with the first delivery of recyclable PET our materials engineer considers a new chemical composition that potentially increases the levels of strength. When the second delivery arrives she establishes a simple plot with the raw data to have a first grasp of the expected improvement.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="DOE.html#cb80-1" aria-hidden="true" tabindex="-1"></a>pet_delivery_long <span class="ot">&lt;-</span> pet_delivery <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="DOE.html#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb80-3"><a href="DOE.html#cb80-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;sample&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;tensile_strength&quot;</span></span>
<span id="cb80-4"><a href="DOE.html#cb80-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-5"><a href="DOE.html#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="DOE.html#cb80-6" aria-hidden="true" tabindex="-1"></a>pet_delivery_long <span class="sc">%&gt;%</span> </span>
<span id="cb80-7"><a href="DOE.html#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sample, <span class="at">y =</span> tensile_strength)) <span class="sc">+</span></span>
<span id="cb80-8"><a href="DOE.html#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb80-9"><a href="DOE.html#cb80-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb80-10"><a href="DOE.html#cb80-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;PET clothing case study&quot;</span>,</span>
<span id="cb80-11"><a href="DOE.html#cb80-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Raw data plot&quot;</span>,</span>
<span id="cb80-12"><a href="DOE.html#cb80-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Sample&quot;</span>,</span>
<span id="cb80-13"><a href="DOE.html#cb80-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Tensile strength [MPa]&quot;</span>)</span></code></pre></div>
<p><img src="5_comparisons_files/figure-html/fig-PETjitterplot-1.png" width="100%" /></p>
<p>Choosing <code>geom_jitter()</code> instead of simply <code>geom_point()</code> avoids overlapping of the dots but has to used with caution as sometimes for precise reading can lead to mistakes. Dot plots also lack information sample statistics and a way to better understanding the bond distributions is to go for a box plot. This type of plot is somehow like the histogram seen before but more compact when several groups are required to be plotted.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="DOE.html#cb81-1" aria-hidden="true" tabindex="-1"></a>pet_delivery_long <span class="sc">%&gt;%</span> </span>
<span id="cb81-2"><a href="DOE.html#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sample, <span class="at">y =</span> tensile_strength, <span class="at">fill =</span> sample)) <span class="sc">+</span></span>
<span id="cb81-3"><a href="DOE.html#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb81-4"><a href="DOE.html#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb81-5"><a href="DOE.html#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">begin =</span> <span class="fl">0.5</span>, <span class="at">end =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb81-6"><a href="DOE.html#cb81-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb81-7"><a href="DOE.html#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb81-8"><a href="DOE.html#cb81-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;PET clothing case study&quot;</span>,</span>
<span id="cb81-9"><a href="DOE.html#cb81-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Box plot&quot;</span>,</span>
<span id="cb81-10"><a href="DOE.html#cb81-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Sample&quot;</span>,</span>
<span id="cb81-11"><a href="DOE.html#cb81-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Tensile strength [MPa]&quot;</span>)</span></code></pre></div>
<p><img src="5_comparisons_files/figure-html/fig-PETboxplot-1.png" width="100%" /></p>
<p>In this case she has simply added another layer to the previous plot getting both the dots and the boxes. Now she can see the median and the quantiles. The new sample has clearly higher values and she would like to confirm if the new formulation has a significant effect. While before she was comparing the sample mean with the specification, here she wants to compare the means of the two samples. A direct calculation of this difference gives:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="DOE.html#cb82-1" aria-hidden="true" tabindex="-1"></a>PET_meandiff <span class="ot">&lt;-</span> <span class="fu">mean</span>(pet_delivery<span class="sc">$</span>A) <span class="sc">-</span> <span class="fu">mean</span>(pet_delivery<span class="sc">$</span>B)</span>
<span id="cb82-2"><a href="DOE.html#cb82-2" aria-hidden="true" tabindex="-1"></a>PET_meandiff</span></code></pre></div>
<pre><code>[1] -0.86286</code></pre>
<p>To use the t.test it is important to have samples obtained independently and randomly, to check the normality of their distributions and the equality of their variances.</p>
<p>To do these checks our materials engineer is using the <code>geom_qq()</code> function from the <code>{ggplot}</code> package and gets directly the normality plots for both samples in the same plot:</p>
</div>
<div id="geom_qq" class="section level3">
<h3>Normality plot</h3>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="DOE.html#cb84-1" aria-hidden="true" tabindex="-1"></a>pet_delivery_long <span class="sc">%&gt;%</span></span>
<span id="cb84-2"><a href="DOE.html#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">sample =</span> tensile_strength, <span class="at">color =</span> sample)) <span class="sc">+</span></span>
<span id="cb84-3"><a href="DOE.html#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>() <span class="sc">+</span></span>
<span id="cb84-4"><a href="DOE.html#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq_line</span>() <span class="sc">+</span></span>
<span id="cb84-5"><a href="DOE.html#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb84-6"><a href="DOE.html#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">begin =</span> <span class="fl">0.1</span>, <span class="at">end =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb84-7"><a href="DOE.html#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;PET clothing case study&quot;</span>,</span>
<span id="cb84-8"><a href="DOE.html#cb84-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Q-Q plot&quot;</span>,</span>
<span id="cb84-9"><a href="DOE.html#cb84-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Residuals&quot;</span>,</span>
<span id="cb84-10"><a href="DOE.html#cb84-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Tensile strength [MPa]&quot;</span>)</span></code></pre></div>
<p><img src="5_comparisons_files/figure-html/fit-PETqqplot-1.png" width="100%" /></p>
<p>We observe that for both formulation the data is adhering to the straight line thus we consider that it follows a normal distribution. We also see that both lines in the qq plot have equivalent slopes indicating that the assumption of variances is a reasonable one. Visual observations are often better supported by tests such as the variance test.</p>
</div>
<div id="var.test" class="section level3">
<h3>F-test</h3>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="DOE.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var.test</span>(tensile_strength <span class="sc">~</span> sample, pet_delivery_long)</span></code></pre></div>
<pre><code>
    F test to compare two variances

data:  tensile_strength by sample
F = 1.28, num df = 27, denom df = 27, p-value = 0.53
alternative hypothesis: true ratio of variances is not equal to 1
95 percent confidence interval:
 0.59026 2.75635
sample estimates:
ratio of variances 
            1.2755 </code></pre>
<p>The <code>var.test()</code> from the <code>{stats}</code> package us a simple and direct way to compare variances. The F-test is accurate only for normally distributed data. Any small deviation from normality can cause the F-test to be inaccurate, even with large samples. However, if the data conform well to the normal distribution, then the F-test is usually more powerful than Levene’s test. The test null hypothesis is that the variances are equal. Since the p value is much greater than 0.05 we cannot reject the null hypotheses meaning that we can consider them equal.</p>
</div>
<div id="levene.test" class="section level3">
<h3>Levene test</h3>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="DOE.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb87-2"><a href="DOE.html#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">leveneTest</span>(tensile_strength <span class="sc">~</span> sample, <span class="at">data =</span> pet_delivery_long)</span></code></pre></div>
<pre><code>Levene&#39;s Test for Homogeneity of Variance (center = median)
      Df F value Pr(&gt;F)
group  1    0.01   0.91
      54               </code></pre>
<p>We had considered the samples to be normaly distributed but we can be more conservative and use the <code>leveneTest()</code> function from the <code>{car}</code> package. In this case we get a p &gt; 0.05 thus again we see that there is homogeneity of the variances (they do not differ significantly). Further elaborations on the variance can be found under <span class="citation"><a href="#ref-minitab_variances" role="doc-biblioref">Minitab</a> (<a href="#ref-minitab_variances" role="doc-biblioref">2019a</a>)</span>.</p>
<p>The clothing sports materials engineer has now a view on the samples distribution and homogeity of variances and can apply t.test to compare the sample means. She takes care to specify the <code>var.equal</code> argument as TRUE (by default it is FALSE).</p>
</div>
<div id="t-test-two-samples" class="section level3">
<h3>t-test two samples</h3>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="DOE.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(</span>
<span id="cb89-2"><a href="DOE.html#cb89-2" aria-hidden="true" tabindex="-1"></a>  tensile_strength <span class="sc">~</span> sample, </span>
<span id="cb89-3"><a href="DOE.html#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> pet_delivery_long, <span class="at">var.equal =</span> <span class="cn">TRUE</span></span>
<span id="cb89-4"><a href="DOE.html#cb89-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>
    Two Sample t-test

data:  tensile_strength by sample
t = -2.4, df = 54, p-value = 0.02
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -1.58500 -0.14072
sample estimates:
mean in group A mean in group B 
         68.710          69.573 </code></pre>
<p>She sees that p &lt; 0.05 and confirms the means differ significantly. The test output has also provided a confidence interval for the difference between the means at 95% probability and the mean difference calculated directly of -0.86286 falls inside this interval (to be noted that zero is obviously not included in this interval). Things look promising in the new recyclable PET formulation.</p>

</div>
</div>
<div id="linear-regression" class="section level2">
<h2>Linear regression</h2>
<div class="marginnote">
<p><b class="highlight">Case study: e-bike frame hardening</b></p>
<p>Demand for electrical bicycles grows steadily and a global manufacturer is looking into improving the quality of his bicycle frames. A test program around different treatment temperatures is established to find the conditions that optimize the fatigue resistance.</p>
<p><img src="img/bike_frames_bw.jpg" width="80%" style="display: block; margin: auto;" /></p>
</div>
<p>A way to go beyond the statistical description of samples and direct comparison between different tests it is to establish a model. Models help us simplify the reality and draw general conclusions. The case studies in this unit introduce linear models and their applications. They also serve as the backbone for statistical inference and forecasting. These are two important techniques because they provide mathematical evidence of such general conclusions in a context where the test quantities are strongly limited as for example in lifecycle testing of expensive mechanical parts.</p>
<p>Mountain bikes frames are submitted to many different efforts, namely bending, compression and vibration. Obviously no one expects a bike frame to break in regular usage and it is hard to commercialy claim resistance to failure as a big thing. Nevertheless on the long term a manufacturer reputation is made on performance features such as the number of cycles of effort that the frame resists. An e-bike manufacturing company is looking to increase the duration of its frames by improving the <b class="highlight">e-bike frame hardening</b> process.</p>
<p>A test has been run with 5 groups of 30 bike frames submitted to 4 different treatment temperature levels and the data collected in the R tibble <code>ebike_hardening</code> presented below:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="DOE.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ebike_hardening) <span class="sc">%&gt;%</span></span>
<span id="cb91-2"><a href="DOE.html#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="center">temperature</th>
<th align="center">g1</th>
<th align="center">g2</th>
<th align="center">g3</th>
<th align="center">g4</th>
<th align="center">g5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">160</td>
<td align="center">575000</td>
<td align="center">542000</td>
<td align="center">530000</td>
<td align="center">539000</td>
<td align="center">570000</td>
</tr>
<tr class="even">
<td align="center">180</td>
<td align="center">565000</td>
<td align="center">593000</td>
<td align="center">590000</td>
<td align="center">579000</td>
<td align="center">610000</td>
</tr>
<tr class="odd">
<td align="center">200</td>
<td align="center">600000</td>
<td align="center">651000</td>
<td align="center">610000</td>
<td align="center">637000</td>
<td align="center">629000</td>
</tr>
<tr class="even">
<td align="center">220</td>
<td align="center">725000</td>
<td align="center">700000</td>
<td align="center">715000</td>
<td align="center">685000</td>
<td align="center">710000</td>
</tr>
</tbody>
</table>
<p>This type of two way entry is friendly for data collection but for manipulation with the <code>{tidyverse}</code> package functions it is often better to transform it in a long format.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="DOE.html#cb92-1" aria-hidden="true" tabindex="-1"></a>ebike_narrow <span class="ot">&lt;-</span> ebike_hardening <span class="sc">%&gt;%</span></span>
<span id="cb92-2"><a href="DOE.html#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb92-3"><a href="DOE.html#cb92-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;g&quot;</span>),</span>
<span id="cb92-4"><a href="DOE.html#cb92-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;observation&quot;</span>,</span>
<span id="cb92-5"><a href="DOE.html#cb92-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;cycles&quot;</span></span>
<span id="cb92-6"><a href="DOE.html#cb92-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb92-7"><a href="DOE.html#cb92-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(temperature) <span class="sc">%&gt;%</span></span>
<span id="cb92-8"><a href="DOE.html#cb92-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cycles_mean =</span> <span class="fu">mean</span>(cycles)) <span class="sc">%&gt;%</span></span>
<span id="cb92-9"><a href="DOE.html#cb92-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb92-10"><a href="DOE.html#cb92-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-11"><a href="DOE.html#cb92-11" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_head</span>(<span class="at">.data =</span> ebike_narrow, <span class="at">n =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb92-12"><a href="DOE.html#cb92-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>, </span>
<span id="cb92-13"><a href="DOE.html#cb92-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;e-bike hardening experiment data&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:fig-ebikenarrow">Table 5: </span>e-bike hardening experiment data</caption>
<thead>
<tr class="header">
<th align="center">temperature</th>
<th align="center">observation</th>
<th align="center">cycles</th>
<th align="center">cycles_mean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">160</td>
<td align="center">g1</td>
<td align="center">575000</td>
<td align="center">551200</td>
</tr>
<tr class="even">
<td align="center">160</td>
<td align="center">g2</td>
<td align="center">542000</td>
<td align="center">551200</td>
</tr>
<tr class="odd">
<td align="center">160</td>
<td align="center">g3</td>
<td align="center">530000</td>
<td align="center">551200</td>
</tr>
<tr class="even">
<td align="center">160</td>
<td align="center">g4</td>
<td align="center">539000</td>
<td align="center">551200</td>
</tr>
<tr class="odd">
<td align="center">160</td>
<td align="center">g5</td>
<td align="center">570000</td>
<td align="center">551200</td>
</tr>
</tbody>
</table>
<p>The engineering team is looking forward to see the first results which have been prepared by the laboratory supervisor. He has prepared a series of plots and data models and sent out an draft report. The first plot is a simple dot plot having the raw data and in red the group means.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="DOE.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ebike_narrow) <span class="sc">+</span></span>
<span id="cb93-2"><a href="DOE.html#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> cycles)) <span class="sc">+</span></span>
<span id="cb93-3"><a href="DOE.html#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> cycles_mean), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb93-4"><a href="DOE.html#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>, <span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">big.mark =</span> <span class="st">&quot;&#39;&quot;</span>)) <span class="sc">+</span></span>
<span id="cb93-5"><a href="DOE.html#cb93-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb93-6"><a href="DOE.html#cb93-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;e-bike frame hardening process&quot;</span>,</span>
<span id="cb93-7"><a href="DOE.html#cb93-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Raw data plot&quot;</span>,</span>
<span id="cb93-8"><a href="DOE.html#cb93-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Furnace Temperature [°C]&quot;</span>,</span>
<span id="cb93-9"><a href="DOE.html#cb93-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Cycles to failure [n]&quot;</span>)</span></code></pre></div>
<p><img src="6_regression_files/figure-html/fig-rawdataplot-1.png" width="100%" /></p>
<p>Clearly the highest the furnace temperature the higher the number of cycles to failure. This is absolutely expected as higher temperatures, up to a certain level, allow to release mechanical tensions and make the material less prone to fracture. The team knows that other factors are at play such as the treatment duration, the pre-heating temperature and many others related with the welding of the frame parts, but has deliberately decided to look only into the temperature due to time constraints related with a new bike launch.</p>
<div id="lm" class="section level3">
<h3>Linear model</h3>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="DOE.html#cb94-1" aria-hidden="true" tabindex="-1"></a>ebike_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(cycles <span class="sc">~</span> temperature, <span class="at">data =</span> ebike_narrow)</span>
<span id="cb94-2"><a href="DOE.html#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ebike_lm)</span></code></pre></div>
<pre><code>
Call:
lm(formula = cycles ~ temperature, data = ebike_narrow)

Residuals:
   Min     1Q Median     3Q    Max 
-43020 -12325  -1210  16710  33060 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   137620      41211    3.34   0.0036 ** 
temperature     2527        215   11.73  7.3e-10 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 21500 on 18 degrees of freedom
Multiple R-squared:  0.884, Adjusted R-squared:  0.878 
F-statistic:  138 on 1 and 18 DF,  p-value: 7.26e-10</code></pre>
<p>This last code chunk in lab supervisor draft report is a linear model built with the variable <code>temperature</code> as a numeric vector. The R <code>summary()</code> function produces a specific output for linear models and a dedicated help explaining each output value can be accessed with <code>?summary.lm</code>. Knowing that R uses specific “methods” to provide the summaries for many functions is useful to find their help pages and a way to list them is <code>apropos("summary)</code>.</p>
<p>In this case we see a high R-squared suggesting a very good fit and that the temperature is significant by looking at the 3 <em>significance stars</em> next to its p-value. It is good to complement the raw data plot with a regression line corresponding to this linear model as done in the next chunk with the function <code>geom_smooth()</code>:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="DOE.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ebike_narrow) <span class="sc">+</span></span>
<span id="cb96-2"><a href="DOE.html#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> cycles)) <span class="sc">+</span></span>
<span id="cb96-3"><a href="DOE.html#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> cycles), <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span></span>
<span id="cb96-4"><a href="DOE.html#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> cycles_mean), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb96-5"><a href="DOE.html#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>, <span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">big.mark =</span> <span class="st">&quot;&#39;&quot;</span>)) <span class="sc">+</span></span>
<span id="cb96-6"><a href="DOE.html#cb96-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb96-7"><a href="DOE.html#cb96-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;e-bike frame hardening process&quot;</span>,</span>
<span id="cb96-8"><a href="DOE.html#cb96-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Raw data plot&quot;</span>,</span>
<span id="cb96-9"><a href="DOE.html#cb96-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Furnace Temperature [°C]&quot;</span>,</span>
<span id="cb96-10"><a href="DOE.html#cb96-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Cycles to failure [n]&quot;</span>)</span></code></pre></div>
<p><img src="6_regression_files/figure-html/fig-ebikesmooth-1.png" width="100%" /></p>
<p>The engineering team has selected to specify and control the temperature variable at specific levels in what is called a fixed effects model, limiting the conclusions to the levels tested. The lab supervisor updates his model by converting the temperature variable to a factor and establishes again the linear model. He explicitly introduces the argument <code>contrasts</code> as cont.treatment to make clear that this was his option. In principle this is not needed because this is default setting for the contrasts as seen with <code>getOption("contrasts")</code>.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="DOE.html#cb97-1" aria-hidden="true" tabindex="-1"></a>ebike_factor <span class="ot">&lt;-</span> ebike_narrow <span class="sc">%&gt;%</span></span>
<span id="cb97-2"><a href="DOE.html#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">temperature =</span> <span class="fu">as_factor</span>(temperature))</span>
<span id="cb97-3"><a href="DOE.html#cb97-3" aria-hidden="true" tabindex="-1"></a>ebike_lm_factor <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb97-4"><a href="DOE.html#cb97-4" aria-hidden="true" tabindex="-1"></a>  cycles <span class="sc">~</span> temperature, </span>
<span id="cb97-5"><a href="DOE.html#cb97-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ebike_factor,</span>
<span id="cb97-6"><a href="DOE.html#cb97-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">contrasts =</span> <span class="fu">list</span>(<span class="at">temperature =</span> <span class="st">&quot;contr.treatment&quot;</span>)</span>
<span id="cb97-7"><a href="DOE.html#cb97-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb97-8"><a href="DOE.html#cb97-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ebike_lm_factor)</span></code></pre></div>
<pre><code>
Call:
lm(formula = cycles ~ temperature, data = ebike_factor, contrasts = list(temperature = &quot;contr.treatment&quot;))

Residuals:
   Min     1Q Median     3Q    Max 
-25400 -13000   2800  13200  25600 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)      551200       8170   67.47  &lt; 2e-16 ***
temperature180    36200      11553    3.13   0.0064 ** 
temperature200    74200      11553    6.42  8.4e-06 ***
temperature220   155800      11553   13.49  3.7e-10 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 18300 on 16 degrees of freedom
Multiple R-squared:  0.926, Adjusted R-squared:  0.912 
F-statistic: 66.8 on 3 and 16 DF,  p-value: 2.88e-09</code></pre>
</div>
<div id="contr.treatment" class="section level3">
<h3>Contrasts</h3>
<p>We saw that from the first model to the second the R-squared has slightly improved and model coefficients are slightly different. In R the model coefficients depend on the variable variable data type. To obtain equivalent results with the different type coding it is necessary to carefully set the model <em>contrasts</em>. Lets see the contrasts for the two models established:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="DOE.html#cb99-1" aria-hidden="true" tabindex="-1"></a>ebike_lm<span class="sc">$</span>contrasts<span class="sc">$</span>temperature</span></code></pre></div>
<pre><code>NULL</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="DOE.html#cb101-1" aria-hidden="true" tabindex="-1"></a>ebike_lm_factor<span class="sc">$</span>contrasts<span class="sc">$</span>temperature</span></code></pre></div>
<pre><code>[1] &quot;contr.treatment&quot;</code></pre>
<p>Factor type coding and contrasts definition lead to different linear regression equations with different coefficients. It is important to use common sense and attention before using whatever output the system is giving us. We can see the coefficients and use them to calculate the output with a matrix multiplication as follows:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="DOE.html#cb103-1" aria-hidden="true" tabindex="-1"></a>ebike_lm<span class="sc">$</span>coefficients </span></code></pre></div>
<pre><code>(Intercept) temperature 
     137620        2527 </code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="DOE.html#cb105-1" aria-hidden="true" tabindex="-1"></a>ebike_lm<span class="sc">$</span>coefficients <span class="sc">%*%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">180</span>)</span></code></pre></div>
<pre><code>       [,1]
[1,] 592480</code></pre>
<p>this shows that to calculate the output for an input of 180 we have 137’620 + 180 x 2’527 = 592’480. On the other hand, when the temperature is coded as a factor we have the following coefficients and output calculation:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="DOE.html#cb107-1" aria-hidden="true" tabindex="-1"></a>ebike_lm_factor<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>   (Intercept) temperature180 temperature200 temperature220 
        551200          36200          74200         155800 </code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="DOE.html#cb109-1" aria-hidden="true" tabindex="-1"></a>ebike_lm_factor<span class="sc">$</span>coefficients <span class="sc">%*%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span></code></pre></div>
<pre><code>       [,1]
[1,] 587400</code></pre>
<p>The output is slightly different corresponding to 551’200 + 1 x 36’200 = 587’400. More on this in the next section.</p>
</div>
<div id="predict" class="section level3">
<h3>Predict</h3>
<p>A model is useful for predictions. In a random effects model where conclusions can be applied to the all the population we can predict values at any value of the input variables. In that case reusing the model with temperature as a numeric vector we could have a prediction for various temperature values such as:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="DOE.html#cb111-1" aria-hidden="true" tabindex="-1"></a>ebike_new <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">temperature =</span> <span class="fu">c</span>(<span class="dv">180</span>, <span class="dv">200</span>, <span class="dv">210</span>))</span>
<span id="cb111-2"><a href="DOE.html#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(ebike_lm, <span class="at">newdata =</span> ebike_new)</span></code></pre></div>
<pre><code>     1      2      3 
592480 643020 668290 </code></pre>
<p>We can see that the prediction at the tested levels is slightly different from the measured averages at those levels. This is because the linear regression line is not passing exactly by the averages. Anyway in our case the team has selected a fixed effects model and we can only take conclusions at the levels at which the input was tested. We can check that the predictions correspond exactly to the averages we’ve calculated for each level:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="DOE.html#cb113-1" aria-hidden="true" tabindex="-1"></a>ebike_new <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">temperature =</span> <span class="fu">as_factor</span>(<span class="fu">c</span>(<span class="st">&quot;180&quot;</span>, <span class="st">&quot;200&quot;</span>)))</span>
<span id="cb113-2"><a href="DOE.html#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(ebike_lm_factor, <span class="at">newdata =</span> ebike_new)</span></code></pre></div>
<pre><code>     1      2 
587400 625400 </code></pre>
<p>We find again exactly the same values calculated using the matrix multiplication of the linear regression coefficients with the input vector we used before. The <code>predict()</code> function has other advantages such as providing confidence intervals and taking into account the correct contrast coding, which will be explored in later case studies.</p>
<p>The lab supervisor is now ready to assess the validity of the model. This is required before entering the main objective which is comparing the treatment means using an anova. To do this assessment the model he is going to do a residuals analysis. R provides direct plotting functions with the base and stats packages but he opted to break down the analysis and use custom the plots. He also uses some additional statistical tests to confirm our observations from the plots. He starts by loading the package broom which will help him retrieving the data from the lm object into a data frame.</p>
</div>
<div id="augment" class="section level3">
<h3>Model augment</h3>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="DOE.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span></code></pre></div>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="DOE.html#cb116-1" aria-hidden="true" tabindex="-1"></a>ebike_aug <span class="ot">&lt;-</span> <span class="fu">augment</span>(ebike_lm_factor) <span class="sc">%&gt;%</span></span>
<span id="cb116-2"><a href="DOE.html#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">row_number</span>())</span>
<span id="cb116-3"><a href="DOE.html#cb116-3" aria-hidden="true" tabindex="-1"></a>ebike_aug <span class="sc">%&gt;%</span></span>
<span id="cb116-4"><a href="DOE.html#cb116-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span></span>
<span id="cb116-5"><a href="DOE.html#cb116-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="center">cycles</th>
<th align="center">temperature</th>
<th align="center">.fitted</th>
<th align="center">.resid</th>
<th align="center">.hat</th>
<th align="center">.sigma</th>
<th align="center">.cooksd</th>
<th align="center">.std.resid</th>
<th align="center">index</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">575000</td>
<td align="center">160</td>
<td align="center">551200</td>
<td align="center">23800</td>
<td align="center">0.2</td>
<td align="center">17571</td>
<td align="center">0.13261</td>
<td align="center">1.45665</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">542000</td>
<td align="center">160</td>
<td align="center">551200</td>
<td align="center">-9200</td>
<td align="center">0.2</td>
<td align="center">18679</td>
<td align="center">0.01982</td>
<td align="center">-0.56307</td>
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="center">530000</td>
<td align="center">160</td>
<td align="center">551200</td>
<td align="center">-21200</td>
<td align="center">0.2</td>
<td align="center">17846</td>
<td align="center">0.10522</td>
<td align="center">-1.29752</td>
<td align="center">3</td>
</tr>
<tr class="even">
<td align="center">539000</td>
<td align="center">160</td>
<td align="center">551200</td>
<td align="center">-12200</td>
<td align="center">0.2</td>
<td align="center">18535</td>
<td align="center">0.03485</td>
<td align="center">-0.74668</td>
<td align="center">4</td>
</tr>
<tr class="odd">
<td align="center">570000</td>
<td align="center">160</td>
<td align="center">551200</td>
<td align="center">18800</td>
<td align="center">0.2</td>
<td align="center">18069</td>
<td align="center">0.08275</td>
<td align="center">1.15063</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">565000</td>
<td align="center">180</td>
<td align="center">587400</td>
<td align="center">-22400</td>
<td align="center">0.2</td>
<td align="center">17724</td>
<td align="center">0.11747</td>
<td align="center">-1.37096</td>
<td align="center">6</td>
</tr>
</tbody>
</table>
<p>A deep structural change has happened in R since the <code>{tidyverse}</code>. The original S and R creators had developed a language where matrices, vectors, lists and dataframes had equivalent importance. The output of a function was often a list with a specific <em>S3</em> class comprising other vectors and data.frames inside. This allowed to use in a transparent way generic functions such as <code>summary()</code> to produce tailor made outputs because a method was working underneath. We’ve just seen an example of this with the <code>lm()</code> summary in the beginning of this case. For the <code>plot()</code> function there are more than a hundred different automatic plots as seens with <code>apropos("plot")</code>. This is a very important difference as in the <code>{tidyverse}</code> we add layers to obtain the required plot. On the data side since <code>{tidyverse}</code> has been introduced we’ve seen an increasing importance of the dataframe, now replaced by the <code>tibble</code>. The <code>agument()</code> does exactly this, extracts the coefficients, residuals and other data from the model and stores it in a <code>tibble</code> format. This has the advantage of making it easier to integrate these functions with the other <code>{tidyverse}</code> functions and pipelines while still allowing to keep the methods approach. An interesting reading on this co-existance is available under <a href="https://www.tmwr.org/base-r.html#tidiness-modeling">tideness-modeling</a></p>
</div>
<div id="residuals_timeseries" class="section level3">
<h3>Timeseries plot</h3>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="DOE.html#cb117-1" aria-hidden="true" tabindex="-1"></a>ebike_aug <span class="sc">%&gt;%</span></span>
<span id="cb117-2"><a href="DOE.html#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> .resid)) <span class="sc">+</span></span>
<span id="cb117-3"><a href="DOE.html#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb117-4"><a href="DOE.html#cb117-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>, <span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">big.mark =</span> <span class="st">&quot;&#39;&quot;</span>)) <span class="sc">+</span></span>
<span id="cb117-5"><a href="DOE.html#cb117-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb117-6"><a href="DOE.html#cb117-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;e-bike frame hardening process&quot;</span>,</span>
<span id="cb117-7"><a href="DOE.html#cb117-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Linear model - Residuals timeseries&quot;</span>,</span>
<span id="cb117-8"><a href="DOE.html#cb117-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Index&quot;</span>,</span>
<span id="cb117-9"><a href="DOE.html#cb117-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Fitted values&quot;</span></span>
<span id="cb117-10"><a href="DOE.html#cb117-10" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="6_regression_files/figure-html/fig-ebikerestimeseries-1.png" width="100%" /></p>
<p>Before drawing conclusions on the significance of the input variables it is important to assess the validity of the model. The anova assumptions are similar to the t.test assumptions discussed before. In fact the anova can be considered extension of the t.test to factors with more than 2 levels. These assumptions are the common ones commining from statistical inference principles and the central limit theorem: independent and random samples, normality of the distributions, equality of variances. These assumptions could be checked in each variable group but this would be very time consuming and not fully robust. A better way is to analyse the model residuals which are the deviations of each datapoint from the linear regression line.</p>
<p>A first verification consists in confirming that the residuals have no patterns. This confirms that the sampling has been done randomly and there are none of the typical bias consisting in groups of values clustered from one operator the other or from one day to the other. This can be achieved with a residuals timeseries. If patterns emerge then there may be correlation in the residuals.</p>
<p>For this plot we need to ensure that the order of plotting in the x axis corresponds exactly to the original data collection order. In this case the lab supervisor confirms that no specific pattern emerges from the current plot and the design presents itself well randomised.</p>
</div>
<div id="autocorrelation" class="section level3">
<h3>Autocorrelation test</h3>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="DOE.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb118-2"><a href="DOE.html#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="fu">durbinWatsonTest</span>(ebike_lm_factor)</span></code></pre></div>
<pre><code> lag Autocorrelation D-W Statistic p-value
   1        -0.53433        2.9609    0.12
 Alternative hypothesis: rho != 0</code></pre>
<p>As already stated visual observations can most of the times be complemented with a statistical test. In this case we can apply the durbinWatson test from the <code>{car}</code> package (Car stands for Companion to Applied Regression)</p>
<p>Although the output shows Autocorrelation of -0.53 we have to consider that the p value is slightly higher than 0.05 thus there is not enough significance to say that there is autocorrelation. The result is not a complete clear cut the lab supervisor remains alert for coming verifications.</p>
</div>
<div id="normality-plot" class="section level3">
<h3>Normality plot</h3>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="DOE.html#cb120-1" aria-hidden="true" tabindex="-1"></a>ebike_aug <span class="sc">%&gt;%</span></span>
<span id="cb120-2"><a href="DOE.html#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">sample =</span> .resid)) <span class="sc">+</span></span>
<span id="cb120-3"><a href="DOE.html#cb120-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>() <span class="sc">+</span></span>
<span id="cb120-4"><a href="DOE.html#cb120-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq_line</span>() <span class="sc">+</span></span>
<span id="cb120-5"><a href="DOE.html#cb120-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>, <span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">big.mark =</span> <span class="st">&quot;&#39;&quot;</span>)) <span class="sc">+</span></span>
<span id="cb120-6"><a href="DOE.html#cb120-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb120-7"><a href="DOE.html#cb120-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;e-bike frame hardening process&quot;</span>,</span>
<span id="cb120-8"><a href="DOE.html#cb120-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Linear model - qq plot&quot;</span>,</span>
<span id="cb120-9"><a href="DOE.html#cb120-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Residuals&quot;</span>,</span>
<span id="cb120-10"><a href="DOE.html#cb120-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Fitted values&quot;</span></span>
<span id="cb120-11"><a href="DOE.html#cb120-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="6_regression_files/figure-html/ebike-qqplot-1.png" width="100%" /></p>
<p>A good next check is to verify that the residuals are normaly distributed. As the sample size is relatively small it is better to use a qq plot instead of an histogram to assess the normality of the residuals. As we see on the plot values adhere to the straight line indicating an aproximately normal distribution. In the fixed effects model we give more importance to the center of the values and here we consider acceptable that the extremes of the data tend to bend away from the straight line. This verification can be completed by a normality test.</p>
</div>
<div id="shapiroTest" class="section level3">
<h3>Normality test</h3>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="DOE.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(ebike_aug<span class="sc">$</span>.resid)</span></code></pre></div>
<pre><code>
    Shapiro-Wilk normality test

data:  ebike_aug$.resid
W = 0.938, p-value = 0.22</code></pre>
<p>For populations &lt; 50 use the shapiro-wilk normality test, Here p &gt; 0.05 indicates that the residuals do not differ significantly from a normally distributed population.</p>
</div>
<div id="residuals_fit" class="section level3">
<h3>Residuals-Fit plot</h3>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="DOE.html#cb123-1" aria-hidden="true" tabindex="-1"></a>ebike_aug <span class="sc">%&gt;%</span></span>
<span id="cb123-2"><a href="DOE.html#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> .resid)) <span class="sc">+</span></span>
<span id="cb123-3"><a href="DOE.html#cb123-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb123-4"><a href="DOE.html#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> stats<span class="sc">::</span>loess, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb123-5"><a href="DOE.html#cb123-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>, <span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">big.mark =</span> <span class="st">&quot;&#39;&quot;</span>)) <span class="sc">+</span></span>
<span id="cb123-6"><a href="DOE.html#cb123-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb123-7"><a href="DOE.html#cb123-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;e-bike frame hardening process&quot;</span>,</span>
<span id="cb123-8"><a href="DOE.html#cb123-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Linear model - Residuals vs Fitted values&quot;</span>,</span>
<span id="cb123-9"><a href="DOE.html#cb123-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Residuals&quot;</span>,</span>
<span id="cb123-10"><a href="DOE.html#cb123-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Fitted values&quot;</span></span>
<span id="cb123-11"><a href="DOE.html#cb123-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="6_regression_files/figure-html/fig-ebikeresresfit-1.png" width="100%" /></p>
<p>If the model is correct and the assumptions hold, the residuals should be structureless. In particular they should be unrelated to any other variable including the predicted response. A plot of the residuals against the fitted values should reveal such structures. In this plot we see no variance anomalies such as a higher variance for a certain factor level or other types of skweness.</p>
</div>
<div id="homocedasticity" class="section level3">
<h3>Homocedasticity</h3>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="DOE.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bartlett.test</span>(cycles <span class="sc">~</span> temperature, <span class="at">data =</span> ebike_factor)</span></code></pre></div>
<pre><code>
    Bartlett test of homogeneity of variances

data:  cycles by temperature
Bartlett&#39;s K-squared = 0.433, df = 3, p-value = 0.93</code></pre>
<p>A complement to the residuals-fit plot is the equality of variances test. Tests for variance comparison have been introduced in the Direct Comparisons case studies but the <code>var.test()</code> cannot be used here. Here we have more than two levels for which the Bartlett test is most suited. The normal distribution of the residuals has already been confirmed. This test is sensitive to the normality assumption, consequently, when the validity of this assumption is doubtful, it should not be used and be replaced by the modified Levene test for example. Applying the test we obtain a p-value is P = 0.93 meaning we cannot reject the null hypothesis. In statistical terms, there is no evidence to counter the claim that all five variances are the same. This is the same conclusion reached by analyzing the plot of residuals versus fitted values.</p>
</div>
<div id="std_residuals_fit" class="section level3">
<h3>Standard Residuals-Fit plot</h3>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="DOE.html#cb126-1" aria-hidden="true" tabindex="-1"></a>ebike_aug <span class="sc">%&gt;%</span> </span>
<span id="cb126-2"><a href="DOE.html#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> <span class="fu">abs</span>(.std.resid))) <span class="sc">+</span></span>
<span id="cb126-3"><a href="DOE.html#cb126-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb126-4"><a href="DOE.html#cb126-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> stats<span class="sc">::</span>loess, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb126-5"><a href="DOE.html#cb126-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;e-bike frame hardening process&quot;</span>,</span>
<span id="cb126-6"><a href="DOE.html#cb126-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Linear model - Standardised Residuals vs Fitted values&quot;</span>,</span>
<span id="cb126-7"><a href="DOE.html#cb126-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Standardised Residuals&quot;</span>,</span>
<span id="cb126-8"><a href="DOE.html#cb126-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Fitted values&quot;</span>)</span></code></pre></div>
<p><img src="6_regression_files/figure-html/fig-ebikestdresfit-1.png" width="100%" /></p>
<p>This Standardized residuals plot helps detecting outliers in the residuals (any residual &gt; 3 standard deviations is a potential outlier). The plot shows no outliers to consider in this DOE.</p>
</div>
<div id="outliers" class="section level3">
<h3>Outliers test</h3>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="DOE.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">outlierTest</span>(ebike_lm_factor)</span></code></pre></div>
<pre><code>No Studentized residuals with Bonferroni p &lt; 0.05
Largest |rstudent|:
   rstudent unadjusted p-value Bonferroni p
12   1.6488            0.11997           NA</code></pre>
<p>In a case where we were doubtfull we could go further and make a statistical test to assess if a certain value was an outlier. Another usefull test is available in the <code>{car}</code> package in this case to test outliers. We get a <em>Bonferroni</em> adjusted p value as NA confirming that there is no outlier in the data.</p>
</div>
<div id="cooks" class="section level3">
<h3>Cooks distance</h3>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="DOE.html#cb129-1" aria-hidden="true" tabindex="-1"></a>ebike_aug <span class="sc">%&gt;%</span> </span>
<span id="cb129-2"><a href="DOE.html#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> .cooksd)) <span class="sc">+</span></span>
<span id="cb129-3"><a href="DOE.html#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="fu">viridis</span>(<span class="dv">12</span>)[<span class="dv">4</span>], <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>) <span class="sc">+</span></span>
<span id="cb129-4"><a href="DOE.html#cb129-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb129-5"><a href="DOE.html#cb129-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;e-bike frame hardening process&quot;</span>,</span>
<span id="cb129-6"><a href="DOE.html#cb129-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Residuals vs Leverage&quot;</span>,</span>
<span id="cb129-7"><a href="DOE.html#cb129-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="st">&quot;Observation&quot;</span>,</span>
<span id="cb129-8"><a href="DOE.html#cb129-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="st">&quot;Cooks distance&quot;</span>)</span></code></pre></div>
<p><img src="6_regression_files/figure-html/fig-ebikecooks-1.png" width="100%" /></p>
<p>Cooks distance is a complementary analysis to the residuals that can help identify specific data points that could have a strong influence in the model. Various cutoff points are suggested in the literature and we opted here for 1 following the short wikipedia article on the topic <a href="https://en.wikipedia.org/wiki/Cook&#39;s_distance">cooks distance</a></p>
</div>
<div id="R-squared" class="section level3">
<h3>R-squared</h3>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="DOE.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ebike_lm_factor)<span class="sc">$</span>r.squared</span></code></pre></div>
<pre><code>[1] 0.92606</code></pre>
<p>A final input in the draft report of the ebike hardnening linear model is the R-squared. When looking into the results the engineering team is suspicious. A model with such a good fit should raise questions. R-squared gives an indication of the quality of the model. In this case 93% of the output is explained by input. Our lab supervisor is also not confortable the residuals analysis has not shown any evidence of something wrong with the model so he decides to quickly calculate it “by hand.” He knows that the R-squared, or coefficient of determination is obtained from the ratio between the residuals variance and the output variable variance showing exactly the proportion between the two and he gets its straight away from R using the data already available:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="DOE.html#cb132-1" aria-hidden="true" tabindex="-1"></a>ebike_aug <span class="sc">%&gt;%</span></span>
<span id="cb132-2"><a href="DOE.html#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cycles_var =</span> <span class="fu">var</span>(cycles), <span class="at">residuals_var =</span> <span class="fu">var</span>(.resid)) <span class="sc">%&gt;%</span></span>
<span id="cb132-3"><a href="DOE.html#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Rsquared =</span> <span class="dv">1</span> <span class="sc">-</span> residuals_var<span class="sc">/</span>cycles_var) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Rsquared)</span></code></pre></div>
<pre><code>[1] 0.92606</code></pre>
<p>Remembering the original linear regression plot from the begining of the report he accepts this must not be so far away. It was clear that the temperature had a strong impact on the number of cycles and the variability for each level was small in the end. He accepts to leave as it is for now waiting for upcoming analysis of variance to see additional details.</p>

</div>
</div>
<div id="anova-ancova" class="section level2">
<h2>Anova &amp; Ancova</h2>
<p>We can also compare medians and get a sense of the effect of the treatment levels by looking into the box plot:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="DOE.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ebike_factor, </span>
<span id="cb134-2"><a href="DOE.html#cb134-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> cycles, <span class="at">fill =</span> temperature)) <span class="sc">+</span></span>
<span id="cb134-3"><a href="DOE.html#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb134-4"><a href="DOE.html#cb134-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;D&quot;</span>, <span class="at">begin =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb134-5"><a href="DOE.html#cb134-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>, <span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">big.mark =</span> <span class="st">&quot;&#39;&quot;</span>)) <span class="sc">+</span></span>
<span id="cb134-6"><a href="DOE.html#cb134-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb134-7"><a href="DOE.html#cb134-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;e-bike frame hardening process&quot;</span>,</span>
<span id="cb134-8"><a href="DOE.html#cb134-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Raw data plot&quot;</span>,</span>
<span id="cb134-9"><a href="DOE.html#cb134-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Furnace Temperature [°C]&quot;</span>,</span>
<span id="cb134-10"><a href="DOE.html#cb134-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Cycles to failure [n]&quot;</span>)</span></code></pre></div>
<p><img src="7_anova_files/figure-html/unnamed-chunk-3-1.png" width="100%" /></p>
<p>1 factor with severals levels + 1 continuous dependent variable
Similar to the t-test but extended - this test allows to compare the means between several levels of treatement for a continuous response variable (the t test is only 2 levels at a time, performing all pair wise t-tests would also not be a solution because its a lot of effort and would increase the type I error)</p>
<p>ANOVA principle: the total variability in the data, as measured by the total corrected sum of squares, can be partitioned into a sum of squares of the differences between the treatment averages and the grand average plus a sum of squares of the differences of observations within treatments from the treatment average</p>
<div id="aov" class="section level3">
<h3>Aov</h3>
<p>In R the anova is built by passing the linear model to the anova or aov functions. The output of the anova function is just the anova table as shown here for this first example. The output of the aov function is a list.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="DOE.html#cb135-1" aria-hidden="true" tabindex="-1"></a>ebike_aov_factor <span class="ot">&lt;-</span> <span class="fu">aov</span>(ebike_lm_factor)</span>
<span id="cb135-2"><a href="DOE.html#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ebike_aov_factor)</span></code></pre></div>
<pre><code>            Df   Sum Sq  Mean Sq F value  Pr(&gt;F)    
temperature  3 6.69e+10 2.23e+10    66.8 2.9e-09 ***
Residuals   16 5.34e+09 3.34e+08                    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Note that the RF temperature or between-treatment mean square (22,290.18) is many times larger than the within-treatment or error mean square (333.70). This indicates that it is unlikely that the treatment means are equal.
Also p &lt; 0.05 thus we can reject the null hypothesis and conclude that the means are significantly different.</p>
<p>Anova on plasma etching, modification of the example to achieve a p &gt; 0.05:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="DOE.html#cb137-1" aria-hidden="true" tabindex="-1"></a>ebike_narrow2 <span class="ot">&lt;-</span> ebike_hardening2 <span class="sc">%&gt;%</span></span>
<span id="cb137-2"><a href="DOE.html#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb137-3"><a href="DOE.html#cb137-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;g&quot;</span>),</span>
<span id="cb137-4"><a href="DOE.html#cb137-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;observation&quot;</span>,</span>
<span id="cb137-5"><a href="DOE.html#cb137-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;cycles&quot;</span></span>
<span id="cb137-6"><a href="DOE.html#cb137-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb137-7"><a href="DOE.html#cb137-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(temperature) <span class="sc">%&gt;%</span></span>
<span id="cb137-8"><a href="DOE.html#cb137-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cycles_mean =</span> <span class="fu">mean</span>(cycles)) <span class="sc">%&gt;%</span></span>
<span id="cb137-9"><a href="DOE.html#cb137-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb137-10"><a href="DOE.html#cb137-10" aria-hidden="true" tabindex="-1"></a>ebike_factor2 <span class="ot">&lt;-</span> ebike_narrow2</span>
<span id="cb137-11"><a href="DOE.html#cb137-11" aria-hidden="true" tabindex="-1"></a>ebike_factor2<span class="sc">$</span>temperature <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(ebike_factor2<span class="sc">$</span>temperature)</span>
<span id="cb137-12"><a href="DOE.html#cb137-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-13"><a href="DOE.html#cb137-13" aria-hidden="true" tabindex="-1"></a>ebike_lm_factor2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(cycles <span class="sc">~</span> temperature, <span class="at">data =</span> ebike_factor2)</span>
<span id="cb137-14"><a href="DOE.html#cb137-14" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(ebike_lm_factor2)</span></code></pre></div>
<pre><code>Analysis of Variance Table

Response: cycles
            Df   Sum Sq  Mean Sq F value Pr(&gt;F)
temperature  3 1.48e+09 4.92e+08     1.2   0.34
Residuals   16 6.55e+09 4.10e+08               </code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="DOE.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ebike_factor2, </span>
<span id="cb139-2"><a href="DOE.html#cb139-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> cycles, <span class="at">fill =</span> temperature)) <span class="sc">+</span></span>
<span id="cb139-3"><a href="DOE.html#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb139-4"><a href="DOE.html#cb139-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb139-5"><a href="DOE.html#cb139-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;A&quot;</span>, <span class="at">begin =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb139-6"><a href="DOE.html#cb139-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb139-7"><a href="DOE.html#cb139-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>, <span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">big.mark =</span> <span class="st">&quot;&#39;&quot;</span>)) <span class="sc">+</span></span>
<span id="cb139-8"><a href="DOE.html#cb139-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;e-bike frame hardening process&quot;</span>,</span>
<span id="cb139-9"><a href="DOE.html#cb139-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Boxplot of frame aging resistance&quot;</span>,</span>
<span id="cb139-10"><a href="DOE.html#cb139-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Furnace Temperature [°C]&quot;</span>,</span>
<span id="cb139-11"><a href="DOE.html#cb139-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Cycles to failure [n]&quot;</span>)</span></code></pre></div>
<p><img src="7_anova_files/figure-html/unnamed-chunk-6-1.png" width="100%" /></p>
<p>P &gt; 0.05 - there is no significant difference between the means</p>
</div>
<div id="tukey" class="section level3">
<h3>Pairwise comparison</h3>
<p>The Anova may indicate that the treament means differ but it won’t indicate which ones. In this case we may want to compare pairs of means.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="DOE.html#cb140-1" aria-hidden="true" tabindex="-1"></a>ebike_tukey <span class="ot">&lt;-</span> <span class="fu">TukeyHSD</span>(ebike_aov_factor, <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="DOE.html#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ebike_tukey<span class="sc">$</span>temperature) <span class="sc">%&gt;%</span> </span>
<span id="cb141-2"><a href="DOE.html#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>, </span>
<span id="cb141-3"><a href="DOE.html#cb141-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;tukey test on e-bike frame hardening process&quot;</span>, </span>
<span id="cb141-4"><a href="DOE.html#cb141-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> T)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-8">Table 6: </span>tukey test on e-bike frame hardening process</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="center">diff</th>
<th align="center">lwr</th>
<th align="center">upr</th>
<th align="center">p adj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">180-160</td>
<td align="center">36200</td>
<td align="center">3145.6</td>
<td align="center">69254</td>
<td align="center">0.02943</td>
</tr>
<tr class="even">
<td align="left">200-160</td>
<td align="center">74200</td>
<td align="center">41145.6</td>
<td align="center">107254</td>
<td align="center">0.00005</td>
</tr>
<tr class="odd">
<td align="left">220-160</td>
<td align="center">155800</td>
<td align="center">122745.6</td>
<td align="center">188854</td>
<td align="center">0.00000</td>
</tr>
<tr class="even">
<td align="left">200-180</td>
<td align="center">38000</td>
<td align="center">4945.6</td>
<td align="center">71054</td>
<td align="center">0.02160</td>
</tr>
<tr class="odd">
<td align="left">220-180</td>
<td align="center">119600</td>
<td align="center">86545.6</td>
<td align="center">152654</td>
<td align="center">0.00000</td>
</tr>
<tr class="even">
<td align="left">220-200</td>
<td align="center">81600</td>
<td align="center">48545.6</td>
<td align="center">114654</td>
<td align="center">0.00001</td>
</tr>
</tbody>
</table>
<p>The test provides us a simple direct calculation of the differences between the treatment means and a confidence interval for those. Most importantly it provides us with the p value to help us confirm the significance of the difference and conclude factor level by factor level which differences are significant.</p>
<p>Additionally we can obtain the related plot with the confidence intervals</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="DOE.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ebike_tukey)</span></code></pre></div>
<p><img src="7_anova_files/figure-html/unnamed-chunk-9-1.png" width="100%" /></p>
</div>
<div id="fisherLSD" class="section level3">
<h3>Least significant difference</h3>
<p>Fisher’s Least Significant difference is an alternative to Tuckey’s test.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="DOE.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(agricolae)</span></code></pre></div>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="DOE.html#cb144-1" aria-hidden="true" tabindex="-1"></a>ebike_anova <span class="ot">&lt;-</span> <span class="fu">anova</span>(ebike_lm_factor) </span>
<span id="cb144-2"><a href="DOE.html#cb144-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-3"><a href="DOE.html#cb144-3" aria-hidden="true" tabindex="-1"></a>ebike_LSD <span class="ot">&lt;-</span> <span class="fu">LSD.test</span>(<span class="at">y =</span> ebike_factor<span class="sc">$</span>cycles,</span>
<span id="cb144-4"><a href="DOE.html#cb144-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">trt =</span> ebike_factor<span class="sc">$</span>temperature,</span>
<span id="cb144-5"><a href="DOE.html#cb144-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">DFerror =</span> ebike_anova<span class="sc">$</span>Df[<span class="dv">2</span>],  </span>
<span id="cb144-6"><a href="DOE.html#cb144-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">MSerror =</span> ebike_anova<span class="sc">$</span><span class="st">`</span><span class="at">Mean Sq</span><span class="st">`</span>[<span class="dv">2</span>],</span>
<span id="cb144-7"><a href="DOE.html#cb144-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="fl">0.05</span>)</span></code></pre></div>
<p>The Fisher procedure provides us with additional information. A first outcome is the difference between means (of life cycles) that can be considered significant, indicated in the table below by LSD = 24.49.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="DOE.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ebike_LSD<span class="sc">$</span>statistics) <span class="sc">%&gt;%</span> </span>
<span id="cb145-2"><a href="DOE.html#cb145-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>, </span>
<span id="cb145-3"><a href="DOE.html#cb145-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;Fisher LSD procedure on e-bike frame hardening: stats&quot;</span>,</span>
<span id="cb145-4"><a href="DOE.html#cb145-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> T)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-12">Table 7: </span>Fisher LSD procedure on e-bike frame hardening: stats</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="center">MSerror</th>
<th align="center">Df</th>
<th align="center">Mean</th>
<th align="center">CV</th>
<th align="center">t.value</th>
<th align="center">LSD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"></td>
<td align="center">333700000</td>
<td align="center">16</td>
<td align="center">617750</td>
<td align="center">2.9571</td>
<td align="center">2.1199</td>
<td align="center">24492</td>
</tr>
</tbody>
</table>
<p>Furthermore it gives us a confidence interval for each treatment level mean:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="DOE.html#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ebike_LSD<span class="sc">$</span>means) <span class="sc">%&gt;%</span> </span>
<span id="cb146-2"><a href="DOE.html#cb146-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># as_tibble() %&gt;%</span></span>
<span id="cb146-3"><a href="DOE.html#cb146-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">cycles =</span> <span class="st">`</span><span class="at">ebike_factor$cycles</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-4"><a href="DOE.html#cb146-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Min, <span class="sc">-</span>Max, <span class="sc">-</span>Q25, <span class="sc">-</span>Q50, <span class="sc">-</span>Q75) <span class="sc">%&gt;%</span></span>
<span id="cb146-5"><a href="DOE.html#cb146-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>, </span>
<span id="cb146-6"><a href="DOE.html#cb146-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;Fisher LSD procedure on e-bike frame hardening: means&quot;</span>, </span>
<span id="cb146-7"><a href="DOE.html#cb146-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> T)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-13">Table 8: </span>Fisher LSD procedure on e-bike frame hardening: means</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="center">cycles</th>
<th align="center">std</th>
<th align="center">r</th>
<th align="center">LCL</th>
<th align="center">UCL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">160</td>
<td align="center">551200</td>
<td align="center">20017</td>
<td align="center">5</td>
<td align="center">533882</td>
<td align="center">568518</td>
</tr>
<tr class="even">
<td align="left">180</td>
<td align="center">587400</td>
<td align="center">16742</td>
<td align="center">5</td>
<td align="center">570082</td>
<td align="center">604718</td>
</tr>
<tr class="odd">
<td align="left">200</td>
<td align="center">625400</td>
<td align="center">20526</td>
<td align="center">5</td>
<td align="center">608082</td>
<td align="center">642718</td>
</tr>
<tr class="even">
<td align="left">220</td>
<td align="center">707000</td>
<td align="center">15248</td>
<td align="center">5</td>
<td align="center">689682</td>
<td align="center">724318</td>
</tr>
</tbody>
</table>
<p>We can see for example that for temperature 220 °C the etch rate if on average 707.0 with a probability of 95% of being between 689.7 and 724.3 A/min.</p>
<p>Another interesting outcome is the grouping of levels for each factor:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="DOE.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ebike_LSD<span class="sc">$</span>groups) <span class="sc">%&gt;%</span> </span>
<span id="cb147-2"><a href="DOE.html#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>, </span>
<span id="cb147-3"><a href="DOE.html#cb147-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;Fisher LSD procedure on e-bike frame hardening: groups&quot;</span>, </span>
<span id="cb147-4"><a href="DOE.html#cb147-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> T)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-14">Table 9: </span>Fisher LSD procedure on e-bike frame hardening: groups</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="center">ebike_factor$cycles</th>
<th align="center">groups</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">220</td>
<td align="center">707000</td>
<td align="center">a</td>
</tr>
<tr class="even">
<td align="left">200</td>
<td align="center">625400</td>
<td align="center">b</td>
</tr>
<tr class="odd">
<td align="left">180</td>
<td align="center">587400</td>
<td align="center">c</td>
</tr>
<tr class="even">
<td align="left">160</td>
<td align="center">551200</td>
<td align="center">d</td>
</tr>
</tbody>
</table>
<p>In this case as all level means are statistically different they all show up in separate groups, each indicated by a specific letter.</p>
<p>Finally we can get from this package a plot with the Least significant difference error bars:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="DOE.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ebike_LSD)</span></code></pre></div>
<p><img src="7_anova_files/figure-html/unnamed-chunk-15-1.png" width="100%" /></p>
<p>And below we’re exploring a manual execution of this type of plot (in this case with the standard deviations instead).</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="DOE.html#cb149-1" aria-hidden="true" tabindex="-1"></a>ebike_factor <span class="sc">%&gt;%</span></span>
<span id="cb149-2"><a href="DOE.html#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(temperature) <span class="sc">%&gt;%</span></span>
<span id="cb149-3"><a href="DOE.html#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cycles_mean =</span> <span class="fu">mean</span>(cycles), </span>
<span id="cb149-4"><a href="DOE.html#cb149-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">cycles_sd =</span> <span class="fu">sd</span>(cycles)) <span class="sc">%&gt;%</span></span>
<span id="cb149-5"><a href="DOE.html#cb149-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> cycles_mean)) <span class="sc">+</span></span>
<span id="cb149-6"><a href="DOE.html#cb149-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb149-7"><a href="DOE.html#cb149-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb149-8"><a href="DOE.html#cb149-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> cycles_mean <span class="sc">-</span> cycles_sd, </span>
<span id="cb149-9"><a href="DOE.html#cb149-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> cycles_mean <span class="sc">+</span> cycles_sd),</span>
<span id="cb149-10"><a href="DOE.html#cb149-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb149-11"><a href="DOE.html#cb149-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>, <span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">big.mark =</span> <span class="st">&quot;&#39;&quot;</span>)) <span class="sc">+</span></span>
<span id="cb149-12"><a href="DOE.html#cb149-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_color_viridis_d(option = &quot;C&quot;, begin = 0.1, end = 0.9) +</span></span>
<span id="cb149-13"><a href="DOE.html#cb149-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">label =</span> <span class="st">&quot;Error bars are +/- 1xSD&quot;</span>, </span>
<span id="cb149-14"><a href="DOE.html#cb149-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">colour =</span> <span class="st">&quot;grey30&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>, </span>
<span id="cb149-15"><a href="DOE.html#cb149-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">&quot;italic&quot;</span>) <span class="sc">+</span></span>
<span id="cb149-16"><a href="DOE.html#cb149-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;e-bike frame hardening process&quot;</span>,</span>
<span id="cb149-17"><a href="DOE.html#cb149-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Boxplot of frame aging resistance&quot;</span>,</span>
<span id="cb149-18"><a href="DOE.html#cb149-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Furnace Temperature [°C]&quot;</span>,</span>
<span id="cb149-19"><a href="DOE.html#cb149-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Cycles to failure [n]&quot;</span>)</span></code></pre></div>
<p><img src="7_anova_files/figure-html/unnamed-chunk-16-1.png" width="100%" /></p>
<p>As often with statistical tools, there is debate on the best approach to use. We recommend to combine the Tukey test with the Fisher’s LSD completementary R functions. The Tukey test giving a first indication of the levels that have an effect and calculating the means differences and the Fisher function to provide much more additional information on each level. To be considered in each situation the slight difference between the significance level for difference between means and to decide if required to take the most conservative one.</p>
<p>To go further in the Anova F-test we recommend this interesting article from <span class="citation"><a href="#ref-minitab_anovaftest" role="doc-biblioref">Minitab</a> (<a href="#ref-minitab_anovaftest" role="doc-biblioref">2016</a>)</span>.</p>
<p>Two factors multiple levels</p>
<p><strong>The solarcell output test</strong></p>
<div class="marginnote">
<p><img src="img/solar_cell_test_bw.jpg" width="100%" style="display: block; margin: auto;" /></p>
</div>
<p>Load and prepare data for analysis:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="DOE.html#cb150-1" aria-hidden="true" tabindex="-1"></a>solarcell_factor <span class="ot">&lt;-</span> solarcell_output <span class="sc">%&gt;%</span> </span>
<span id="cb150-2"><a href="DOE.html#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb150-3"><a href="DOE.html#cb150-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;T-10&quot;</span>, <span class="st">&quot;T20&quot;</span>, <span class="st">&quot;T50&quot;</span>),</span>
<span id="cb150-4"><a href="DOE.html#cb150-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;temperature&quot;</span>,</span>
<span id="cb150-5"><a href="DOE.html#cb150-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;output&quot;</span></span>
<span id="cb150-6"><a href="DOE.html#cb150-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(material, temperature), as_factor))</span></code></pre></div>
</div>
<div id="formula" class="section level3">
<h3>Model formulae</h3>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="DOE.html#cb151-1" aria-hidden="true" tabindex="-1"></a>solarcell_formula <span class="ot">&lt;-</span> output <span class="sc">~</span> temperature <span class="sc">+</span> material <span class="sc">+</span> temperature<span class="sc">:</span>material</span>
<span id="cb151-2"><a href="DOE.html#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(solarcell_formula)</span></code></pre></div>
<pre><code>[1] &quot;formula&quot;</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="DOE.html#cb153-1" aria-hidden="true" tabindex="-1"></a>solarcell_factor_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb153-2"><a href="DOE.html#cb153-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> solarcell_formula, </span>
<span id="cb153-3"><a href="DOE.html#cb153-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> solarcell_factor</span>
<span id="cb153-4"><a href="DOE.html#cb153-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb153-5"><a href="DOE.html#cb153-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(solarcell_factor_lm)</span></code></pre></div>
<pre><code>
Call:
lm(formula = solarcell_formula, data = solarcell_factor)

Residuals:
   Min     1Q Median     3Q    Max 
-60.75 -14.63   1.38  17.94  45.25 

Coefficients:
                                     Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                            134.75      12.99   10.37  6.5e-11 ***
temperatureT20                         -77.50      18.37   -4.22  0.00025 ***
temperatureT50                         -77.25      18.37   -4.20  0.00026 ***
materialchristaline                     21.00      18.37    1.14  0.26311    
materialmultijunction                    9.25      18.37    0.50  0.61875    
temperatureT20:materialchristaline      41.50      25.98    1.60  0.12189    
temperatureT50:materialchristaline     -29.00      25.98   -1.12  0.27424    
temperatureT20:materialmultijunction    79.25      25.98    3.05  0.00508 ** 
temperatureT50:materialmultijunction    18.75      25.98    0.72  0.47676    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 26 on 27 degrees of freedom
Multiple R-squared:  0.765, Adjusted R-squared:  0.696 
F-statistic:   11 on 8 and 27 DF,  p-value: 9.43e-07</code></pre>
<p>Looking at the output we see that R-squared is equal to 0.7652. This means about 77 percent of the variability in the battery life is explained by the plate material in the battery, the temperature, and the material type–temperature interaction. We’re going to go more in details now to validate the model and understand the effects and interactions of the different factors.</p>
</div>
<div id="interaction.plot" class="section level3">
<h3>Interaction plot</h3>
<p>In this experiement instead of just plotting a linear regression we need to go for a more elaborate plot that shows the response as a function of the two factors. Many different approaches are possible in R and here we’re starting with a rather simple one - the interaction plot from the stats package:</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="DOE.html#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">interaction.plot</span>(<span class="at">x.factor =</span> solarcell_factor<span class="sc">$</span>temperature, </span>
<span id="cb155-2"><a href="DOE.html#cb155-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">trace.factor =</span> solarcell_factor<span class="sc">$</span>material,</span>
<span id="cb155-3"><a href="DOE.html#cb155-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fun =</span> mean,</span>
<span id="cb155-4"><a href="DOE.html#cb155-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">response =</span> solarcell_factor<span class="sc">$</span>output,</span>
<span id="cb155-5"><a href="DOE.html#cb155-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">trace.label =</span> <span class="st">&quot;Material&quot;</span>,</span>
<span id="cb155-6"><a href="DOE.html#cb155-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">legend =</span> <span class="cn">TRUE</span>,</span>
<span id="cb155-7"><a href="DOE.html#cb155-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">main =</span> <span class="st">&quot;Temperature-Material interaction plot&quot;</span>,</span>
<span id="cb155-8"><a href="DOE.html#cb155-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xlab =</span> <span class="st">&quot;temperature [°C]&quot;</span>,</span>
<span id="cb155-9"><a href="DOE.html#cb155-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ylab =</span> <span class="st">&quot;output [kWh/yr equivalent]&quot;</span>)</span></code></pre></div>
<p><img src="7_anova_files/figure-html/unnamed-chunk-21-1.png" width="100%" /></p>
<p>Although simple many important learnings can be extracted from this plot. We get the indication of the mean value of battery life for the different data groups at each temperature level for each material. Also we see immediatly that batteries tend to have longer lifes at lower temperature for all material types. We also see that there is certainly an interaction between material and temperature as the lines cross each other.</p>
<p>We do now a quick assessment of the residuals, starting by the timeseries of residuals:</p>
</div>
<div id="simple_timeseries" class="section level3">
<h3>Simplified timeseries</h3>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="DOE.html#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(solarcell_factor_lm<span class="sc">$</span>residuals)</span></code></pre></div>
<p><img src="7_anova_files/figure-html/unnamed-chunk-22-1.png" width="100%" /></p>
<p>No specific pattern is apparent so now we check all the remaining plots grouped into one single output:</p>
</div>
<div id="plot_model" class="section level3">
<h3>Residuals summary</h3>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="DOE.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb157-2"><a href="DOE.html#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(solarcell_factor_lm)</span></code></pre></div>
<p><img src="7_anova_files/figure-html/unnamed-chunk-23-1.png" width="100%" /></p>
<p>Residuals versus fit presents a rather simetrical distribution around zero indicating equality of variances at all levels and the qq plot presents good adherence to the centel line indicating a normal distributed population of residuals, all ok for these. The scale location plot though, shows a center line that is not horizontal which suggest the presence of outliers.</p>
</div>
<div id="cooks_histogram" class="section level3">
<h3>Cooks histogram</h3>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="DOE.html#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(solarcell_factor_lm, <span class="at">which =</span> <span class="dv">4</span>)</span></code></pre></div>
<p><img src="7_anova_files/figure-html/unnamed-chunk-24-1.png" width="100%" /></p>
<p>We can extract the absolute maximum residual with:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="DOE.html#cb159-1" aria-hidden="true" tabindex="-1"></a>solarcell_factor_lm<span class="sc">$</span>residuals <span class="sc">%&gt;%</span> <span class="fu">abs</span>() <span class="sc">%&gt;%</span> <span class="fu">max</span>()</span></code></pre></div>
<pre><code>[1] 60.75</code></pre>
<p>Inspecting again the residuals plots we see that this corresponds to the point labeled with 2 for which the standardized value is greater than 2 standard deviations.</p>
<p>We’re therefore apply the outlier test from the car package:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="DOE.html#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span></code></pre></div>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="DOE.html#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">outlierTest</span>(solarcell_factor_lm)</span></code></pre></div>
<pre><code>No Studentized residuals with Bonferroni p &lt; 0.05
Largest |rstudent|:
  rstudent unadjusted p-value Bonferroni p
4  -3.1004          0.0046065      0.16583</code></pre>
<p>which gives a high Bonferroni p value thus excluding this possibility.</p>
<p>As the R-squared was rather high and there were no issues with residuals we considere the model as acceptable and move ahead with the assessment of the significance of the different effects. For that we apply the anova to the linear model:</p>
</div>
<div id="anova" class="section level3">
<h3>Anova check</h3>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="DOE.html#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(solarcell_factor_lm)</span></code></pre></div>
<pre><code>Analysis of Variance Table

Response: output
                     Df Sum Sq Mean Sq F value  Pr(&gt;F)    
temperature           2  39119   19559   28.97 1.9e-07 ***
material              2  10684    5342    7.91   0.002 ** 
temperature:material  4   9614    2403    3.56   0.019 *  
Residuals            27  18231     675                    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>We see in the output little stars in front of the p value of the different factors. Three stars for temperature corresponding to an extremely low p value indicating that the means of the lifetime at different levels of temperature are significantly different, confirming that temperature has an effect on lifetime. With a lower significance but still clearly impacting lifetime depends on the material. Finally it is confirmed that there is an interaction between both factors has the temperature:material term has a p value of 0.01861 which us lower than the treshold of 0.05.</p>
<p>The interaction here corresponds to the fact that increasing temperature from 15 to 70 decreases lifetime for material 2 but increases for material 3.</p>
<p>Its interesting to consider what would have been the analysis if the interaction was not put in the model. We can easily assess that by creating a new model in R without the temperature:material term.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="DOE.html#cb166-1" aria-hidden="true" tabindex="-1"></a>solarcell_factor_lm_no_int <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb166-2"><a href="DOE.html#cb166-2" aria-hidden="true" tabindex="-1"></a>  output <span class="sc">~</span> temperature <span class="sc">+</span> material, <span class="at">data =</span> solarcell_factor)</span>
<span id="cb166-3"><a href="DOE.html#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(solarcell_factor_lm_no_int)</span></code></pre></div>
<pre><code>
Call:
lm(formula = output ~ temperature + material, data = solarcell_factor)

Residuals:
   Min     1Q Median     3Q    Max 
-54.39 -21.68   2.69  17.22  57.53 

Coefficients:
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)              122.5       11.2   10.97  3.4e-12 ***
temperatureT20           -37.2       12.2   -3.04   0.0047 ** 
temperatureT50           -80.7       12.2   -6.59  2.3e-07 ***
materialchristaline       25.2       12.2    2.06   0.0482 *  
materialmultijunction     41.9       12.2    3.43   0.0017 ** 
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 30 on 31 degrees of freedom
Multiple R-squared:  0.641, Adjusted R-squared:  0.595 
F-statistic: 13.9 on 4 and 31 DF,  p-value: 1.37e-06</code></pre>
<p>The model still presents a reasonably high R-square of 0.64. We now apply the anova on this new model:</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="DOE.html#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(solarcell_factor_lm_no_int)</span></code></pre></div>
<pre><code>Analysis of Variance Table

Response: output
            Df Sum Sq Mean Sq F value  Pr(&gt;F)    
temperature  2  39119   19559   21.78 1.2e-06 ***
material     2  10684    5342    5.95  0.0065 ** 
Residuals   31  27845     898                    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The output naturally confirms the significance of the effects of the factors, however, as soon as a residual analysis is performed for these data, it becomes clear that the non-interaction model is inadequate:</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="DOE.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb170-2"><a href="DOE.html#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(solarcell_factor_lm_no_int)</span></code></pre></div>
<p><img src="7_anova_files/figure-html/unnamed-chunk-31-1.png" width="100%" /></p>
<p>We see in the Residuals vs Fitted a clear pattern with residuals moving from positive to negative and then again to positive along the fitted values axis which indicates that there is an interaction at play.</p>
</div>
<div id="covariance" class="section level3">
<h3>Covariance</h3>
<p>We assess here the potential utilisation of the analysis of covariance (ancova) in situations where a continuous variable may be influencing the measured value. This technique complements the analysis of variance (anova) allowing for a more accurate assessment of the effects of the categorical variables.</p>
<p>Below a description of the approach taken from <span class="citation">(<a href="#ref-Montgomery2012" role="doc-biblioref">Montgomery 2012</a>)</span>, pag.655:</p>
<p><em>Suppose that in an experiment with a response variable y there is another variable, say x, and that y is linearly related to x. Furthermore, suppose that x cannot be controlled by the experimenter but can be observed along with y. The variable x is called a covariate or concomitant variable. The analysis of covariance involves adjusting the observed response variable for the effect of the concomitant variable.</em></p>
<p><em>If such an adjustment is not performed, the concomitant variable could inflate the error mean square and make true differences in the response due to treatments harder to detect. Thus, the analysis of covariance is a method of adjusting for the effects of an uncontrollable nuisance variable. As we will see, the procedure is a combination of analysis of variance and regression analysis.</em></p>
<p><em>As an example of an experiment in which the analysis of covariance may be employed, consider a study performed to determine if there is a difference in the strength of a monofilament fiber produced by three different machines. The data from this experiment are shown in Table 15.10 (below). Figure 15.3 presents a scatter diagram of strength (y) versus the diameter (or thickness) of the sample. Clearly, the strength of the fiber is also affected by its thickness; consequently, a thicker fiber will generally be stronger than a thinner one. The analysis of covariance could be used to remove the effect of thickness (x) on strength (y) when testing for differences in strength between machines.</em></p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="DOE.html#cb171-1" aria-hidden="true" tabindex="-1"></a>solarcell_fill <span class="sc">%&gt;%</span> </span>
<span id="cb171-2"><a href="DOE.html#cb171-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">material</th>
<th align="right">output</th>
<th align="right">fillfactor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">multijunction_A</td>
<td align="right">108</td>
<td align="right">20</td>
</tr>
<tr class="even">
<td align="left">multijunction_A</td>
<td align="right">123</td>
<td align="right">25</td>
</tr>
<tr class="odd">
<td align="left">multijunction_A</td>
<td align="right">117</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td align="left">multijunction_A</td>
<td align="right">126</td>
<td align="right">25</td>
</tr>
<tr class="odd">
<td align="left">multijunction_A</td>
<td align="right">147</td>
<td align="right">32</td>
</tr>
<tr class="even">
<td align="left">multijunction_B</td>
<td align="right">120</td>
<td align="right">22</td>
</tr>
<tr class="odd">
<td align="left">multijunction_B</td>
<td align="right">144</td>
<td align="right">28</td>
</tr>
<tr class="even">
<td align="left">multijunction_B</td>
<td align="right">117</td>
<td align="right">22</td>
</tr>
<tr class="odd">
<td align="left">multijunction_B</td>
<td align="right">135</td>
<td align="right">30</td>
</tr>
<tr class="even">
<td align="left">multijunction_B</td>
<td align="right">132</td>
<td align="right">28</td>
</tr>
<tr class="odd">
<td align="left">multijunction_C</td>
<td align="right">105</td>
<td align="right">21</td>
</tr>
<tr class="even">
<td align="left">multijunction_C</td>
<td align="right">111</td>
<td align="right">23</td>
</tr>
<tr class="odd">
<td align="left">multijunction_C</td>
<td align="right">126</td>
<td align="right">26</td>
</tr>
<tr class="even">
<td align="left">multijunction_C</td>
<td align="right">102</td>
<td align="right">21</td>
</tr>
<tr class="odd">
<td align="left">multijunction_C</td>
<td align="right">96</td>
<td align="right">15</td>
</tr>
</tbody>
</table>
<p>Below a plot of strenght by thickness:</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="DOE.html#cb172-1" aria-hidden="true" tabindex="-1"></a>solarcell_fill <span class="sc">%&gt;%</span></span>
<span id="cb172-2"><a href="DOE.html#cb172-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fillfactor, <span class="at">y =</span> output)) <span class="sc">+</span></span>
<span id="cb172-3"><a href="DOE.html#cb172-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb172-4"><a href="DOE.html#cb172-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb172-5"><a href="DOE.html#cb172-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_industRial</span>() <span class="sc">+</span></span>
<span id="cb172-6"><a href="DOE.html#cb172-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb172-7"><a href="DOE.html#cb172-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;The solarcell output test&quot;</span>,</span>
<span id="cb172-8"><a href="DOE.html#cb172-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Output vs Fill Factor&quot;</span>,</span>
<span id="cb172-9"><a href="DOE.html#cb172-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Fill factor [%]&quot;</span>,</span>
<span id="cb172-10"><a href="DOE.html#cb172-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Output&quot;</span></span>
<span id="cb172-11"><a href="DOE.html#cb172-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="7_anova_files/figure-html/unnamed-chunk-33-1.png" width="100%" /></p>
</div>
<div id="cor.test" class="section level3">
<h3>Correlation test</h3>
<p>And a short test to assess the strenght of the correlation:</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="DOE.html#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stats)</span></code></pre></div>
<p><span id="corTest"></span></p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="DOE.html#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(solarcell_fill<span class="sc">$</span>output, solarcell_fill<span class="sc">$</span>fillfactor)</span></code></pre></div>
<pre><code>
    Pearson&#39;s product-moment correlation

data:  solarcell_fill$output and solarcell_fill$fillfactor
t = 9.8, df = 13, p-value = 2.3e-07
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.82100 0.97976
sample estimates:
    cor 
0.93854 </code></pre>
<p>Going further and using the approach from <span class="citation">(<a href="#ref-Broc2016" role="doc-biblioref">Broc 2016</a>)</span> I’m faceting the scatterplots to assess if the coefficient of the linear regression is similar for all the levels of the machine factor:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="DOE.html#cb176-1" aria-hidden="true" tabindex="-1"></a>solarcell_fill <span class="sc">%&gt;%</span></span>
<span id="cb176-2"><a href="DOE.html#cb176-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fillfactor, <span class="at">y =</span> output)) <span class="sc">+</span></span>
<span id="cb176-3"><a href="DOE.html#cb176-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb176-4"><a href="DOE.html#cb176-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb176-5"><a href="DOE.html#cb176-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(material)) <span class="sc">+</span></span>
<span id="cb176-6"><a href="DOE.html#cb176-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_industRial</span>() <span class="sc">+</span></span>
<span id="cb176-7"><a href="DOE.html#cb176-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb176-8"><a href="DOE.html#cb176-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;The solarcell output test&quot;</span>,</span>
<span id="cb176-9"><a href="DOE.html#cb176-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Output vs Fill Factor, by material type&quot;</span>,</span>
<span id="cb176-10"><a href="DOE.html#cb176-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Fill factor [%]&quot;</span>,</span>
<span id="cb176-11"><a href="DOE.html#cb176-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Output&quot;</span></span>
<span id="cb176-12"><a href="DOE.html#cb176-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="7_anova_files/figure-html/unnamed-chunk-36-1.png" width="100%" /></p>
<p>Visually this is the case, going from one level to the other is not changing the relationship between thickness and strenght - increasing thickness increases stenght. Visually the slopes are similar but the number of points is small. In a real case this verification could be extended with the correlation test for each level or/and a statistical test between slopes.</p>
<p>We’re now reproducing in R the ancova case study from the book, still using the aov function.
The way to feed the R function arguments is obtained from <a href="https://www.datanovia.com/en/lessons/ancova-in-r/" class="uri">https://www.datanovia.com/en/lessons/ancova-in-r/</a></p>
<p><em>Three different machines produce a monofilament fiber for a textile company. The process engineer is interested in determining if there is a difference in the breaking strength of the fiber produced by the three machines. However, the strength of a fiber is related to its diameter, with thicker fibers being generally stronger than thinner ones. A random sample of five fiber specimens is selected from each machine.</em></p>
</div>
<div id="ancova" class="section level3">
<h3>Ancova</h3>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="DOE.html#cb177-1" aria-hidden="true" tabindex="-1"></a>solarcell_ancova <span class="ot">&lt;-</span> <span class="fu">aov</span>(</span>
<span id="cb177-2"><a href="DOE.html#cb177-2" aria-hidden="true" tabindex="-1"></a>  output <span class="sc">~</span> fillfactor  <span class="sc">+</span> material, solarcell_fill</span>
<span id="cb177-3"><a href="DOE.html#cb177-3" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb177-4"><a href="DOE.html#cb177-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(solarcell_ancova)</span></code></pre></div>
<pre><code>            Df Sum Sq Mean Sq F value Pr(&gt;F)    
fillfactor   1   2746    2746  119.93  3e-07 ***
material     2    120      60    2.61   0.12    
Residuals   11    252      23                   
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<blockquote>
<p>Note that in the formula the covariate goes first (and there is no interaction)! If you do not do this in order, you will get different results.</p>
</blockquote>
<ul>
<li>material in this table corresponds to the adjusted material mean square</li>
</ul>
<p>Conclusions from the book in page 662:</p>
<p><em>Comparing the adjusted treatment means with the unadjusted treatment means (the y i. ), we note that the adjusted means are much closer together, another indication that the covariance analysis was necessary.</em></p>
<p><em>A basic assumption in the analysis of covariance is that the treatments do not influence the covariate x because the technique removes the effect of variations in the x i. . However, if the variability in the x i. is due in part to the treatments, then analysis of covariance removes part of the treatment effect. Thus, we must be reasonably sure that the treatments do not affect the values x ij.</em></p>
<p><em>In some experiments this may be obvious from the nature of the covariate, whereas in others it may be more doubtful. In our example, there may be a difference in fiber diameter (x ij ) between the three machines. In such cases, Cochran and Cox (1957) suggest that an analysis of variance on the x ij values may be helpful in determining the validity of this assumption. …there is no reason to believe that machines produce fibers of different diameters.</em></p>
<p>(I did not go further here as it goes beyond the scope of the assessment)</p>
<p>Comparison with anova</p>
<p>Below the common approach we’ve been using in design of experiments.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="DOE.html#cb179-1" aria-hidden="true" tabindex="-1"></a>solarcell_aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(output <span class="sc">~</span> material, solarcell_fill)</span>
<span id="cb179-2"><a href="DOE.html#cb179-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(solarcell_aov)</span></code></pre></div>
<pre><code>            Df Sum Sq Mean Sq F value Pr(&gt;F)  
material     2   1264     632    4.09  0.044 *
Residuals   12   1854     155                 
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The anova table obtained also corresponds correctly to the book example.</p>
<p>Montgomery final observations:</p>
<p><em>It is interesting to note what would have happened in this experiment if an analysis of covariance had not been performed, that is, if the breaking strength data (y) had been analyzed as a completely randomized single-factor experiment in which the covariate x was ignored. The analysis of variance of the breaking strength data is shown in Table 15.14. We immediately notice that the error estimate is much longer in the CRD analysis (17.17 versus 2.54). This is a reflection of the effectiveness of analysis of covariance in reducing error variability.</em></p>
<p><em>We would also conclude, based on the CRD analysis, that machines differ significantly in the strength of fiber produced. This is exactly opposite the conclusion reached by the covariance analysis.</em></p>
<p><em>If we suspected that the machines differed significantly in their effect on fiber strength, then we would try to equalize the strength output of the three machines. However, in this problem the machines do not differ in the strength of fiber produced after the linear effect of fiber diameter is removed. It would be helpful to reduce the within-machine fiber diameter variability because this would probably reduce the strength variability in the fiber.</em></p>
<p>Potential applications</p>
<p>In the scope of methods validations this approach could potentially be used in robustness validations when there is suspiction that a continuous variable is disturbing the measurement.</p>
<p>Naturally this should not be applied everywhere but only where there would to be logical a physical or chemical reason behind as in the example with thickness and strenght.</p>

</div>
</div>
<div id="general-designs" class="section level2">
<h2>General designs</h2>
<p>In a design of experiments we calculate the total number of trials with the expression <span class="math inline">\(n^m\)</span> where n is the number of levels, m the number of factors. A trial represents the number of unique combinations of the factors. To obtain the final number of test runs we have to multiply the number of trials by the number of replicates per trial.</p>
<p>In a design with 4 factors of 2 levels we have then <span class="math inline">\(2^4 = 16\)</span> runs and <span class="math inline">\(16 \times 5 = 80\)</span> replicates.</p>
<p>If the design has a combination of factors with different number of levels the number of trials is the multiplication of both such as: <span class="math inline">\(n^m \times n^m\)</span>.</p>
<p>For example if we added 2 additional factors with 4 levels each to the previous design we would obtain <span class="math inline">\(2^4 \times 4^2 = 256\)</span> which we would still need to multiply by the number of replicates to obtain the number of runs <span class="math inline">\(256 \times 5 = 1280\)</span>.</p>
<p>In the literature we often see the simbolic notation <span class="math inline">\(a^k\)</span> but we’ve opted for mF-nL (m factors, n levels) in this book for simplification.</p>
<p>m factors n levels designs</p>
<p><strong>The juice production plant</strong></p>
<p>We’re comming back to our Juice Bottling context where a quality team was looking to put in operation a new measurement device for dry matter content in a juices bottling line.</p>
<p>After a short brainstorming using the Ishikawa tool presented before the team has identified several potential influcing parameters on the equipment bias when compared with the reference equipement: the product itself, the drymatter level on the product (its target), the speed of the filling line and the poweder particle size. In order to evaluate such impact the team has prepared a mid size experiment design with three products, three levels of drymatter, two line speed levels and two particle size levels.</p>
<p>First we load the DoE.base package:</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="DOE.html#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DoE.base)</span></code></pre></div>
<p>and then generate the doe with the fac.design function.</p>
<div id="fac.design" class="section level3">
<h3>Factorial design</h3>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="DOE.html#cb182-1" aria-hidden="true" tabindex="-1"></a>juice_doe <span class="ot">&lt;-</span> <span class="fu">fac.design</span>(</span>
<span id="cb182-2"><a href="DOE.html#cb182-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">randomize =</span> <span class="cn">FALSE</span>,</span>
<span id="cb182-3"><a href="DOE.html#cb182-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">factor.names =</span> <span class="fu">list</span>(</span>
<span id="cb182-4"><a href="DOE.html#cb182-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">product =</span> <span class="fu">c</span>(<span class="st">&quot;beetroot&quot;</span>, <span class="st">&quot;apple&quot;</span>, <span class="st">&quot;carrot&quot;</span>), </span>
<span id="cb182-5"><a href="DOE.html#cb182-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">drymatter_target =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>),</span>
<span id="cb182-6"><a href="DOE.html#cb182-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">part =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb182-7"><a href="DOE.html#cb182-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">speed =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">25</span>),</span>
<span id="cb182-8"><a href="DOE.html#cb182-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">particle_size =</span> <span class="fu">c</span>(<span class="dv">250</span>, <span class="dv">300</span>))</span>
<span id="cb182-9"><a href="DOE.html#cb182-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Note that the DoE generated is more than just a tibble, it belongs to a specific class called design and has many other attributes just like an lm or aov S3 objects.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="DOE.html#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(juice_doe)</span></code></pre></div>
<pre><code>[1] &quot;design&quot;     &quot;data.frame&quot;</code></pre>
<p>The power and care given by the package authors become visible when we use an R generic function such as summary() with this object and we see it returns a tailor made output, in this case showing the levels of the different factors of our design:</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="DOE.html#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(juice_doe)</span></code></pre></div>
<pre><code>Call:
fac.design(randomize = FALSE, factor.names = list(product = c(&quot;beetroot&quot;, 
    &quot;apple&quot;, &quot;carrot&quot;), drymatter_target = c(10, 15, 20), part = c(1, 
    2, 3), speed = c(20, 25), particle_size = c(250, 300)))

Experimental design of type  full factorial 
108  runs

Factor settings (scale ends):
   product drymatter_target part speed particle_size
1 beetroot               10    1    20           250
2    apple               15    2    25           300
3   carrot               20    3                    </code></pre>
<p>Using this the team has simple copied the experiment plan to an spreadsheet to collect the data:</p>
<pre><code>juice_doe %&gt;% 
  write_clip() </code></pre>
<p>and after a few day the file completed and ready for analysis looked like:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="DOE.html#cb188-1" aria-hidden="true" tabindex="-1"></a>juice_drymatter <span class="sc">%&gt;%</span></span>
<span id="cb188-2"><a href="DOE.html#cb188-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span></span>
<span id="cb188-3"><a href="DOE.html#cb188-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">product</th>
<th align="right">drymatter_TGT</th>
<th align="right">speed</th>
<th align="right">particle_size</th>
<th align="right">part</th>
<th align="right">drymatter_DRX</th>
<th align="right">drymatter_REF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">apple</td>
<td align="right">10</td>
<td align="right">20</td>
<td align="right">250</td>
<td align="right">1</td>
<td align="right">9.80</td>
<td align="right">10.05</td>
</tr>
<tr class="even">
<td align="left">apple</td>
<td align="right">10</td>
<td align="right">20</td>
<td align="right">250</td>
<td align="right">2</td>
<td align="right">9.82</td>
<td align="right">10.05</td>
</tr>
<tr class="odd">
<td align="left">apple</td>
<td align="right">10</td>
<td align="right">20</td>
<td align="right">250</td>
<td align="right">3</td>
<td align="right">9.82</td>
<td align="right">10.05</td>
</tr>
<tr class="even">
<td align="left">beetroot</td>
<td align="right">10</td>
<td align="right">20</td>
<td align="right">250</td>
<td align="right">1</td>
<td align="right">9.79</td>
<td align="right">10.03</td>
</tr>
<tr class="odd">
<td align="left">beetroot</td>
<td align="right">10</td>
<td align="right">20</td>
<td align="right">250</td>
<td align="right">2</td>
<td align="right">9.75</td>
<td align="right">10.03</td>
</tr>
<tr class="even">
<td align="left">beetroot</td>
<td align="right">10</td>
<td align="right">20</td>
<td align="right">250</td>
<td align="right">3</td>
<td align="right">9.77</td>
<td align="right">10.03</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="DOE.html#cb189-1" aria-hidden="true" tabindex="-1"></a>juice_drymatter <span class="ot">&lt;-</span> juice_drymatter <span class="sc">%&gt;%</span></span>
<span id="cb189-2"><a href="DOE.html#cb189-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bias =</span> drymatter_DRX <span class="sc">-</span> drymatter_REF)</span></code></pre></div>
</div>
<div id="main_effects" class="section level3">
<h3>Main effects plots</h3>
<p>As the number of factors and levels of a design increase, more thinking is required to obtain good visualisation of the data.</p>
<p>Main effects plots consist usually of a scatterplot representing the experiment output as a function of one of the inputs. In a design like this with three different inputs three plots are required:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="DOE.html#cb190-1" aria-hidden="true" tabindex="-1"></a>drymatter_TGT_plot <span class="ot">&lt;-</span> juice_drymatter <span class="sc">%&gt;%</span></span>
<span id="cb190-2"><a href="DOE.html#cb190-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(drymatter_TGT) <span class="sc">%&gt;%</span></span>
<span id="cb190-3"><a href="DOE.html#cb190-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">bias_m_drymatter =</span> <span class="fu">mean</span>(bias)) <span class="sc">%&gt;%</span></span>
<span id="cb190-4"><a href="DOE.html#cb190-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> drymatter_TGT, <span class="at">y =</span> bias_m_drymatter)) <span class="sc">+</span></span>
<span id="cb190-5"><a href="DOE.html#cb190-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb190-6"><a href="DOE.html#cb190-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb190-7"><a href="DOE.html#cb190-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb190-8"><a href="DOE.html#cb190-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">21</span>),</span>
<span id="cb190-9"><a href="DOE.html#cb190-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>), <span class="at">expand =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb190-10"><a href="DOE.html#cb190-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb190-11"><a href="DOE.html#cb190-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Juice bottling problem&quot;</span>,</span>
<span id="cb190-12"><a href="DOE.html#cb190-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Main effects plots&quot;</span>,</span>
<span id="cb190-13"><a href="DOE.html#cb190-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;drymatter_TGT [%]&quot;</span>,</span>
<span id="cb190-14"><a href="DOE.html#cb190-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Average bias [g]&quot;</span></span>
<span id="cb190-15"><a href="DOE.html#cb190-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb190-16"><a href="DOE.html#cb190-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-17"><a href="DOE.html#cb190-17" aria-hidden="true" tabindex="-1"></a>particle_size_plot <span class="ot">&lt;-</span> juice_drymatter <span class="sc">%&gt;%</span>  </span>
<span id="cb190-18"><a href="DOE.html#cb190-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(particle_size) <span class="sc">%&gt;%</span></span>
<span id="cb190-19"><a href="DOE.html#cb190-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">particle_size_bias_mean =</span> <span class="fu">mean</span>(bias)) <span class="sc">%&gt;%</span></span>
<span id="cb190-20"><a href="DOE.html#cb190-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> particle_size, <span class="at">y =</span> particle_size_bias_mean)) <span class="sc">+</span></span>
<span id="cb190-21"><a href="DOE.html#cb190-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb190-22"><a href="DOE.html#cb190-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb190-23"><a href="DOE.html#cb190-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb190-24"><a href="DOE.html#cb190-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">240</span>,<span class="dv">310</span>), </span>
<span id="cb190-25"><a href="DOE.html#cb190-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>), <span class="at">expand =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb190-26"><a href="DOE.html#cb190-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb190-27"><a href="DOE.html#cb190-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;particle_size&quot;</span>,</span>
<span id="cb190-28"><a href="DOE.html#cb190-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Average bias [g]&quot;</span></span>
<span id="cb190-29"><a href="DOE.html#cb190-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb190-30"><a href="DOE.html#cb190-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-31"><a href="DOE.html#cb190-31" aria-hidden="true" tabindex="-1"></a>speed_plot <span class="ot">&lt;-</span> juice_drymatter <span class="sc">%&gt;%</span>  </span>
<span id="cb190-32"><a href="DOE.html#cb190-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(speed) <span class="sc">%&gt;%</span></span>
<span id="cb190-33"><a href="DOE.html#cb190-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">speed_bias_mean =</span> <span class="fu">mean</span>(bias)) <span class="sc">%&gt;%</span></span>
<span id="cb190-34"><a href="DOE.html#cb190-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> speed, <span class="at">y =</span> speed_bias_mean)) <span class="sc">+</span></span>
<span id="cb190-35"><a href="DOE.html#cb190-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb190-36"><a href="DOE.html#cb190-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb190-37"><a href="DOE.html#cb190-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb190-38"><a href="DOE.html#cb190-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">26</span>),</span>
<span id="cb190-39"><a href="DOE.html#cb190-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>), <span class="at">expand =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb190-40"><a href="DOE.html#cb190-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb190-41"><a href="DOE.html#cb190-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Speed&quot;</span>,</span>
<span id="cb190-42"><a href="DOE.html#cb190-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Average bias [g]&quot;</span></span>
<span id="cb190-43"><a href="DOE.html#cb190-43" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb190-44"><a href="DOE.html#cb190-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-45"><a href="DOE.html#cb190-45" aria-hidden="true" tabindex="-1"></a>drymatter_TGT_plot <span class="sc">+</span> particle_size_plot <span class="sc">+</span> speed_plot</span></code></pre></div>
<p><img src="8_generalDOEs_files/figure-html/unnamed-chunk-8-1.png" width="100%" /></p>
<p>This kind of plots gives already important insights in to the experiement outcome, even before any deeper analysis with a linear model and anova. In our case:</p>
<ul>
<li>higher particle_size and higher speed result in higher bias weight deviation</li>
<li>beyond 10.5% drymatter_TGT level the bias weight is always higher than the target</li>
</ul>
</div>
<div id="interaction_plot" class="section level3">
<h3>Interaction plots (custom)</h3>
<p>In designs like these with 3 factors we have 3 possible interactions (A-B, A-C, B-C) corresponding the the possible combination between them. This results in three interaction plots that we’re presenting below. The approach here goes beyond the interaction.plot function from the <code>{stats}</code> package presented previously in the two factors multiple levels case. We are developping here the plots with {ggplot2} which provides much more control on the plot attibutes but on the other hand requires that additional code is added to calculate the means by group.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="DOE.html#cb191-1" aria-hidden="true" tabindex="-1"></a>drymatter_TGT_particle_size_plot <span class="ot">&lt;-</span> juice_drymatter <span class="sc">%&gt;%</span>  </span>
<span id="cb191-2"><a href="DOE.html#cb191-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">particle_size =</span> <span class="fu">as_factor</span>(particle_size)) <span class="sc">%&gt;%</span></span>
<span id="cb191-3"><a href="DOE.html#cb191-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(drymatter_TGT, particle_size) <span class="sc">%&gt;%</span></span>
<span id="cb191-4"><a href="DOE.html#cb191-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">drymatter_bias_mean =</span> <span class="fu">mean</span>(bias), <span class="at">drymatter_bias_sd =</span> <span class="fu">sd</span>(bias)) <span class="sc">%&gt;%</span></span>
<span id="cb191-5"><a href="DOE.html#cb191-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> drymatter_TGT, <span class="at">y =</span> drymatter_bias_mean, <span class="at">color =</span> particle_size, <span class="at">linetype =</span> particle_size)) <span class="sc">+</span></span>
<span id="cb191-6"><a href="DOE.html#cb191-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">group =</span> particle_size), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb191-7"><a href="DOE.html#cb191-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> particle_size, <span class="at">linetype =</span> particle_size)) <span class="sc">+</span></span>
<span id="cb191-8"><a href="DOE.html#cb191-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype</span>(<span class="at">name =</span> <span class="st">&quot;Particle Size&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-9"><a href="DOE.html#cb191-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(</span>
<span id="cb191-10"><a href="DOE.html#cb191-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> drymatter_bias_mean <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> drymatter_bias_sd,</span>
<span id="cb191-11"><a href="DOE.html#cb191-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> drymatter_bias_mean <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> drymatter_bias_sd,</span>
<span id="cb191-12"><a href="DOE.html#cb191-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> .<span class="dv">5</span></span>
<span id="cb191-13"><a href="DOE.html#cb191-13" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb191-14"><a href="DOE.html#cb191-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype</span>(<span class="at">guide=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb191-15"><a href="DOE.html#cb191-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;C&quot;</span>, <span class="at">begin =</span> <span class="fl">0.3</span>, <span class="at">end =</span> <span class="fl">0.7</span>, <span class="at">name =</span> <span class="st">&quot;Particle size&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-16"><a href="DOE.html#cb191-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb191-17"><a href="DOE.html#cb191-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">21</span>),</span>
<span id="cb191-18"><a href="DOE.html#cb191-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>), <span class="at">expand =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb191-19"><a href="DOE.html#cb191-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">&quot;Error bars are +/- 2xSD&quot;</span>, </span>
<span id="cb191-20"><a href="DOE.html#cb191-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">colour =</span> <span class="st">&quot;grey30&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>, </span>
<span id="cb191-21"><a href="DOE.html#cb191-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">&quot;italic&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-22"><a href="DOE.html#cb191-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb191-23"><a href="DOE.html#cb191-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Juice bottling problem&quot;</span>,</span>
<span id="cb191-24"><a href="DOE.html#cb191-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Interaction plots&quot;</span>,</span>
<span id="cb191-25"><a href="DOE.html#cb191-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Drymatter target&quot;</span>,</span>
<span id="cb191-26"><a href="DOE.html#cb191-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Average bias deviation [g]&quot;</span></span>
<span id="cb191-27"><a href="DOE.html#cb191-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb191-28"><a href="DOE.html#cb191-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_industRial</span>() <span class="sc">+</span></span>
<span id="cb191-29"><a href="DOE.html#cb191-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.justification=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="at">legend.position=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb191-30"><a href="DOE.html#cb191-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-31"><a href="DOE.html#cb191-31" aria-hidden="true" tabindex="-1"></a>drymatter_TGT_speed_plot <span class="ot">&lt;-</span> juice_drymatter <span class="sc">%&gt;%</span>  </span>
<span id="cb191-32"><a href="DOE.html#cb191-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">speed =</span> <span class="fu">as_factor</span>(speed)) <span class="sc">%&gt;%</span></span>
<span id="cb191-33"><a href="DOE.html#cb191-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(drymatter_TGT, speed) <span class="sc">%&gt;%</span></span>
<span id="cb191-34"><a href="DOE.html#cb191-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">drymatter_bias_mean =</span> <span class="fu">mean</span>(bias), <span class="at">drymatter_bias_sd =</span> <span class="fu">sd</span>(bias)) <span class="sc">%&gt;%</span></span>
<span id="cb191-35"><a href="DOE.html#cb191-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> drymatter_TGT, <span class="at">y =</span> drymatter_bias_mean, <span class="at">color =</span> speed)) <span class="sc">+</span></span>
<span id="cb191-36"><a href="DOE.html#cb191-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">group =</span> speed), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb191-37"><a href="DOE.html#cb191-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> speed, <span class="at">linetype =</span> speed)) <span class="sc">+</span></span>
<span id="cb191-38"><a href="DOE.html#cb191-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype</span>(<span class="at">guide=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb191-39"><a href="DOE.html#cb191-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;C&quot;</span>, <span class="at">begin =</span> <span class="fl">0.3</span>, <span class="at">end =</span> <span class="fl">0.7</span>, <span class="at">name =</span> <span class="st">&quot;Speed&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-40"><a href="DOE.html#cb191-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(</span>
<span id="cb191-41"><a href="DOE.html#cb191-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> drymatter_bias_mean <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> drymatter_bias_sd,</span>
<span id="cb191-42"><a href="DOE.html#cb191-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> drymatter_bias_mean <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> drymatter_bias_sd,</span>
<span id="cb191-43"><a href="DOE.html#cb191-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> .<span class="dv">5</span></span>
<span id="cb191-44"><a href="DOE.html#cb191-44" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb191-45"><a href="DOE.html#cb191-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb191-46"><a href="DOE.html#cb191-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">21</span>),</span>
<span id="cb191-47"><a href="DOE.html#cb191-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>), <span class="at">expand =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb191-48"><a href="DOE.html#cb191-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">&quot;Error bars are +/- 2xSD&quot;</span>, </span>
<span id="cb191-49"><a href="DOE.html#cb191-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">colour =</span> <span class="st">&quot;grey30&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>, </span>
<span id="cb191-50"><a href="DOE.html#cb191-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">&quot;italic&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-51"><a href="DOE.html#cb191-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb191-52"><a href="DOE.html#cb191-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Dry matter target&quot;</span>,</span>
<span id="cb191-53"><a href="DOE.html#cb191-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Average bias deviation [g]&quot;</span></span>
<span id="cb191-54"><a href="DOE.html#cb191-54" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb191-55"><a href="DOE.html#cb191-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_industRial</span>() <span class="sc">+</span></span>
<span id="cb191-56"><a href="DOE.html#cb191-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.justification=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="at">legend.position=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb191-57"><a href="DOE.html#cb191-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-58"><a href="DOE.html#cb191-58" aria-hidden="true" tabindex="-1"></a>speed_particle_size_plot <span class="ot">&lt;-</span> juice_drymatter <span class="sc">%&gt;%</span>  </span>
<span id="cb191-59"><a href="DOE.html#cb191-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">particle_size =</span> <span class="fu">as_factor</span>(particle_size)) <span class="sc">%&gt;%</span></span>
<span id="cb191-60"><a href="DOE.html#cb191-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(speed, particle_size) <span class="sc">%&gt;%</span></span>
<span id="cb191-61"><a href="DOE.html#cb191-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">drymatter_bias_mean =</span> <span class="fu">mean</span>(bias), <span class="at">drymatter_bias_sd =</span> <span class="fu">sd</span>(bias)) <span class="sc">%&gt;%</span></span>
<span id="cb191-62"><a href="DOE.html#cb191-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> speed, <span class="at">y =</span> drymatter_bias_mean, <span class="at">color =</span> particle_size)) <span class="sc">+</span></span>
<span id="cb191-63"><a href="DOE.html#cb191-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">group =</span> particle_size), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb191-64"><a href="DOE.html#cb191-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> particle_size, <span class="at">linetype =</span> particle_size)) <span class="sc">+</span></span>
<span id="cb191-65"><a href="DOE.html#cb191-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype</span>(<span class="at">guide=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb191-66"><a href="DOE.html#cb191-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;C&quot;</span>, <span class="at">begin =</span> <span class="fl">0.3</span>, <span class="at">end =</span> <span class="fl">0.7</span>, <span class="at">name =</span> <span class="st">&quot;Particle size&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-67"><a href="DOE.html#cb191-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(</span>
<span id="cb191-68"><a href="DOE.html#cb191-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> drymatter_bias_mean <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> drymatter_bias_sd,</span>
<span id="cb191-69"><a href="DOE.html#cb191-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> drymatter_bias_mean <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> drymatter_bias_sd,</span>
<span id="cb191-70"><a href="DOE.html#cb191-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> .<span class="dv">5</span></span>
<span id="cb191-71"><a href="DOE.html#cb191-71" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb191-72"><a href="DOE.html#cb191-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb191-73"><a href="DOE.html#cb191-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">26</span>),</span>
<span id="cb191-74"><a href="DOE.html#cb191-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>), <span class="at">expand =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb191-75"><a href="DOE.html#cb191-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">&quot;Error bars are +/- 2xSD&quot;</span>, </span>
<span id="cb191-76"><a href="DOE.html#cb191-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">colour =</span> <span class="st">&quot;grey30&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>, </span>
<span id="cb191-77"><a href="DOE.html#cb191-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">&quot;italic&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-78"><a href="DOE.html#cb191-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb191-79"><a href="DOE.html#cb191-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Speed&quot;</span>,</span>
<span id="cb191-80"><a href="DOE.html#cb191-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Average bias deviation [g]&quot;</span></span>
<span id="cb191-81"><a href="DOE.html#cb191-81" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb191-82"><a href="DOE.html#cb191-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_industRial</span>() <span class="sc">+</span></span>
<span id="cb191-83"><a href="DOE.html#cb191-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.justification=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="at">legend.position=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb191-84"><a href="DOE.html#cb191-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-85"><a href="DOE.html#cb191-85" aria-hidden="true" tabindex="-1"></a>drymatter_TGT_particle_size_plot <span class="sc">+</span> drymatter_TGT_speed_plot <span class="sc">+</span> speed_particle_size_plot</span></code></pre></div>
<p><img src="8_generalDOEs_files/figure-html/unnamed-chunk-9-1.png" width="100%" /></p>
<p>The plots indicate no interaction between the different factors as all lines do not intercept and are mostly parallel.</p>
<p>In most cases the anova would be performed first and only the plot for the significant interactions would be plotted, if any.</p>
</div>
<div id="anova_three" class="section level3">
<h3>Anova with 3rd level interactions</h3>
<p>The sources of variation for the Anova table for three-factor fixed effects model are: A, B, C, AB, AC, BC, ABC. To be noted that like in the two-factors we must have at least two parts (n&gt;2) to determine the sum of squares due to error if all possible interactions are to be included in the model.</p>
<p>We are now fully prepared for an assessment of the effect of the different factors with the anova. To reduce the amount of coding we’re inputing the model directly in the aov function:</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="DOE.html#cb192-1" aria-hidden="true" tabindex="-1"></a>juice_drymatter_aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(</span>
<span id="cb192-2"><a href="DOE.html#cb192-2" aria-hidden="true" tabindex="-1"></a>  bias <span class="sc">~</span> drymatter_TGT <span class="sc">*</span> speed <span class="sc">*</span> particle_size,</span>
<span id="cb192-3"><a href="DOE.html#cb192-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> juice_drymatter)</span>
<span id="cb192-4"><a href="DOE.html#cb192-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(juice_drymatter_aov)</span></code></pre></div>
<pre><code>                                   Df Sum Sq Mean Sq F value Pr(&gt;F)    
drymatter_TGT                       1  1.315   1.315  486.06 &lt;2e-16 ***
speed                               1  0.000   0.000    0.00   0.99    
particle_size                       1  0.624   0.624  230.70 &lt;2e-16 ***
drymatter_TGT:speed                 1  0.001   0.001    0.27   0.60    
drymatter_TGT:particle_size         1  0.003   0.003    1.04   0.31    
speed:particle_size                 1  0.003   0.003    1.19   0.28    
drymatter_TGT:speed:particle_size   1  0.004   0.004    1.44   0.23    
Residuals                         100  0.271   0.003                   
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The observations of the plots are confirmed and completed with statistical input: we see that the percentage of drymatter_TGT and the particle_size significantly affect the bias volume (p &lt; 0.05). The drymatter_TGT-particle_size interactions are non significative.</p>
<p>As expected the anova confirms strong influence of the dissolution level on the bias.</p>
<p>From the analysis all interactions could be removed from the model in order to establish a predictive model.</p>

</div>
</div>
<div id="two-level-designs" class="section level2">
<h2>Two level designs</h2>
<p>Coding factors</p>
<p>2 factors 2 levels</p>
<p>The <span class="math inline">\(2^{k}\)</span> designs are particularly useful in the early stages of experimental work when many factors are likely to be investigated. It provides the smallest number of runs with which k factors can be studied in a complete factorial design. Consequently, these designs are widely used in factor screening experiments.</p>
<p>The validity of the analysis depends on the following assumptions:</p>
<ul>
<li>the factors are fixed</li>
<li>the designs are completely randomized</li>
<li>the usual normality assumptions are satisfied</li>
<li>the response is approximately linear over the range of the factor levels chosen</li>
</ul>
<p>Analysis Procedure for a 2 k Design</p>
<ol style="list-style-type: decimal">
<li>Estimate factor effects</li>
<li>Form initial model (full model)</li>
</ol>
<ol style="list-style-type: lower-alpha">
<li>If the design is replicated, fit the full model</li>
<li>If there is no replication, form the model using a normal probability plot of the effects</li>
</ol>
<ol start="3" style="list-style-type: decimal">
<li>Perform statistical testing (Anova)</li>
<li>Refine model (remove non significant effects)</li>
<li>Analyze residuals</li>
<li>Interpret results</li>
</ol>
<p>DEF - Sparsity of effects principle: most systems are dominated by some of the main effects and low-order interactions, and most high-order interactions are negligible.</p>
<p>In this first Case Study dedicated to <span class="math inline">\(2^k\)</span> designs we’re going to explore the contrasts settings in the linear model functions.</p>
<p><strong>The PET clothing improvement plan</strong></p>
<p>In this case study factors have only 2 levels.</p>
<p>Below we start by preparing our dataset:</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="DOE.html#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DoE.base)</span></code></pre></div>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="DOE.html#cb195-1" aria-hidden="true" tabindex="-1"></a>pet_doe <span class="ot">&lt;-</span> <span class="fu">fac.design</span>(</span>
<span id="cb195-2"><a href="DOE.html#cb195-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">randomize =</span> <span class="cn">FALSE</span>,</span>
<span id="cb195-3"><a href="DOE.html#cb195-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">factor.names=</span><span class="fu">list</span>(<span class="at">A=</span><span class="fu">c</span>(<span class="st">&quot;-&quot;</span>,<span class="st">&quot;+&quot;</span>), </span>
<span id="cb195-4"><a href="DOE.html#cb195-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">B=</span><span class="fu">c</span>(<span class="st">&quot;-&quot;</span>,<span class="st">&quot;+&quot;</span>),</span>
<span id="cb195-5"><a href="DOE.html#cb195-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">replicate =</span> <span class="fu">c</span>(<span class="st">&quot;I&quot;</span>, <span class="st">&quot;II&quot;</span>, <span class="st">&quot;III&quot;</span>))</span>
<span id="cb195-6"><a href="DOE.html#cb195-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="DOE.html#cb196-1" aria-hidden="true" tabindex="-1"></a>tensile_strength <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">64.4</span>,<span class="fl">82.8</span>,<span class="fl">41.4</span>,<span class="fl">71.3</span>,<span class="fl">57.5</span>,<span class="fl">73.6</span>,<span class="fl">43.7</span>,<span class="fl">69.0</span>,<span class="fl">62.1</span>,<span class="fl">73.6</span>,<span class="fl">52.9</span>,<span class="fl">66.7</span>)</span>
<span id="cb196-2"><a href="DOE.html#cb196-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-3"><a href="DOE.html#cb196-3" aria-hidden="true" tabindex="-1"></a>pet_doe <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb196-4"><a href="DOE.html#cb196-4" aria-hidden="true" tabindex="-1"></a>  pet_doe,</span>
<span id="cb196-5"><a href="DOE.html#cb196-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tensile_strength&quot;</span> <span class="ot">=</span> tensile_strength,</span>
<span id="cb196-6"><a href="DOE.html#cb196-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div id="coding_levels" class="section level3">
<h3>Coding levels</h3>
<p>Factors as +/-</p>
<p>In this first model we’re using a design where the inputs levels have been defined as plus and minus, sometimes also called high and low. The actual naming is not important, what is critical is to ensure that those input parameters are coded as factors.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="DOE.html#cb197-1" aria-hidden="true" tabindex="-1"></a>pet_fct <span class="ot">&lt;-</span> pet_doe <span class="sc">%&gt;%</span></span>
<span id="cb197-2"><a href="DOE.html#cb197-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(A,B), as_factor))</span></code></pre></div>
<p>Another detail is to put the higher level as the reference otherwise we will get inverted signs in the lm output:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="DOE.html#cb198-1" aria-hidden="true" tabindex="-1"></a>pet_fct<span class="sc">$</span>A <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pet_fct<span class="sc">$</span>A, <span class="at">ref=</span><span class="st">&quot;+&quot;</span>)</span>
<span id="cb198-2"><a href="DOE.html#cb198-2" aria-hidden="true" tabindex="-1"></a>pet_fct<span class="sc">$</span>B <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pet_fct<span class="sc">$</span>B, <span class="at">ref=</span><span class="st">&quot;+&quot;</span>)</span></code></pre></div>
<p>and one final step is need which is the setup of the contrasts. As our design is ortogonal and we want the contrasts to add up to zero we have to indicate that on the factor so that the coefficients of the linear model are correctly calculated. The current definition of the contrasts is:</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="DOE.html#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(pet_fct<span class="sc">$</span>A)</span></code></pre></div>
<pre><code>  -
+ 0
- 1</code></pre>
<p>So we change this with:</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="DOE.html#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(pet_fct<span class="sc">$</span>A) <span class="ot">&lt;-</span> <span class="st">&quot;contr.sum&quot;</span></span>
<span id="cb201-2"><a href="DOE.html#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(pet_fct<span class="sc">$</span>B) <span class="ot">&lt;-</span> <span class="st">&quot;contr.sum&quot;</span></span>
<span id="cb201-3"><a href="DOE.html#cb201-3" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(pet_fct<span class="sc">$</span>A)</span></code></pre></div>
<pre><code>  [,1]
+    1
-   -1</code></pre>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="DOE.html#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(pet_fct<span class="sc">$</span>A)</span></code></pre></div>
<pre><code>  [,1]
+    1
-   -1</code></pre>
<p>Now we can run our linear model:</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="DOE.html#cb205-1" aria-hidden="true" tabindex="-1"></a>pet_ctr_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb205-2"><a href="DOE.html#cb205-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> tensile_strength <span class="sc">~</span> A <span class="sc">*</span> B, </span>
<span id="cb205-3"><a href="DOE.html#cb205-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> pet_fct</span>
<span id="cb205-4"><a href="DOE.html#cb205-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb205-5"><a href="DOE.html#cb205-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pet_ctr_lm)</span></code></pre></div>
<pre><code>
Call:
lm.default(formula = tensile_strength ~ A * B, data = pet_fct)

Residuals:
   Min     1Q Median     3Q    Max 
 -4.60  -3.07  -1.15   2.49   6.90 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    63.25       1.31   48.14  3.8e-11 ***
A1              9.58       1.31    7.29  8.4e-05 ***
B1             -5.75       1.31   -4.38   0.0024 ** 
A1:B1           1.92       1.31    1.46   0.1828    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 4.55 on 8 degrees of freedom
Multiple R-squared:  0.903, Adjusted R-squared:  0.867 
F-statistic: 24.8 on 3 and 8 DF,  p-value: 0.000209</code></pre>
<p>We can observe in the output that the p value of the effects is the same in the lm and in the the aov functions. This confirms that the contrasts have been correctly specified with contr.sum</p>
<p>Note that we’ve had to adjust the contrasts in the lm function with contr.sum which applies to cases where the sum of the contrasts is zero (the R default is contr.treatment which applies to cases where the levels are coded as 0 and 1).</p>
<p>and now going to apply a prediction:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="DOE.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(pet_ctr_lm, <span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="st">&quot;+&quot;</span>, <span class="at">B =</span> <span class="st">&quot;+&quot;</span>))</span></code></pre></div>
<pre><code> 1 
69 </code></pre>
<p>Factors as +/- 1</p>
<p>In this example we convert the levels to factors still using the +/-1 notation. This will also be helpfull to apply what are called the Yates tables.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="DOE.html#cb209-1" aria-hidden="true" tabindex="-1"></a>coded <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { <span class="fu">ifelse</span>(x <span class="sc">==</span> x[<span class="dv">1</span>], <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) }</span></code></pre></div>
<p>We again convert them to factors and put the upper level as the reference. Regarding the contrasts we show a simpler and more direct approach now by defining them directly in the lm() function.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="DOE.html#cb210-1" aria-hidden="true" tabindex="-1"></a>pet_fct <span class="ot">&lt;-</span> pet_fct <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">cA =</span> <span class="fu">coded</span>(A), <span class="at">cB =</span> <span class="fu">coded</span>(B))</span>
<span id="cb210-2"><a href="DOE.html#cb210-2" aria-hidden="true" tabindex="-1"></a>pet_fct2 <span class="ot">&lt;-</span> pet_fct <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(cA, cB), as_factor))</span>
<span id="cb210-3"><a href="DOE.html#cb210-3" aria-hidden="true" tabindex="-1"></a>pet_fct2<span class="sc">$</span>cA <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pet_fct2<span class="sc">$</span>cA, <span class="at">ref =</span> <span class="st">&quot;1&quot;</span>)</span>
<span id="cb210-4"><a href="DOE.html#cb210-4" aria-hidden="true" tabindex="-1"></a>pet_fct2<span class="sc">$</span>cB <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pet_fct2<span class="sc">$</span>cB, <span class="at">ref =</span> <span class="st">&quot;1&quot;</span>)</span>
<span id="cb210-5"><a href="DOE.html#cb210-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-6"><a href="DOE.html#cb210-6" aria-hidden="true" tabindex="-1"></a>pet_ctr2_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb210-7"><a href="DOE.html#cb210-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> tensile_strength <span class="sc">~</span> cA <span class="sc">*</span> cB, </span>
<span id="cb210-8"><a href="DOE.html#cb210-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> pet_fct2,</span>
<span id="cb210-9"><a href="DOE.html#cb210-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">contrasts =</span> <span class="fu">list</span>(<span class="at">cA =</span> <span class="st">&quot;contr.sum&quot;</span>, <span class="at">cB =</span> <span class="st">&quot;contr.sum&quot;</span>)</span>
<span id="cb210-10"><a href="DOE.html#cb210-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb210-11"><a href="DOE.html#cb210-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pet_ctr2_lm)</span></code></pre></div>
<pre><code>
Call:
lm.default(formula = tensile_strength ~ cA * cB, data = pet_fct2, 
    contrasts = list(cA = &quot;contr.sum&quot;, cB = &quot;contr.sum&quot;))

Residuals:
   Min     1Q Median     3Q    Max 
 -4.60  -3.07  -1.15   2.49   6.90 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    63.25       1.31   48.14  3.8e-11 ***
cA1             9.58       1.31    7.29  8.4e-05 ***
cB1            -5.75       1.31   -4.38   0.0024 ** 
cA1:cB1         1.92       1.31    1.46   0.1828    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 4.55 on 8 degrees of freedom
Multiple R-squared:  0.903, Adjusted R-squared:  0.867 
F-statistic: 24.8 on 3 and 8 DF,  p-value: 0.000209</code></pre>
<p>Note that a coefficient in a regression equation is the change in the response when the corresponding variable changes by +1. Special attention to the + and - needs to be taken with the R output.</p>
<p>As A or B changes from its low level to its high level, the coded variable changes by 1 − (−1) = +2, so the change in the response is twice the regression coefficient.</p>
<p>So the effects and interaction(s) from their minumum to their maximum correspond to twice the values in the “Estimate” column. These regression coefficients are often called effects and interactions, even though they differ from the definitions used in the designs themeselves.</p>
<p>Checking now with coded factors:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="DOE.html#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(pet_ctr2_lm, <span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">cA =</span> <span class="st">&quot;1&quot;</span>, <span class="at">cB =</span> <span class="st">&quot;1&quot;</span>))</span></code></pre></div>
<pre><code> 1 
69 </code></pre>
<p>Factors as +/- 1 numeric</p>
<p>In this example we’re going to code the levels with +1/-1 but we’re going use the numeric coding:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="DOE.html#cb214-1" aria-hidden="true" tabindex="-1"></a>pet_num <span class="ot">&lt;-</span> pet_fct <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">cA =</span> <span class="fu">coded</span>(A), <span class="at">cB =</span> <span class="fu">coded</span>(B))</span>
<span id="cb214-2"><a href="DOE.html#cb214-2" aria-hidden="true" tabindex="-1"></a>pet_num_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb214-3"><a href="DOE.html#cb214-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> tensile_strength <span class="sc">~</span> cA <span class="sc">*</span> cB, </span>
<span id="cb214-4"><a href="DOE.html#cb214-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> pet_num</span>
<span id="cb214-5"><a href="DOE.html#cb214-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb214-6"><a href="DOE.html#cb214-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pet_num_lm)</span></code></pre></div>
<pre><code>
Call:
lm.default(formula = tensile_strength ~ cA * cB, data = pet_num)

Residuals:
   Min     1Q Median     3Q    Max 
 -4.60  -3.07  -1.15   2.49   6.90 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    63.25       1.31   48.14  3.8e-11 ***
cA              9.58       1.31    7.29  8.4e-05 ***
cB             -5.75       1.31   -4.38   0.0024 ** 
cA:cB           1.92       1.31    1.46   0.1828    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 4.55 on 8 degrees of freedom
Multiple R-squared:  0.903, Adjusted R-squared:  0.867 
F-statistic: 24.8 on 3 and 8 DF,  p-value: 0.000209</code></pre>
<p>In this case we did not define any contrasts. Looking into the lm We can see we’ve obtained exactly the same outputs.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="DOE.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(pet_num_lm, <span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">cA =</span> <span class="dv">1</span>, <span class="at">cB =</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code> 1 
69 </code></pre>
<p>As the inputs are coded as numeric this behaves just like the first simple linear model we’ve seen in the Case Study on One Factor with Multiple levels. In particular when we feed the predictions function with numeric values.</p>
<p>This is very intuitive as it corresponds to the original units of the experiments (also called natural or engineering units). On the other hand coding the design variables provides another advange: generally, the engineering units are not directly comparable while coded variables are very effective for determining the relative size of factor effects.</p>
<p>We can see that these three ways of coding the variable levels lead to equivalent results both in lm and prediction. Our preference goes to use numeric values as it is more intuitive and allows for easier prediction between the fixed levels.</p>
<p>And now in order to better understand the coding of factors in this unit, we’re going to establish a simple regression plot of our data:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="DOE.html#cb218-1" aria-hidden="true" tabindex="-1"></a>pet_num <span class="sc">%&gt;%</span> </span>
<span id="cb218-2"><a href="DOE.html#cb218-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unclass</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb218-3"><a href="DOE.html#cb218-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb218-4"><a href="DOE.html#cb218-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cA =</span> <span class="fu">coded</span>(A), <span class="at">cB =</span> <span class="fu">coded</span>(B)) <span class="sc">%&gt;%</span></span>
<span id="cb218-5"><a href="DOE.html#cb218-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb218-6"><a href="DOE.html#cb218-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;cA&quot;</span>, <span class="st">&quot;cB&quot;</span>),</span>
<span id="cb218-7"><a href="DOE.html#cb218-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb218-8"><a href="DOE.html#cb218-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;level&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb218-9"><a href="DOE.html#cb218-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb218-10"><a href="DOE.html#cb218-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> level, <span class="at">y =</span> tensile_strength)) <span class="sc">+</span></span>
<span id="cb218-11"><a href="DOE.html#cb218-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> level, <span class="at">y =</span> tensile_strength), </span>
<span id="cb218-12"><a href="DOE.html#cb218-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">fullrange =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb218-13"><a href="DOE.html#cb218-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(variable))</span></code></pre></div>
<p><img src="9_twolevelDOEs_files/figure-html/unnamed-chunk-16-1.png" width="100%" /></p>
<p>Note that we had to extract the data from the S3 doe object, which we’ve done with using unclass() and then as_tibble()</p>
<p>The intercept passes at 27.5 as seen on the lm summary. We’re going now to put the B factor at its maximum and replot:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="DOE.html#cb219-1" aria-hidden="true" tabindex="-1"></a>pet_num <span class="sc">%&gt;%</span> </span>
<span id="cb219-2"><a href="DOE.html#cb219-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unclass</span>() <span class="sc">%&gt;%</span></span>
<span id="cb219-3"><a href="DOE.html#cb219-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb219-4"><a href="DOE.html#cb219-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cA =</span> <span class="fu">coded</span>(A), <span class="at">cB =</span> <span class="fu">coded</span>(B)) <span class="sc">%&gt;%</span></span>
<span id="cb219-5"><a href="DOE.html#cb219-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cB <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb219-6"><a href="DOE.html#cb219-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb219-7"><a href="DOE.html#cb219-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;cA&quot;</span>, <span class="st">&quot;cB&quot;</span>),</span>
<span id="cb219-8"><a href="DOE.html#cb219-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb219-9"><a href="DOE.html#cb219-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;level&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb219-10"><a href="DOE.html#cb219-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb219-11"><a href="DOE.html#cb219-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> level, <span class="at">y =</span> tensile_strength)) <span class="sc">+</span></span>
<span id="cb219-12"><a href="DOE.html#cb219-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> level, <span class="at">y =</span> tensile_strength), </span>
<span id="cb219-13"><a href="DOE.html#cb219-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">fullrange =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb219-14"><a href="DOE.html#cb219-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb219-15"><a href="DOE.html#cb219-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb219-16"><a href="DOE.html#cb219-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(variable))</span></code></pre></div>
<p><img src="9_twolevelDOEs_files/figure-html/unnamed-chunk-17-1.png" width="100%" /></p>
<p>As seen on the plot the output of our prediction is 69 corresponding the high level of A when B is at 1. To be precise we need to multiply all the coefficients by the levels of the factors as : 63.250 + 9.583x(+1) - 5.750x(+1) + 1.917</p>
</div>
<div id="plotMeans" class="section level3">
<h3>Interaction plots with SE</h3>
<p>Here we’re making a step further in the representation of interaction plots, we’re adding error bars to the means. There are many ways to do this and we’re providing a simple approach with the function plotMeans from the package RcmdrMisc.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="DOE.html#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RcmdrMisc)</span></code></pre></div>
<p>We select standard error as argument for the error.bars argument.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="DOE.html#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">bty =</span> <span class="st">&quot;l&quot;</span>)</span>
<span id="cb221-2"><a href="DOE.html#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMeans</span>(<span class="at">response =</span> pet_fct<span class="sc">$</span>tensile_strength,</span>
<span id="cb221-3"><a href="DOE.html#cb221-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">factor2 =</span> pet_fct<span class="sc">$</span>A,</span>
<span id="cb221-4"><a href="DOE.html#cb221-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">factor1 =</span> pet_fct<span class="sc">$</span>B,</span>
<span id="cb221-5"><a href="DOE.html#cb221-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">error.bars =</span> <span class="st">&quot;se&quot;</span>,</span>
<span id="cb221-6"><a href="DOE.html#cb221-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">xlab =</span> <span class="st">&quot;A - Reactant&quot;</span>,</span>
<span id="cb221-7"><a href="DOE.html#cb221-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.lab =</span> <span class="st">&quot;B - Catalist</span><span class="sc">\n</span><span class="st">(error bars +/-se)&quot;</span>,</span>
<span id="cb221-8"><a href="DOE.html#cb221-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylab =</span> <span class="st">&quot;Tensile Strenght&quot;</span>,</span>
<span id="cb221-9"><a href="DOE.html#cb221-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="dv">12</span>)[<span class="dv">4</span>],</span>
<span id="cb221-10"><a href="DOE.html#cb221-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.pos =</span> <span class="st">&quot;bottomright&quot;</span>,</span>
<span id="cb221-11"><a href="DOE.html#cb221-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">main =</span> <span class="st">&quot;The PET clothing improvement plan&quot;</span>)</span></code></pre></div>
<p><img src="9_twolevelDOEs_files/figure-html/unnamed-chunk-19-1.png" width="100%" /></p>
<p>3 factors 2 levels</p>
<p><strong>The lithium-ion battery charging time test</strong></p>
<p>A - temperature
B - previous cycles (within warranty)
C - voltage
response - charging time [h]</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="DOE.html#cb222-1" aria-hidden="true" tabindex="-1"></a>battery_charging <span class="sc">%&gt;%</span></span>
<span id="cb222-2"><a href="DOE.html#cb222-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span></span>
<span id="cb222-3"><a href="DOE.html#cb222-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">A</th>
<th align="right">B</th>
<th align="right">C</th>
<th align="right">D</th>
<th align="right">Replicate</th>
<th align="right">charging_time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">5.50</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">6.69</td>
</tr>
<tr class="odd">
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">6.33</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">6.42</td>
</tr>
<tr class="odd">
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">10.37</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">7.49</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="DOE.html#cb223-1" aria-hidden="true" tabindex="-1"></a>battery_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb223-2"><a href="DOE.html#cb223-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> charging_time <span class="sc">~</span> A <span class="sc">*</span> B <span class="sc">*</span> C, </span>
<span id="cb223-3"><a href="DOE.html#cb223-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> battery_charging</span>
<span id="cb223-4"><a href="DOE.html#cb223-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb223-5"><a href="DOE.html#cb223-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(battery_lm)</span></code></pre></div>
<pre><code>
Call:
lm.default(formula = charging_time ~ A * B * C, data = battery_charging)

Residuals:
   Min     1Q Median     3Q    Max 
-2.095 -1.002 -0.529  0.929  2.982 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   7.4116     0.2654   27.92  &lt; 2e-16 ***
A             0.3147     0.2654    1.19  0.24737    
B             0.0684     0.2654    0.26  0.79872    
C             1.0403     0.2654    3.92  0.00065 ***
A:B          -0.0872     0.2654   -0.33  0.74539    
A:C          -0.8091     0.2654   -3.05  0.00553 ** 
B:C           0.0259     0.2654    0.10  0.92296    
A:B:C         0.0328     0.2654    0.12  0.90264    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 1.5 on 24 degrees of freedom
Multiple R-squared:  0.522, Adjusted R-squared:  0.383 
F-statistic: 3.75 on 7 and 24 DF,  p-value: 0.00696</code></pre>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="DOE.html#cb225-1" aria-hidden="true" tabindex="-1"></a>battery_aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(battery_lm)</span>
<span id="cb225-2"><a href="DOE.html#cb225-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(battery_aov)</span></code></pre></div>
<pre><code>            Df Sum Sq Mean Sq F value  Pr(&gt;F)    
A            1    3.2     3.2    1.41 0.24737    
B            1    0.1     0.1    0.07 0.79872    
C            1   34.6    34.6   15.36 0.00065 ***
A:B          1    0.2     0.2    0.11 0.74539    
A:C          1   20.9    20.9    9.29 0.00553 ** 
B:C          1    0.0     0.0    0.01 0.92296    
A:B:C        1    0.0     0.0    0.02 0.90264    
Residuals   24   54.1     2.3                    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The main effects of Gap and Power are highly significant (both have very small P-values). The AC interaction is also highly significant; thus, there is a strong interaction between Gap and Power.</p>
</div>
<div id="adj_Rsquare" class="section level3">
<h3>Adjusted R-squared</h3>
<p>The ordinary R^2 is 0.9661 and it measures the proportion of total variability explained by the model. A potential problem with this statistic is that it always increases as factors are added to the model, even if these factors are not significant. The adjusted R^2 is obtained by dividing the Sums of Squares by the degrees of freedom, and is adjusted for the size of the model, that is the number of factors.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="DOE.html#cb227-1" aria-hidden="true" tabindex="-1"></a>battery_reduced_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb227-2"><a href="DOE.html#cb227-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> charging_time <span class="sc">~</span> A <span class="sc">+</span> C <span class="sc">+</span> A<span class="sc">:</span>C, </span>
<span id="cb227-3"><a href="DOE.html#cb227-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> battery_charging</span>
<span id="cb227-4"><a href="DOE.html#cb227-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb227-5"><a href="DOE.html#cb227-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(battery_reduced_lm)</span></code></pre></div>
<pre><code>
Call:
lm.default(formula = charging_time ~ A + C + A:C, data = battery_charging)

Residuals:
   Min     1Q Median     3Q    Max 
-2.146 -0.995 -0.458  0.865  2.905 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    7.412      0.247   30.04  &lt; 2e-16 ***
A              0.315      0.247    1.28  0.21266    
C              1.040      0.247    4.22  0.00023 ***
A:C           -0.809      0.247   -3.28  0.00279 ** 
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 1.4 on 28 degrees of freedom
Multiple R-squared:  0.519, Adjusted R-squared:  0.467 
F-statistic: 10.1 on 3 and 28 DF,  p-value: 0.000116</code></pre>
<p>Besides the base summary() function, R squared and adjusted R squared can also be easily retrieved with the glance function from the {broom} package. We’re extracting them here for the complete and for reduced model:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="DOE.html#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(battery_lm)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="sc">%&gt;%</span></span>
<span id="cb229-2"><a href="DOE.html#cb229-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">glance</span>(battery_reduced_lm)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], </span>
<span id="cb229-3"><a href="DOE.html#cb229-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">.id =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<pre><code># A tibble: 2 x 3
  model r.squared adj.r.squared
  &lt;chr&gt;     &lt;dbl&gt;         &lt;dbl&gt;
1 1         0.522         0.383
2 2         0.519         0.467</code></pre>
<p>Adjusted R² has improved. Removing the nonsignificant terms from the full model has produced a final model that is likely to function more effectively as a predictor of new data.</p>
</div>
<div id="coding_inputs" class="section level3">
<h3>Coding inputs</h3>
<p>Now that we have model often we will want to predict the response at a certainly specific level between the coded factor levels of <span class="math inline">\(\pm\)</span> 1.</p>
<p>To do that we need to convert that specific the natural value into a coded value. Lets calculate the coded value for the factor A (gap) of which the natural value is nA = 0.9, between the natural levels of nA = 0.8 and nA = 1.2. We choose to do this for a fixed level of C of 1, corresponding to its maximum of 325W.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="DOE.html#cb231-1" aria-hidden="true" tabindex="-1"></a>natural2coded <span class="ot">&lt;-</span> <span class="cf">function</span>(xA, lA, hA) {(xA <span class="sc">-</span> (lA <span class="sc">+</span> hA) <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">/</span> ((hA <span class="sc">-</span>  lA) <span class="sc">/</span> <span class="dv">2</span>)}</span></code></pre></div>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="DOE.html#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting natural value xA into coded value cA:</span></span>
<span id="cb232-2"><a href="DOE.html#cb232-2" aria-hidden="true" tabindex="-1"></a>lA <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb232-3"><a href="DOE.html#cb232-3" aria-hidden="true" tabindex="-1"></a>hA <span class="ot">&lt;-</span> <span class="fl">1.2</span></span>
<span id="cb232-4"><a href="DOE.html#cb232-4" aria-hidden="true" tabindex="-1"></a>xA <span class="ot">&lt;-</span> <span class="fl">0.9</span></span>
<span id="cb232-5"><a href="DOE.html#cb232-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-6"><a href="DOE.html#cb232-6" aria-hidden="true" tabindex="-1"></a>cA <span class="ot">&lt;-</span> <span class="fu">natural2coded</span>(xA, lA, hA)</span>
<span id="cb232-7"><a href="DOE.html#cb232-7" aria-hidden="true" tabindex="-1"></a>cA</span></code></pre></div>
<pre><code>[1] -0.5</code></pre>
<p>To be noted that the opposite conversion looks like:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="DOE.html#cb234-1" aria-hidden="true" tabindex="-1"></a>coded2natural <span class="ot">&lt;-</span> <span class="cf">function</span>(cA, lA, hA) {cA <span class="sc">*</span> ((hA <span class="sc">-</span> lA) <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">+</span> ((lA <span class="sc">+</span> hA)<span class="sc">/</span><span class="dv">2</span>)} </span></code></pre></div>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="DOE.html#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting back the coded value cA into its natural value xA</span></span>
<span id="cb235-2"><a href="DOE.html#cb235-2" aria-hidden="true" tabindex="-1"></a>lA <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb235-3"><a href="DOE.html#cb235-3" aria-hidden="true" tabindex="-1"></a>hA <span class="ot">&lt;-</span> <span class="fl">1.2</span></span>
<span id="cb235-4"><a href="DOE.html#cb235-4" aria-hidden="true" tabindex="-1"></a>cA <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.5</span></span>
<span id="cb235-5"><a href="DOE.html#cb235-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-6"><a href="DOE.html#cb235-6" aria-hidden="true" tabindex="-1"></a>nA <span class="ot">&lt;-</span> <span class="fu">coded2natural</span>(cA, lA, hA)</span>
<span id="cb235-7"><a href="DOE.html#cb235-7" aria-hidden="true" tabindex="-1"></a>nA</span></code></pre></div>
<pre><code>[1] 0.9</code></pre>
</div>
<div id="coded_prediction" class="section level3">
<h3>Coded prediction</h3>
<p>And now we can feed our linear model and make predictions:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="DOE.html#cb237-1" aria-hidden="true" tabindex="-1"></a>battery_new <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">A =</span> cA, <span class="at">C =</span> <span class="dv">1</span>)</span>
<span id="cb237-2"><a href="DOE.html#cb237-2" aria-hidden="true" tabindex="-1"></a>pA <span class="ot">&lt;-</span> <span class="fu">predict</span>(battery_reduced_lm, battery_new)</span>
<span id="cb237-3"><a href="DOE.html#cb237-3" aria-hidden="true" tabindex="-1"></a>pA</span></code></pre></div>
<pre><code>     1 
8.6991 </code></pre>
<p>We can visualize this outcome as follows:</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="DOE.html#cb239-1" aria-hidden="true" tabindex="-1"></a>battery_charging <span class="sc">%&gt;%</span></span>
<span id="cb239-2"><a href="DOE.html#cb239-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(C <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb239-3"><a href="DOE.html#cb239-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb239-4"><a href="DOE.html#cb239-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> A, <span class="at">y =</span> charging_time, <span class="at">color =</span> <span class="fu">as_factor</span>(C))) <span class="sc">+</span></span>
<span id="cb239-5"><a href="DOE.html#cb239-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> A, <span class="at">y =</span> charging_time), <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span></span>
<span id="cb239-6"><a href="DOE.html#cb239-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> cA, <span class="at">y =</span> pA)) <span class="sc">+</span></span>
<span id="cb239-7"><a href="DOE.html#cb239-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>) <span class="sc">+</span> </span>
<span id="cb239-8"><a href="DOE.html#cb239-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb239-9"><a href="DOE.html#cb239-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> ggtext<span class="sc">::</span><span class="fu">element_markdown</span>()) <span class="sc">+</span></span>
<span id="cb239-10"><a href="DOE.html#cb239-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb239-11"><a href="DOE.html#cb239-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;3^k factorial design&quot;</span>,</span>
<span id="cb239-12"><a href="DOE.html#cb239-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Prediction with reduced model&quot;</span>)</span></code></pre></div>
<p><img src="9_twolevelDOEs_files/figure-html/unnamed-chunk-30-1.png" width="100%" /></p>
<p>We are introducing here response surface plots which is yet another way to visualize the experiment outputs as a function of the inputs. We’re doing this with the persp() function from the {rsm} package which provides an extremely fast rendering, easy parametrization and a readable output. To be noted that this function is an extension of the base R persp() consisting from the R point of view in an S3 method for the lm class. This allows to simply provide directly the lm object to the function to obtain the response surface.</p>
</div>
<div id="persp" class="section level3">
<h3>Perspective plot</h3>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="DOE.html#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsm)</span></code></pre></div>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="DOE.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">persp</span>(</span>
<span id="cb241-2"><a href="DOE.html#cb241-2" aria-hidden="true" tabindex="-1"></a>  battery_reduced_lm, </span>
<span id="cb241-3"><a href="DOE.html#cb241-3" aria-hidden="true" tabindex="-1"></a>  A <span class="sc">~</span> C, </span>
<span id="cb241-4"><a href="DOE.html#cb241-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">bounds =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>), <span class="at">C =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)),</span>
<span id="cb241-5"><a href="DOE.html#cb241-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">viridis</span>(<span class="dv">12</span>)[<span class="dv">8</span>],</span>
<span id="cb241-6"><a href="DOE.html#cb241-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">theta =</span> <span class="sc">-</span><span class="dv">40</span>, <span class="at">phi =</span> <span class="dv">20</span>, <span class="at">r =</span> <span class="dv">5</span>,</span>
<span id="cb241-7"><a href="DOE.html#cb241-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">zlab =</span> <span class="st">&quot;Charging Time&quot;</span>,</span>
<span id="cb241-8"><a href="DOE.html#cb241-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Lithium-ion battery</span><span class="sc">\n</span><span class="st">charging time test&quot;</span></span>
<span id="cb241-9"><a href="DOE.html#cb241-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="9_twolevelDOEs_files/figure-html/unnamed-chunk-32-1.png" width="100%" /></p>
<p>Due to the interaction between factors A and C the surface is slightly bent. This is exactly what we observe in the interactions plots of which the one below corresponds to slicing the surface at the min and the max of Power:</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="DOE.html#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="fu">interaction.plot</span>(<span class="at">x.factor =</span> battery_charging<span class="sc">$</span>C, </span>
<span id="cb242-2"><a href="DOE.html#cb242-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">trace.factor =</span> battery_charging<span class="sc">$</span>A,</span>
<span id="cb242-3"><a href="DOE.html#cb242-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fun =</span> mean,</span>
<span id="cb242-4"><a href="DOE.html#cb242-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">response =</span> battery_charging<span class="sc">$</span>charging_time,</span>
<span id="cb242-5"><a href="DOE.html#cb242-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">legend =</span> <span class="cn">TRUE</span>,</span>
<span id="cb242-6"><a href="DOE.html#cb242-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xlab =</span> <span class="st">&quot;C&quot;</span>,</span>
<span id="cb242-7"><a href="DOE.html#cb242-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">trace.label =</span> <span class="st">&quot;A&quot;</span>,</span>
<span id="cb242-8"><a href="DOE.html#cb242-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb242-9"><a href="DOE.html#cb242-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">col =</span> <span class="fu">c</span>(<span class="fu">viridis</span>(<span class="dv">12</span>)[<span class="dv">10</span>], <span class="at">col =</span> <span class="fu">viridis</span>(<span class="dv">12</span>)[<span class="dv">6</span>]),</span>
<span id="cb242-10"><a href="DOE.html#cb242-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ylab =</span> <span class="st">&quot;Charging Time&quot;</span>,</span>
<span id="cb242-11"><a href="DOE.html#cb242-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">main =</span> <span class="st">&quot;Lithium-ion battery</span><span class="sc">\n</span><span class="st">charging time test&quot;</span>)</span></code></pre></div>
<p><img src="9_twolevelDOEs_files/figure-html/unnamed-chunk-33-1.png" width="100%" /></p>
<p>Just like in the surface plot we can see here in the interaction plot that the response of yield on gap is different depending on the level of power. When power is high it decreases and when power is low it increases. As a reminder this is what is called an interaction between these two factors.</p>
</div>
</div>
<div id="single-replicate-designs" class="section level2">
<h2>Single replicate designs</h2>
<p><strong>The lithium-ion battery charging time test (cont.)</strong></p>
<p>m factors 2 levels</p>
<p>Possible approaches:
- graphical methods–normal and half-normal probability plots; no formal tests;
- assume some high-order interactions are zero, and fit a model that excludes them; degrees of freedom go into error, so testing is possible (not recommended)</p>
<div class="marginnote">
<p><img src="img/electrical_car_bw.png" width="100%" /></p>
</div>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="DOE.html#cb243-1" aria-hidden="true" tabindex="-1"></a>battery_charging <span class="sc">%&gt;%</span></span>
<span id="cb243-2"><a href="DOE.html#cb243-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((Replicate <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb243-3"><a href="DOE.html#cb243-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code># A tibble: 6 x 6
      A     B     C     D Replicate charging_time
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
1    -1    -1    -1    -1         1          5.5 
2     1    -1    -1    -1         1          6.69
3    -1     1    -1    -1         1          6.33
4     1     1    -1    -1         1          6.42
5    -1    -1     1    -1         1         10.4 
6     1    -1     1    -1         1          7.49</code></pre>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="DOE.html#cb245-1" aria-hidden="true" tabindex="-1"></a>battery_lm3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb245-2"><a href="DOE.html#cb245-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> charging_time <span class="sc">~</span> A <span class="sc">*</span> B <span class="sc">*</span> C <span class="sc">*</span> D, </span>
<span id="cb245-3"><a href="DOE.html#cb245-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> battery_charging <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Replicate <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb245-4"><a href="DOE.html#cb245-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(battery_lm3)</span></code></pre></div>
<pre><code>
Call:
lm.default(formula = charging_time ~ A * B * C * D, data = battery_charging %&gt;% 
    filter(Replicate == 1))

Residuals:
ALL 16 residuals are 0: no residual degrees of freedom!

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)   7.7606         NA      NA       NA
A            -0.5081         NA      NA       NA
B             0.0369         NA      NA       NA
C             1.5306         NA      NA       NA
D             0.1556         NA      NA       NA
A:B          -0.1244         NA      NA       NA
A:C          -0.7681         NA      NA       NA
B:C          -0.0106         NA      NA       NA
A:D           0.1244         NA      NA       NA
B:D          -0.0556         NA      NA       NA
C:D           0.1606         NA      NA       NA
A:B:C         0.0281         NA      NA       NA
A:B:D         0.0856         NA      NA       NA
A:C:D         0.1844         NA      NA       NA
B:C:D         0.0369         NA      NA       NA
A:B:C:D      -0.0369         NA      NA       NA

Residual standard error: NaN on 0 degrees of freedom
Multiple R-squared:     1,  Adjusted R-squared:   NaN 
F-statistic:  NaN on 15 and 0 DF,  p-value: NA</code></pre>
<p>We can see that being a single replicate design no statistics have been calculated for the effects in the model. A recommended approach in this case is to look into the normal probability plot of the model effects.</p>
<p>Here we are going to prepare this plot with the function qqPlot() from the {car} package:</p>
<div id="qqPlot" class="section level3">
<h3>Effects normal plot</h3>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="DOE.html#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span></code></pre></div>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="DOE.html#cb248-1" aria-hidden="true" tabindex="-1"></a>battery_eff3 <span class="ot">&lt;-</span> battery_lm3<span class="sc">$</span>coefficients[<span class="dv">2</span><span class="sc">:</span><span class="dv">16</span>]</span>
<span id="cb248-2"><a href="DOE.html#cb248-2" aria-hidden="true" tabindex="-1"></a>battery_eff_names2 <span class="ot">&lt;-</span> <span class="fu">names</span>((battery_lm3<span class="sc">$</span>coefficients)[<span class="dv">2</span><span class="sc">:</span><span class="dv">16</span>])</span>
<span id="cb248-3"><a href="DOE.html#cb248-3" aria-hidden="true" tabindex="-1"></a>main_effects_plot <span class="ot">&lt;-</span> <span class="fu">qqPlot</span>(</span>
<span id="cb248-4"><a href="DOE.html#cb248-4" aria-hidden="true" tabindex="-1"></a>  battery_eff3, <span class="at">envelope =</span> <span class="fl">0.70</span>, </span>
<span id="cb248-5"><a href="DOE.html#cb248-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">list</span>(</span>
<span id="cb248-6"><a href="DOE.html#cb248-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;y&quot;</span>, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="fu">carPalette</span>()[<span class="dv">1</span>], <span class="at">location =</span> <span class="st">&quot;lr&quot;</span>), </span>
<span id="cb248-7"><a href="DOE.html#cb248-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid =</span> <span class="cn">FALSE</span>,</span>
<span id="cb248-8"><a href="DOE.html#cb248-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb248-9"><a href="DOE.html#cb248-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.lines =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb248-10"><a href="DOE.html#cb248-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Chemical vessel - Normal plot of effects 2&quot;</span></span>
<span id="cb248-11"><a href="DOE.html#cb248-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="9_twolevelDOEs_files/figure-html/unnamed-chunk-38-1.png" width="100%" /></p>
<p>In plot we can see that the effects that have the highest influence on the output are the effects A, C and D and their interactions. We can still confirm these observations with a calculation of the percentage contribution of each effect as follows:</p>
</div>
<div id="effects_contribution" class="section level3">
<h3>Effects contribution table</h3>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="DOE.html#cb249-1" aria-hidden="true" tabindex="-1"></a>battery_lm_tidy3 <span class="ot">&lt;-</span> battery_lm3 <span class="sc">%&gt;%</span></span>
<span id="cb249-2"><a href="DOE.html#cb249-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb249-3"><a href="DOE.html#cb249-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">&quot;(Intercept)&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb249-4"><a href="DOE.html#cb249-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb249-5"><a href="DOE.html#cb249-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">effect_estimate =</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> estimate,</span>
<span id="cb249-6"><a href="DOE.html#cb249-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">effect_estimate_sum =</span> <span class="fu">sum</span>(effect_estimate), </span>
<span id="cb249-7"><a href="DOE.html#cb249-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">effect_contribution_perc =</span> <span class="fu">abs</span>((effect_estimate<span class="sc">/</span>effect_estimate_sum)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb249-8"><a href="DOE.html#cb249-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(<span class="dv">2</span>)</span>
<span id="cb249-9"><a href="DOE.html#cb249-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb249-10"><a href="DOE.html#cb249-10" aria-hidden="true" tabindex="-1"></a>battery_lm_tidy3 <span class="sc">%&gt;%</span></span>
<span id="cb249-11"><a href="DOE.html#cb249-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, effect_estimate, effect_contribution_perc) <span class="sc">%&gt;%</span></span>
<span id="cb249-12"><a href="DOE.html#cb249-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(effect_contribution_perc)) <span class="sc">%&gt;%</span></span>
<span id="cb249-13"><a href="DOE.html#cb249-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb249-14"><a href="DOE.html#cb249-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">effect_estimate</th>
<th align="right">effect_contribution_perc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">C</td>
<td align="right">-3.06125</td>
<td align="right">182.35</td>
</tr>
<tr class="even">
<td align="left">A:C</td>
<td align="right">1.53625</td>
<td align="right">91.51</td>
</tr>
<tr class="odd">
<td align="left">A</td>
<td align="right">1.01625</td>
<td align="right">60.54</td>
</tr>
<tr class="even">
<td align="left">A:C:D</td>
<td align="right">-0.36875</td>
<td align="right">21.97</td>
</tr>
<tr class="odd">
<td align="left">C:D</td>
<td align="right">-0.32125</td>
<td align="right">19.14</td>
</tr>
<tr class="even">
<td align="left">D</td>
<td align="right">-0.31125</td>
<td align="right">18.54</td>
</tr>
<tr class="odd">
<td align="left">A:B</td>
<td align="right">0.24875</td>
<td align="right">14.82</td>
</tr>
<tr class="even">
<td align="left">A:D</td>
<td align="right">-0.24875</td>
<td align="right">14.82</td>
</tr>
</tbody>
</table>
<p>Reduced model</p>
<p>Following the previous analysis we are removing the factor B from the model and keeping only the 2nd order interactions assuming the system also respects the sparcity of effects principle.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="DOE.html#cb250-1" aria-hidden="true" tabindex="-1"></a>battery_red_lm3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb250-2"><a href="DOE.html#cb250-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> charging_time <span class="sc">~</span> A <span class="sc">+</span> C <span class="sc">+</span> A<span class="sc">:</span>C, </span>
<span id="cb250-3"><a href="DOE.html#cb250-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> battery_charging)</span>
<span id="cb250-4"><a href="DOE.html#cb250-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(battery_red_lm3)</span></code></pre></div>
<pre><code>
Call:
lm.default(formula = charging_time ~ A + C + A:C, data = battery_charging)

Residuals:
   Min     1Q Median     3Q    Max 
-2.146 -0.995 -0.458  0.865  2.905 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    7.412      0.247   30.04  &lt; 2e-16 ***
A              0.315      0.247    1.28  0.21266    
C              1.040      0.247    4.22  0.00023 ***
A:C           -0.809      0.247   -3.28  0.00279 ** 
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 1.4 on 28 degrees of freedom
Multiple R-squared:  0.519, Adjusted R-squared:  0.467 
F-statistic: 10.1 on 3 and 28 DF,  p-value: 0.000116</code></pre>
<p>We can now see that we’ve regained degrees of freedom and obtained a sort of hidden replication allowing to calculate statistics and error terms on the model.</p>
<p>Residuals analysis</p>
<p>Checking the residuals we see the significant effect of the remaining interactions. The residuals are not completely normal but the in the standardized residuals the deviations are contained within 1.2 sd.</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="DOE.html#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb252-2"><a href="DOE.html#cb252-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(battery_red_lm3)</span></code></pre></div>
<p><img src="9_twolevelDOEs_files/figure-html/unnamed-chunk-41-1.png" width="100%" /></p>
<p>We can now establish the main effects and interaction plots and conclude on the optimal settings to maximize the output: A and D should be on the max and C on the min.</p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Broc2016" class="csl-entry">
Broc, Guillaume. 2016. <em>Stats Faciles Avec r</em>. 1th ed. deBoeck.
</div>
<div id="ref-minitab_anovaftest" class="csl-entry">
Minitab. 2016. <span>“Understanding Analysis of Variance (ANOVA) and the f-Test.”</span> <a href="https://blog.minitab.com/en/adventures-in-statistics-2/understanding-analysis-of-variance-anova-and-the-f-test">https://blog.minitab.com/en/adventures-in-statistics-2/understanding-analysis-of-variance-anova-and-the-f-test</a>.
</div>
<div id="ref-minitab_variances" class="csl-entry">
———. 2019a. <span>“Interpret the Key Results for 2 Variances.”</span> <a href="https://support.minitab.com/en-us/minitab/18/help-and-how-to/statistics/basic-statistics/how-to/2-variances/interpret-the-results/key-results/">https://support.minitab.com/en-us/minitab/18/help-and-how-to/statistics/basic-statistics/how-to/2-variances/interpret-the-results/key-results/</a>.
</div>
<div id="ref-Montgomery2012" class="csl-entry">
Montgomery, Douglas C. 2012. <em>Design and Analysis of Experiments</em>. 8th ed. Wiley.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="MSA.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="SPC.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
},
"search": false,
"info": false,
"toolbar": {
"position": "fixed"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
