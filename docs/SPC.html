<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Statistical Process Control | industRial data science</title>
  <meta name="description" content="Statistical Process Control | industRial data science" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Statistical Process Control | industRial data science" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/img/cover3.png" />
  
  <meta name="github-repo" content="J-Ramalho/industRialds" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Statistical Process Control | industRial data science" />
  
  
  <meta name="twitter:image" content="/img/cover3.png" />

<meta name="author" content="João Ramalho" />


<meta name="date" content="2021-06-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="DOE.html"/>
<link rel="next" href="contents.html"/>
<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-122820355-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-122820355-1');
</script>


<script type="text/javascript">
mattcrump=1;
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/industRialds.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">industRial</a></li>

<li class="divider"></li>
<li class="part"><span><b>I INTRODUCTION</b></span></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html"><i class="fa fa-check"></i>Toolbox</a>
<ul>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html#r-and-rstudio"><i class="fa fa-check"></i>R and RStudio</a></li>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html#packages"><i class="fa fa-check"></i>Packages</a>
<ul>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html#installation"><i class="fa fa-check"></i>Installation</a></li>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html#highlights"><i class="fa fa-check"></i>Highlights</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html#datasets"><i class="fa fa-check"></i>Datasets</a></li>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html#functions"><i class="fa fa-check"></i>Functions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tutorials.html"><a href="tutorials.html"><i class="fa fa-check"></i>Tutorials</a>
<ul>
<li class="chapter" data-level="" data-path="tutorials.html"><a href="tutorials.html#on-the-web"><i class="fa fa-check"></i>On the web</a></li>
<li class="chapter" data-level="" data-path="tutorials.html"><a href="tutorials.html#locally"><i class="fa fa-check"></i>Locally</a></li>
</ul></li>
<li class="part"><span><b>II CASE STUDIES</b></span></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html"><i class="fa fa-check"></i>Design for Six Sigma</a>
<ul>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#pareto-analysis"><i class="fa fa-check"></i>Pareto analysis</a>
<ul>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#collecting-defects"><i class="fa fa-check"></i>Collecting defects</a></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#paretochart"><i class="fa fa-check"></i>Pareto chart</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#root-cause-analysis"><i class="fa fa-check"></i>Root cause analysis</a>
<ul>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#brainstorming"><i class="fa fa-check"></i>Brainstorming</a></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#ishikawa"><i class="fa fa-check"></i>Ishikawa digram</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#correlations"><i class="fa fa-check"></i>Correlations</a>
<ul>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#matrix"><i class="fa fa-check"></i>Matrix</a></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#tileplot"><i class="fa fa-check"></i>Tileplot</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#clustering"><i class="fa fa-check"></i>Clustering</a>
<ul>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#clustering-algorithms"><i class="fa fa-check"></i>Clustering algorithms</a></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#network_plot"><i class="fa fa-check"></i>Network plot</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html"><i class="fa fa-check"></i>Measurement System Analysis</a>
<ul>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#calibration"><i class="fa fa-check"></i>Calibration</a>
<ul>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#bias_plot"><i class="fa fa-check"></i>Bias plot</a></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#bias_report"><i class="fa fa-check"></i>Bias report</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#precision"><i class="fa fa-check"></i>Precision</a>
<ul>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#gageRnR"><i class="fa fa-check"></i>Gage r&amp;R</a></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#gage_acceptance"><i class="fa fa-check"></i>Gage acceptance</a></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#gage-plots"><i class="fa fa-check"></i>Gage plots</a></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#negative-variance"><i class="fa fa-check"></i>Negative variance</a></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#custom-functions"><i class="fa fa-check"></i>Custom functions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#uncertainty"><i class="fa fa-check"></i>Uncertainty</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html"><i class="fa fa-check"></i>Design of Experiments</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#direct-comparisons"><i class="fa fa-check"></i>Direct comparisons</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#histogram"><i class="fa fa-check"></i>Histogram</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#t.test"><i class="fa fa-check"></i>t-test one sample</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#geom_qq"><i class="fa fa-check"></i>Normality plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#var.test"><i class="fa fa-check"></i>F-test</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#levene.test"><i class="fa fa-check"></i>Levene test</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#t-test-two-samples"><i class="fa fa-check"></i>t-test two samples</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#statistical-modeling"><i class="fa fa-check"></i>Statistical modeling</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#lm"><i class="fa fa-check"></i>Linear models</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#contr.treatment"><i class="fa fa-check"></i>Contrasts</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#predict"><i class="fa fa-check"></i>Predict</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#augment"><i class="fa fa-check"></i>Model augment</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#residuals_timeseries"><i class="fa fa-check"></i>Timeseries plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#autocorrelation"><i class="fa fa-check"></i>Autocorrelation test</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#normality-plot"><i class="fa fa-check"></i>Normality plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#shapiroTest"><i class="fa fa-check"></i>Normality test</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#residuals_fit"><i class="fa fa-check"></i>Residuals-Fit plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#std_residuals_fit"><i class="fa fa-check"></i>Standard Residuals-Fit plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#std_residuals_factors"><i class="fa fa-check"></i>Standard Residuals-Factor plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#homocedasticity"><i class="fa fa-check"></i>Homocedasticity</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#outliers"><i class="fa fa-check"></i>Outliers test</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#cooks"><i class="fa fa-check"></i>Cooks distance</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#R-squared"><i class="fa fa-check"></i>R-squared</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#effects-significance"><i class="fa fa-check"></i>Effects significance</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#aov"><i class="fa fa-check"></i>Anova</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#tukey"><i class="fa fa-check"></i>Pairwise comparison</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#fisherLSD"><i class="fa fa-check"></i>Least significant difference</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#interactions"><i class="fa fa-check"></i>Interactions</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#formula"><i class="fa fa-check"></i>Model formulae</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#RSE"><i class="fa fa-check"></i>Residuals standard error</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#plot.lm"><i class="fa fa-check"></i>Residuals summary</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#interaction.plot"><i class="fa fa-check"></i>Interaction plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#anova"><i class="fa fa-check"></i>Anova with interactions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#covariance"><i class="fa fa-check"></i>Covariance</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#cor.test"><i class="fa fa-check"></i>Correlation test</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#ancova_aov"><i class="fa fa-check"></i>Ancova</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#general-designs"><i class="fa fa-check"></i>General designs</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#fac.design"><i class="fa fa-check"></i>Factorial design</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#main_effects"><i class="fa fa-check"></i>Main effects plots</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#interaction_plot"><i class="fa fa-check"></i>Interaction plots (custom)</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#formula_expansion"><i class="fa fa-check"></i>Formula expansion</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#anova_three"><i class="fa fa-check"></i>Anova with 3rd level interactions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#two-level-designs"><i class="fa fa-check"></i>Two level designs</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#factorial-design-2-levels"><i class="fa fa-check"></i>Factorial design 2 levels</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#coding_levels"><i class="fa fa-check"></i>Coding levels</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#plotMeans"><i class="fa fa-check"></i>Interaction plots with SE</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#adj_Rsquare"><i class="fa fa-check"></i>Adjusted R-squared</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#coding_inputs"><i class="fa fa-check"></i>Coding inputs</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#coded_prediction"><i class="fa fa-check"></i>Coded prediction</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#persp"><i class="fa fa-check"></i>Perspective plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#single_replicate"><i class="fa fa-check"></i>Single replicate</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#qqPlot"><i class="fa fa-check"></i>Effects normal plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#effects_contribution"><i class="fa fa-check"></i>Effects contribution table</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#reduced-model"><i class="fa fa-check"></i>Reduced model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html"><i class="fa fa-check"></i>Statistical Process Control</a>
<ul>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#xbar-r-charts"><i class="fa fa-check"></i>xbar-R charts</a>
<ul>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#xbar_chart"><i class="fa fa-check"></i>Mean chart</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#Rchart"><i class="fa fa-check"></i>Range chart</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#limits.xbar"><i class="fa fa-check"></i>Warning limits</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#cpk-charts"><i class="fa fa-check"></i>Cpk charts</a>
<ul>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#off_spec"><i class="fa fa-check"></i>Off spec</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#process_Cpk"><i class="fa fa-check"></i>Process Capability</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#sigma_table"><i class="fa fa-check"></i>Sigma conversion table</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#process.capability"><i class="fa fa-check"></i>Capability chart</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#i-mr-charts"><i class="fa fa-check"></i>I-MR charts</a>
<ul>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#process_stats"><i class="fa fa-check"></i>Process statistics</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#chart_I"><i class="fa fa-check"></i>Individual chart</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#chart_IMR"><i class="fa fa-check"></i>Moving range chart</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#chart_Cpk"><i class="fa fa-check"></i>Capability chart (custom)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III APPENDIX</b></span></li>
<li class="chapter" data-level="" data-path="contents.html"><a href="contents.html"><i class="fa fa-check"></i>Index</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html"><i class="fa fa-check"></i>Glossary</a>
<ul>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#statistics"><i class="fa fa-check"></i>Statistics</a>
<ul>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#notation-conventions"><i class="fa fa-check"></i>Notation conventions</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#descriptive-statistics"><i class="fa fa-check"></i>Descriptive statistics</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#probability"><i class="fa fa-check"></i>Probability</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#statistical-inference"><i class="fa fa-check"></i>Statistical Inference</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#linear-models"><i class="fa fa-check"></i>Linear models</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#dfss"><i class="fa fa-check"></i>DFSS</a>
<ul>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#voice-of-customer"><i class="fa fa-check"></i>Voice of Customer</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#voice-of-process"><i class="fa fa-check"></i>Voice of Process</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#msa"><i class="fa fa-check"></i>MSA</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#doe"><i class="fa fa-check"></i>DOE</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#spc"><i class="fa fa-check"></i>SPC</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="" data-path="imprint.html"><a href="imprint.html"><i class="fa fa-check"></i>Imprint</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">indust<b style='color:#38598CFF'>R</b>ial data science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="SPC" class="section level1">
<h1>Statistical Process Control</h1>
<p>Keeping the variability of an industrial process under control is one of the most important objectives in manufacturing. Based on expert knowledge or on detailed functional analysis the product and process parameters that are critical to quality are identified and selected for close follow-up. The most common and effective way for such follow-up is the Statistical Process Control which is done by using control charts.</p>
<div class="marginnote">
<p><b class="highlight">Case study: Syringe injection molding</b></p>
<p>Pharmaceutical plastic injection is always a large scale manufacturing process with high speeds and tight specifications. Significant investments in clean rooms, fast automation and skilled operators require a commitment to the long term quality and a culture of excellence.</p>
<p><img src="img/syringe_molding_bw.jpg" width="100%" /></p>
</div>
<div id="xbar-r-charts" class="section level2">
<h2>xbar-R charts</h2>
<p>There are many types of control charts and in this case study we’re demonstrating the xbar and R charts. These two charts are often used together and are suited to the control the mean and the variability of a continuous variable. This case study draws on examples from <span class="citation"><a href="#ref-Bass2007" role="doc-biblioref">Bass</a> (<a href="#ref-Bass2007" role="doc-biblioref">2007</a>)</span> and from the <code>{qcc}</code> package vignette.</p>
<p>PH-parts is a <b class="highligh">plastic injection company</b> specialized in high precision pharmaceutical Parts. In their catalog they have a mid-range product that sells in extremely high volumes: vaccination syringes. The inner diameter of the barrel has been identified in failure mode analysis as a critical dimension for the security of the operation. Following the implementation of a statistical process control (SPC) the production operators monitor the production process using xbar and R-charts. The protocol requires 6 samples are taken on an hourly basis and diameters simply typed in an excel file in a laptop by the injection press. A recent excel file with samples taken over a period of 25 hours of production has been loaded in R with the name <code>syringe_diameter</code> by the Quality Assistant of the lab.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="SPC.html#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(syringe_diameter) <span class="sc">%&gt;%</span></span>
<span id="cb272-2"><a href="SPC.html#cb272-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Hour</th>
<th align="right">Sample1</th>
<th align="right">Sample2</th>
<th align="right">Sample3</th>
<th align="right">Sample4</th>
<th align="right">Sample5</th>
<th align="right">Sample6</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Hour1</td>
<td align="right">5.3314</td>
<td align="right">5.3399</td>
<td align="right">5.3244</td>
<td align="right">5.3363</td>
<td align="right">5.3228</td>
<td align="right">5.3181</td>
</tr>
<tr class="even">
<td align="left">Hour2</td>
<td align="right">5.3240</td>
<td align="right">5.3214</td>
<td align="right">5.3142</td>
<td align="right">5.3237</td>
<td align="right">5.3420</td>
<td align="right">5.3392</td>
</tr>
<tr class="odd">
<td align="left">Hour3</td>
<td align="right">5.3263</td>
<td align="right">5.3404</td>
<td align="right">5.3136</td>
<td align="right">5.3565</td>
<td align="right">5.3387</td>
<td align="right">5.3570</td>
</tr>
<tr class="even">
<td align="left">Hour4</td>
<td align="right">5.3553</td>
<td align="right">5.3600</td>
<td align="right">5.3171</td>
<td align="right">5.3319</td>
<td align="right">5.3446</td>
<td align="right">5.3474</td>
</tr>
<tr class="odd">
<td align="left">Hour5</td>
<td align="right">5.3379</td>
<td align="right">5.3264</td>
<td align="right">5.3150</td>
<td align="right">5.3134</td>
<td align="right">5.3375</td>
<td align="right">5.3407</td>
</tr>
<tr class="even">
<td align="left">Hour6</td>
<td align="right">5.3432</td>
<td align="right">5.3352</td>
<td align="right">5.3238</td>
<td align="right">5.3463</td>
<td align="right">5.3340</td>
<td align="right">5.3205</td>
</tr>
</tbody>
</table>
<p>In this table each line corresponds to a sampling hour and each column corresponds to a sample number. We’re now going to pass this data to the control chart plotting function <code>qcc()</code> from the package with the same name. We choose to copy the dataset to a new one to remove the Hour column with the select function from tidyverse and we take the opportunity to round the values:</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="SPC.html#cb273-1" aria-hidden="true" tabindex="-1"></a>syringe_clean <span class="ot">&lt;-</span> syringe_diameter <span class="sc">%&gt;%</span> </span>
<span id="cb273-2"><a href="SPC.html#cb273-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Hour) <span class="sc">%&gt;%</span></span>
<span id="cb273-3"><a href="SPC.html#cb273-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;S&quot;</span>), round, <span class="dv">2</span>))</span></code></pre></div>
<p>In order to establish a control chart it is recommended to run a “calibration run.” The calibration run is used to calculate the control limits before entering “regular production.” Using the first 10 samples we call the qcc() function to make the required calculations.</p>
<div id="xbar_chart" class="section level3">
<h3>Mean chart</h3>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="SPC.html#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(qcc)</span></code></pre></div>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="SPC.html#cb275-1" aria-hidden="true" tabindex="-1"></a>syringe_xbar <span class="ot">&lt;-</span> <span class="fu">qcc</span>(</span>
<span id="cb275-2"><a href="SPC.html#cb275-2" aria-hidden="true" tabindex="-1"></a>  syringe_clean[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, ], </span>
<span id="cb275-3"><a href="SPC.html#cb275-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;xbar&quot;</span>, </span>
<span id="cb275-4"><a href="SPC.html#cb275-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">&quot;Syringe injection molding</span><span class="sc">\n</span><span class="st"> barrel diameter xbar chart (calibration)&quot;</span>, </span>
<span id="cb275-5"><a href="SPC.html#cb275-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Sample group&quot;</span>,</span>
<span id="cb275-6"><a href="SPC.html#cb275-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot =</span> <span class="cn">FALSE</span></span>
<span id="cb275-7"><a href="SPC.html#cb275-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>In the previous chink we’ve loaded the <code>{qcc}</code> package that has the required quality control tools and created a new variable data but before we plot the chart lets look a bit in detail in the calculations done in the background. A first step is to read the begining of the <code>qcc()</code> help file typing ?qcc in the console. It says "Create an object of class ‘qcc’ to perform statistical process control’ (in R technical terms function is a helper that generates an S3 R object). The key point here is that this means we can inspect the calculations separately from the plot itself. We can start by confirming the class and the type of the qcc object:</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="SPC.html#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(syringe_xbar)</span></code></pre></div>
<pre><code>[1] &quot;qcc&quot;</code></pre>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="SPC.html#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(syringe_xbar)</span></code></pre></div>
<pre><code>[1] &quot;list&quot;</code></pre>
<p>It is confirmed it is an object of class qcc with the type list. Looking into the structure of the list:</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="SPC.html#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(syringe_xbar)</span></code></pre></div>
<pre><code>List of 11
 $ call      : language qcc(data = syringe_clean[1:10, ], type = &quot;xbar&quot;, plot = FALSE, title = &quot;Syringe injection molding\n barrel diamet| __truncated__
 $ type      : chr &quot;xbar&quot;
 $ data.name : chr &quot;syringe_clean[1:10, ]&quot;
 $ data      : num [1:10, 1:6] 5.33 5.32 5.33 5.36 5.34 5.34 5.3 5.32 5.34 5.36 ...
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ Group  : chr [1:10] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
  .. ..$ Samples: chr [1:6] &quot;Sample1&quot; &quot;Sample2&quot; &quot;Sample3&quot; &quot;Sample4&quot; ...
 $ statistics: Named num [1:10] 5.33 5.33 5.34 5.34 5.33 ...
  ..- attr(*, &quot;names&quot;)= chr [1:10] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
 $ sizes     : int [1:10] 6 6 6 6 6 6 6 6 6 6
 $ center    : num 5.33
 $ std.dev   : num 0.0142
 $ nsigmas   : num 3
 $ limits    : num [1, 1:2] 5.32 5.35
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : chr &quot;&quot;
  .. ..$ : chr [1:2] &quot;LCL&quot; &quot;UCL&quot;
 $ violations:List of 2
  ..$ beyond.limits : int(0) 
  ..$ violating.runs: num(0) 
 - attr(*, &quot;class&quot;)= chr &quot;qcc&quot;</code></pre>
<p>The output is not easy to read but we present it here just to show that inside the list there are several tables with the statistical analysis required for our plot. If we want like to see for instance the standard deviation we can extract it separately:</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="SPC.html#cb282-1" aria-hidden="true" tabindex="-1"></a>syringe_xbar<span class="sc">$</span>std.dev</span></code></pre></div>
<pre><code>[1] 0.014207</code></pre>
<p>And if we want like to see a summary of all the data stored in the object we could apply the summary method:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="SPC.html#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(syringe_xbar)</span></code></pre></div>
<pre><code>
Call:
qcc(data = syringe_clean[1:10, ], type = &quot;xbar&quot;, plot = FALSE,     title = &quot;Syringe injection molding\n barrel diameter xbar chart (calibration)&quot;,     xlab = &quot;Sample group&quot;)

xbar chart for syringe_clean[1:10, ] 

Summary of group statistics:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 5.3250  5.3283  5.3333  5.3333  5.3375  5.3433 

Group sample size:  6
Number of groups:  10
Center of group statistics:  5.3333
Standard deviation:  0.014207 

Control limits:
    LCL    UCL
 5.3159 5.3507</code></pre>
<p>We are now ready to finally we can see this all together in a plot:</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="SPC.html#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(syringe_xbar)</span></code></pre></div>
<p><img src="10_spc_files/figure-html/unnamed-chunk-11-1.png" width="100%" /></p>
</div>
<div id="Rchart" class="section level3">
<h3>Range chart</h3>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="SPC.html#cb287-1" aria-hidden="true" tabindex="-1"></a>syringe_R <span class="ot">&lt;-</span> <span class="fu">qcc</span>(</span>
<span id="cb287-2"><a href="SPC.html#cb287-2" aria-hidden="true" tabindex="-1"></a>  syringe_clean[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, ], </span>
<span id="cb287-3"><a href="SPC.html#cb287-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;R&quot;</span>, </span>
<span id="cb287-4"><a href="SPC.html#cb287-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">&quot;Syringe injection molding</span><span class="sc">\n</span><span class="st"> barrel diameter R chart (calibration)&quot;</span>,</span>
<span id="cb287-5"><a href="SPC.html#cb287-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Sample group&quot;</span></span>
<span id="cb287-6"><a href="SPC.html#cb287-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="10_spc_files/figure-html/unnamed-chunk-12-1.png" width="100%" /></p>
<p>Using the same 10 first samples we also obtained the corresponding R chart. Now that the calibration data has been plotted we can consider that the control limits are defined. They can become fixed and reused in new plots for the future production runs. Samples from those future runs can then be assessed against this limits and the control chart rules can be verified (in this example the shewhart rules are used). We now add the remaining data points to our chart by specifying which lines we’re referring too in our dataframe in the ‘newdata’ argument:</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="SPC.html#cb288-1" aria-hidden="true" tabindex="-1"></a>syringe_xbar <span class="ot">&lt;-</span> <span class="fu">qcc</span>(</span>
<span id="cb288-2"><a href="SPC.html#cb288-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> syringe_clean[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, ],</span>
<span id="cb288-3"><a href="SPC.html#cb288-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> syringe_clean[<span class="dv">11</span><span class="sc">:</span><span class="dv">25</span>,],</span>
<span id="cb288-4"><a href="SPC.html#cb288-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;xbar&quot;</span>, </span>
<span id="cb288-5"><a href="SPC.html#cb288-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">&quot;Syringe injection molding</span><span class="sc">\n</span><span class="st"> barrel diameter xbar chart (calibration)&quot;</span>, </span>
<span id="cb288-6"><a href="SPC.html#cb288-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Sample group&quot;</span></span>
<span id="cb288-7"><a href="SPC.html#cb288-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="10_spc_files/figure-html/unnamed-chunk-13-1.png" width="100%" /></p>
<p>We can see that the data point corresponding to the average of the measurements of the sample group 17 is plotted in red because it is outside of the control limits. Now we plot the R chart to assess the variability:</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="SPC.html#cb289-1" aria-hidden="true" tabindex="-1"></a>syringe_R <span class="ot">&lt;-</span> <span class="fu">qcc</span>(</span>
<span id="cb289-2"><a href="SPC.html#cb289-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> syringe_clean[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, ],</span>
<span id="cb289-3"><a href="SPC.html#cb289-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> syringe_clean[<span class="dv">11</span><span class="sc">:</span><span class="dv">25</span>,], </span>
<span id="cb289-4"><a href="SPC.html#cb289-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;R&quot;</span>, </span>
<span id="cb289-5"><a href="SPC.html#cb289-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">&quot;Syringe injection molding</span><span class="sc">\n</span><span class="st"> barrel diameter R chart (calibration)&quot;</span>,</span>
<span id="cb289-6"><a href="SPC.html#cb289-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Sample group&quot;</span></span>
<span id="cb289-7"><a href="SPC.html#cb289-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="10_spc_files/figure-html/unnamed-chunk-14-1.png" width="100%" /></p>
<p>In this case all the points are within the previously defined control limits. More tight controls can be put in place by clearly identifying warning limits in a narrower range than the control limits. These measures need to be accompanied by clear decision criteria and proper training to avoid the typical problem of overreacting and destabilizing the process by introducing unintended special causes of variation.</p>
</div>
<div id="limits.xbar" class="section level3">
<h3>Warning limits</h3>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="SPC.html#cb290-1" aria-hidden="true" tabindex="-1"></a>warn.limits <span class="ot">&lt;-</span> <span class="fu">limits.xbar</span>(</span>
<span id="cb290-2"><a href="SPC.html#cb290-2" aria-hidden="true" tabindex="-1"></a>  syringe_xbar<span class="sc">$</span>center, </span>
<span id="cb290-3"><a href="SPC.html#cb290-3" aria-hidden="true" tabindex="-1"></a>  syringe_xbar<span class="sc">$</span>std.dev, </span>
<span id="cb290-4"><a href="SPC.html#cb290-4" aria-hidden="true" tabindex="-1"></a>  syringe_xbar<span class="sc">$</span>sizes, </span>
<span id="cb290-5"><a href="SPC.html#cb290-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span></span>
<span id="cb290-6"><a href="SPC.html#cb290-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb290-7"><a href="SPC.html#cb290-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-8"><a href="SPC.html#cb290-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb290-9"><a href="SPC.html#cb290-9" aria-hidden="true" tabindex="-1"></a>  syringe_xbar, </span>
<span id="cb290-10"><a href="SPC.html#cb290-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">restore.par =</span> <span class="cn">FALSE</span>,</span>
<span id="cb290-11"><a href="SPC.html#cb290-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">&quot;Syringe injection molding</span><span class="sc">\n</span><span class="st"> barrel diameter xbar chart&quot;</span>,</span>
<span id="cb290-12"><a href="SPC.html#cb290-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Sample group&quot;</span>)</span>
<span id="cb290-13"><a href="SPC.html#cb290-13" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> warn.limits, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="fu">viridis</span>(<span class="dv">12</span>)[<span class="dv">1</span>])</span></code></pre></div>
<p><img src="10_spc_files/figure-html/unnamed-chunk-15-1.png" width="100%" /></p>
<p>The previous chunk exemplified how to add warning limits in the xbar chart and now we’re going to look into specifications. A manufacturing process under control has a variation that is lower than the product specifications and is ideally well centered. Therefore it is usually good practice to follow the control chart rules referring to the process control limits. In some cases Control Charts are even issued without the product specifications but in some cases there may an interest to add the specification limits. To to this we first we establish the specifications:</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="SPC.html#cb291-1" aria-hidden="true" tabindex="-1"></a>spec_max <span class="ot">&lt;-</span> <span class="fl">5.6</span></span>
<span id="cb291-2"><a href="SPC.html#cb291-2" aria-hidden="true" tabindex="-1"></a>spec_min <span class="ot">&lt;-</span> <span class="fl">5.3</span></span>
<span id="cb291-3"><a href="SPC.html#cb291-3" aria-hidden="true" tabindex="-1"></a>spec_tgt <span class="ot">&lt;-</span> (spec_max <span class="sc">-</span> spec_min) <span class="sc">/</span> <span class="dv">2</span> <span class="sc">+</span> spec_min</span>
<span id="cb291-4"><a href="SPC.html#cb291-4" aria-hidden="true" tabindex="-1"></a>specs <span class="ot">&lt;-</span> <span class="fu">c</span>(spec_min, spec_tgt, spec_max)</span></code></pre></div>
<p>and the plot again the control chart with visible specification limits and targets:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="SPC.html#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb292-2"><a href="SPC.html#cb292-2" aria-hidden="true" tabindex="-1"></a>  syringe_xbar,</span>
<span id="cb292-3"><a href="SPC.html#cb292-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">restore.par =</span> <span class="cn">FALSE</span>,</span>
<span id="cb292-4"><a href="SPC.html#cb292-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">&quot;Syringe injection molding</span><span class="sc">\n</span><span class="st"> barrel diameter xbar chart (calibration)&quot;</span>,</span>
<span id="cb292-5"><a href="SPC.html#cb292-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Sample group&quot;</span>,</span>
<span id="cb292-6"><a href="SPC.html#cb292-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylim =</span> <span class="fu">c</span>(specs[<span class="dv">1</span>], specs[<span class="dv">3</span>])</span>
<span id="cb292-7"><a href="SPC.html#cb292-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb292-8"><a href="SPC.html#cb292-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> specs, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="10_spc_files/figure-html/unnamed-chunk-17-1.png" width="100%" /></p>
<p>In our case study something has gone severely off track. The barrel diameter was considered under control but now when we added the specification limits we see a situation that sometime happens in practice and that requires action. The data plotted is still within the min max specification limits for this relatively small number of data points and the variation is overall well contained within the process limits but we see it is extremely off centered when compared with the product specification. A process capability study should help determining the causes for this off centering and help correcting it.</p>
</div>
</div>
<div id="cpk-charts" class="section level2">
<h2>Cpk charts</h2>
<p>In order to optimize the manufacturing process, the manufacturing engeering expert is going to assess the capability of the syringe injection diameter. Such details are not straight forward to modify. Should he request a change of some injection mold parts? Or play with process temperatures? Before moving to a process DOE he needs first to understand where he stands. We’re going to go more in depth in the study of the manufacturing process and make a comparison between the product specifications and the process variability. We’re looking for opportunities to tighten the product specifications. Tightening a product specification without increasing the cost of a manufacturing cost can be a very good source of competitive advantage. The way we are going to do this is by constructing an histogram and a density distribution of this process.</p>
<div id="off_spec" class="section level3">
<h3>Off spec</h3>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="SPC.html#cb293-1" aria-hidden="true" tabindex="-1"></a>off_spec <span class="ot">&lt;-</span> <span class="cf">function</span>(UCL, LCL, mean, sd) {</span>
<span id="cb293-2"><a href="SPC.html#cb293-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">-</span> ((stats<span class="sc">::</span><span class="fu">pnorm</span>(UCL, mean, sd) <span class="sc">-</span> stats<span class="sc">::</span><span class="fu">pnorm</span>(LCL, mean, sd))<span class="sc">*</span><span class="dv">100</span>), <span class="dv">2</span>)</span>
<span id="cb293-3"><a href="SPC.html#cb293-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>This simple function <code>off_spec()</code> provides a probabilistic calculation of the number of parts that can be out of certain specification limits provided a certain sample mean, standard deviation and specification limits. This function is included in our package <code>{industRial}</code> and can accessed any time with <code>industRial::off_spec</code>. Now as a first step we’re going to calculate process parameters such as mean and standard deviation that we will use with the function. For this we put the data in a long format.</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="SPC.html#cb294-1" aria-hidden="true" tabindex="-1"></a>syringe_long <span class="ot">&lt;-</span> syringe_diameter <span class="sc">%&gt;%</span></span>
<span id="cb294-2"><a href="SPC.html#cb294-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;Sample&quot;</span>),</span>
<span id="cb294-3"><a href="SPC.html#cb294-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;sample&quot;</span>,</span>
<span id="cb294-4"><a href="SPC.html#cb294-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb294-5"><a href="SPC.html#cb294-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-6"><a href="SPC.html#cb294-6" aria-hidden="true" tabindex="-1"></a>syringe_mean <span class="ot">=</span> syringe_long <span class="sc">%&gt;%</span> <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">mean</span>()</span>
<span id="cb294-7"><a href="SPC.html#cb294-7" aria-hidden="true" tabindex="-1"></a>syringe_sd <span class="ot">=</span> syringe_long <span class="sc">%&gt;%</span> <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">sd</span>()</span>
<span id="cb294-8"><a href="SPC.html#cb294-8" aria-hidden="true" tabindex="-1"></a>syringe_n <span class="ot">&lt;-</span> <span class="fu">length</span>(syringe_long)</span></code></pre></div>
<p>and obtain:</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="SPC.html#cb295-1" aria-hidden="true" tabindex="-1"></a>syringe_off_spec <span class="ot">&lt;-</span> <span class="fu">off_spec</span>(spec_max, spec_min, syringe_mean, syringe_sd)</span>
<span id="cb295-2"><a href="SPC.html#cb295-2" aria-hidden="true" tabindex="-1"></a>syringe_off_spec</span></code></pre></div>
<pre><code>[1] 1.59</code></pre>
<p>For our histogram we also want to obtain data for the density function. This can be calculated using the function <code>rnorm()</code> from the <code>{stats}</code> package using a reasonably high sample size. Here we use 100’000.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="SPC.html#cb297-1" aria-hidden="true" tabindex="-1"></a>theor_n <span class="ot">=</span> <span class="dv">1000000</span></span>
<span id="cb297-2"><a href="SPC.html#cb297-2" aria-hidden="true" tabindex="-1"></a>syringe_theor <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> theor_n, <span class="at">mean =</span> syringe_mean, <span class="at">sd =</span> syringe_sd) <span class="sc">%&gt;%</span> </span>
<span id="cb297-3"><a href="SPC.html#cb297-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<p>Now we prepare the legend of the chart using the variables created:</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="SPC.html#cb298-1" aria-hidden="true" tabindex="-1"></a>plot_subtitle <span class="ot">&lt;-</span> <span class="fu">paste</span>(</span>
<span id="cb298-2"><a href="SPC.html#cb298-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Spec: [&quot;</span>, spec_min, <span class="st">&quot;;&quot;</span>, spec_max, </span>
<span id="cb298-3"><a href="SPC.html#cb298-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;], Expected off-spec = &quot;</span>,</span>
<span id="cb298-4"><a href="SPC.html#cb298-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">signif</span>(syringe_off_spec, <span class="at">digits =</span> <span class="dv">2</span>), <span class="st">&quot;%&quot;</span></span>
<span id="cb298-5"><a href="SPC.html#cb298-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Note that we deliberately tweak the plot colors to make it look like the plots from minitab and from the <code>{qcc}</code> package. We provide this theme in the book companion package <code>industRial</code> with the name <code>theme_qcc()</code>.</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="SPC.html#cb299-1" aria-hidden="true" tabindex="-1"></a>syringe_long <span class="sc">%&gt;%</span></span>
<span id="cb299-2"><a href="SPC.html#cb299-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> ..density..)) <span class="sc">+</span></span>
<span id="cb299-3"><a href="SPC.html#cb299-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb299-4"><a href="SPC.html#cb299-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">bins =</span> <span class="dv">30</span>,</span>
<span id="cb299-5"><a href="SPC.html#cb299-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb299-6"><a href="SPC.html#cb299-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;grey20&quot;</span>) <span class="sc">+</span></span>
<span id="cb299-7"><a href="SPC.html#cb299-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">data =</span> syringe_theor, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb299-8"><a href="SPC.html#cb299-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> {spec_min}, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb299-9"><a href="SPC.html#cb299-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> {spec_max}, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb299-10"><a href="SPC.html#cb299-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> {spec_tgt}, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb299-11"><a href="SPC.html#cb299-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb299-12"><a href="SPC.html#cb299-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_qcc</span>() <span class="sc">+</span></span>
<span id="cb299-13"><a href="SPC.html#cb299-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb299-14"><a href="SPC.html#cb299-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Syringe barrel diameter Capability Study&quot;</span>, </span>
<span id="cb299-15"><a href="SPC.html#cb299-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> {plot_subtitle})</span></code></pre></div>
<p><img src="10_spc_files/figure-html/unnamed-chunk-23-1.png" width="100%" /></p>
<p>By looking at the histogram we confirm the extreme off centering of the production. We also see that although there are no measurements beyond the lower specification limit (LSL) in the small sample of 25 values collected initially but in a high volume production the defect rate is very high. Defect rates typical in this industry will be not in the percentage but in the range of the ppm (parts per million).</p>
</div>
<div id="process_Cpk" class="section level3">
<h3>Process Capability</h3>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="SPC.html#cb300-1" aria-hidden="true" tabindex="-1"></a>process_Cpk <span class="ot">&lt;-</span> <span class="cf">function</span>(UCL, LCL, mean, sd) {</span>
<span id="cb300-2"><a href="SPC.html#cb300-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pmin</span>(</span>
<span id="cb300-3"><a href="SPC.html#cb300-3" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">abs</span>(mean <span class="sc">-</span> <span class="fu">abs</span>(LCL)) <span class="sc">/</span> (<span class="dv">3</span> <span class="sc">*</span> sd)),</span>
<span id="cb300-4"><a href="SPC.html#cb300-4" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">abs</span>((<span class="fu">abs</span>(UCL) <span class="sc">-</span> mean)) <span class="sc">/</span> (<span class="dv">3</span> <span class="sc">*</span> sd))</span>
<span id="cb300-5"><a href="SPC.html#cb300-5" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb300-6"><a href="SPC.html#cb300-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The <code>process_Cpk()</code> is another function included in our package with which we can re-use the process variables calculated before to estimate the Cpk index:</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="SPC.html#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="fu">process_Cpk</span>(spec_max, spec_min, syringe_mean, syringe_sd)</span></code></pre></div>
<pre><code>[1] 0.71587</code></pre>
<p>The Quality Management department expects to see Capability Reports in ppm and not in percentage To make such conversion we have to multiply by 10’000. Note that we’re not considering the 1.5 shift that sometimes is presented in the literature but rather making a simple direct conversion of the proportion out of spec found before:</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="SPC.html#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="fu">formatC</span>(((syringe_off_spec) <span class="sc">*</span> <span class="dv">10000</span>), <span class="at">format =</span> <span class="st">&quot;d&quot;</span>, <span class="at">big.mark =</span> <span class="st">&quot;&#39;&quot;</span>)</span></code></pre></div>
<pre><code>[1] &quot;15&#39;900&quot;</code></pre>
<p>As mentioned the expected population below the LSL is 1,3% which is very high for industry standards. In fact this corresponds to 15’900 parts per million (ppm) whereas a common target would be 1 ppm. Naturally these figures are indicative and they depend of the context criteria such as severity of the problem, cost, difficulty to eliminate the problem and so on. We are here going to establish a simple reference table using the functions created before, to present the expected percentage that falls within certain limits. To make it useful as a reference table we’re putting this limits from <span class="math inline">\(\pm\)</span> 1 to <span class="math inline">\(\pm\)</span> 6 standard deviations</p>
</div>
<div id="sigma_table" class="section level3">
<h3>Sigma conversion table</h3>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="SPC.html#cb305-1" aria-hidden="true" tabindex="-1"></a>sigma_limits <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb305-2"><a href="SPC.html#cb305-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">sigma_plus =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb305-3"><a href="SPC.html#cb305-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sigma_minus =</span> <span class="sc">-</span>sigma_plus,</span>
<span id="cb305-4"><a href="SPC.html#cb305-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="dv">0</span>,</span>
<span id="cb305-5"><a href="SPC.html#cb305-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd =</span> <span class="dv">1</span></span>
<span id="cb305-6"><a href="SPC.html#cb305-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb305-7"><a href="SPC.html#cb305-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-8"><a href="SPC.html#cb305-8" aria-hidden="true" tabindex="-1"></a>sigma_limits <span class="sc">%&gt;%</span></span>
<span id="cb305-9"><a href="SPC.html#cb305-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb305-10"><a href="SPC.html#cb305-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">off_spec_perc =</span> <span class="fu">off_spec</span>(sigma_plus, sigma_minus, mean, sd),</span>
<span id="cb305-11"><a href="SPC.html#cb305-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">in_spec_perc =</span> <span class="dv">100</span> <span class="sc">-</span> off_spec_perc,</span>
<span id="cb305-12"><a href="SPC.html#cb305-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Cpk =</span> <span class="fu">process_Cpk</span>(sigma_plus, sigma_minus, mean, sd),</span>
<span id="cb305-13"><a href="SPC.html#cb305-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">ppm_defects =</span> <span class="fu">formatC</span>(</span>
<span id="cb305-14"><a href="SPC.html#cb305-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">off_spec</span>(sigma_plus, sigma_minus, mean, sd) <span class="sc">*</span> <span class="dv">10000</span>,</span>
<span id="cb305-15"><a href="SPC.html#cb305-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">format =</span> <span class="st">&quot;d&quot;</span>,</span>
<span id="cb305-16"><a href="SPC.html#cb305-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">big.mark =</span> <span class="st">&quot;&#39;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb305-17"><a href="SPC.html#cb305-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sigma_minus, sigma_plus, off_spec_perc, in_spec_perc, Cpk, ppm_defects) <span class="sc">%&gt;%</span></span>
<span id="cb305-18"><a href="SPC.html#cb305-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="center">sigma_minus</th>
<th align="center">sigma_plus</th>
<th align="center">off_spec_perc</th>
<th align="center">in_spec_perc</th>
<th align="center">Cpk</th>
<th align="center">ppm_defects</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">-1</td>
<td align="center">1</td>
<td align="center">31.73</td>
<td align="center">68.27</td>
<td align="center">0.333</td>
<td align="center">317’300</td>
</tr>
<tr class="even">
<td align="center">-2</td>
<td align="center">2</td>
<td align="center">4.55</td>
<td align="center">95.45</td>
<td align="center">0.667</td>
<td align="center">45’500</td>
</tr>
<tr class="odd">
<td align="center">-3</td>
<td align="center">3</td>
<td align="center">0.27</td>
<td align="center">99.73</td>
<td align="center">1.000</td>
<td align="center">2’700</td>
</tr>
<tr class="even">
<td align="center">-4</td>
<td align="center">4</td>
<td align="center">0.01</td>
<td align="center">99.99</td>
<td align="center">1.333</td>
<td align="center">100</td>
</tr>
<tr class="odd">
<td align="center">-5</td>
<td align="center">5</td>
<td align="center">0.00</td>
<td align="center">100.00</td>
<td align="center">1.667</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">-6</td>
<td align="center">6</td>
<td align="center">0.00</td>
<td align="center">100.00</td>
<td align="center">2.000</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
</div>
<div id="process.capability" class="section level3">
<h3>Capability chart</h3>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="SPC.html#cb306-1" aria-hidden="true" tabindex="-1"></a>syringe_cpk <span class="ot">&lt;-</span> <span class="fu">process.capability</span>(</span>
<span id="cb306-2"><a href="SPC.html#cb306-2" aria-hidden="true" tabindex="-1"></a>  syringe_xbar,</span>
<span id="cb306-3"><a href="SPC.html#cb306-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="dv">10</span>,</span>
<span id="cb306-4"><a href="SPC.html#cb306-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">spec.limits =</span> <span class="fu">c</span>(spec_min, spec_max),</span>
<span id="cb306-5"><a href="SPC.html#cb306-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">target =</span> spec_tgt,</span>
<span id="cb306-6"><a href="SPC.html#cb306-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb306-7"><a href="SPC.html#cb306-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">print =</span> <span class="cn">FALSE</span>,</span>
<span id="cb306-8"><a href="SPC.html#cb306-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">std.dev =</span> syringe_sd</span>
<span id="cb306-9"><a href="SPC.html#cb306-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="10_spc_files/figure-html/unnamed-chunk-29-1.png" width="100%" /></p>
<p>The previous plot shows how to obtain the capability chart and the different statistical variables in a quick and direct way with the <code>{qcc}</code> package. A fine tuning of the forecast of the number of expected parts out of specification can be done with the parameter <code>std.dev</code>. This input value will be used in the probability distribution function. Different approaches can be considered: calculating the standard deviation within each subgroup or the standard deviation of the entire population and also correcting the standard deviation dividing by n or by n - 1. In this example we re-use the standard deviation calculated on the entire set of datapoints as the group is small but for a case with more data it would be interesting to use the subgroups that tend to give smaller standard deviations.</p>
<p>The Quality Assistant has a much more clear idea where the process stands now. There’s a realignment of the process required of at least 0.1 mm. This may be at the limit of the process capability itself not to mention the uncertainty of measurement. Before over reacting he decides to look into the historical data and talk with the operators. Once it becomes clear this is a recurring pattern he will start looking into how to make such adjustment.</p>
</div>
</div>
<div id="i-mr-charts" class="section level2">
<h2>I-MR charts</h2>
<p>This final unit of the book requires prior knowledge in creating R functions and reading code from existing R functions. It develops the topic of the development of custom functions for summary statistics and timeseries plotting. These functions are available on the book companion package <code>{industRial}</code> for exploration and further development. They don’t pretend to be used as such for real life applications as for that we recommend the functions from the package <code>{qcc}</code> presented before. In previous cases we’re already presented how to modify functions from other packages and here the objective here is to explore the creation of new functions from scratch.</p>
<p>We’re not presenting here the complete code for each function but instead encourage it be checked with the R functionality for function exploration. In R programming books and forums we see often the recommendation to read R source code and we can only support it as an excellent way to develop our skill set.</p>
<p>Lets start with the simple function <code>off_spec()</code> that calculates the percentage of parts out of specification given the specification limits, the process mean and standard deviation. This function was presented in the previous case study and since it is loaded in memory we can read its content with the R function <code>body()</code>:</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="SPC.html#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(off_spec)</span></code></pre></div>
<pre><code>{
    round(100 - ((stats::pnorm(UCL, mean, sd) - stats::pnorm(LCL, 
        mean, sd)) * 100), 2)
}</code></pre>
<p>we can see that it uses simple functions from the package {<code>stats}</code>. We can also explicitly request to see the arguments it takes with <code>dput(formals())</code>:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="SPC.html#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dput</span>(<span class="fu">formals</span>(off_spec))</span></code></pre></div>
<pre><code>as.pairlist(alist(UCL = , LCL = , mean = , sd = ))</code></pre>
<p>and for a complete review we can open the function help page with:</p>
<pre><code>?off_spec</code></pre>
<p>Lets give some data and use the function:</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="SPC.html#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="fu">off_spec</span>(<span class="fl">0.981</span>, <span class="fl">0.819</span>, <span class="fl">0.943</span>, <span class="fl">0.019</span>)</span></code></pre></div>
<pre><code>[1] 2.28</code></pre>
<p>we get 2.28% parts out of spec. We’ll see this calculation in action in a moment.</p>
<div id="process_stats" class="section level3">
<h3>Process statistics</h3>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="SPC.html#cb314-1" aria-hidden="true" tabindex="-1"></a>tablet_weight <span class="ot">&lt;-</span> tablet_weight <span class="sc">%&gt;%</span></span>
<span id="cb314-2"><a href="SPC.html#cb314-2" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>(<span class="at">case =</span> <span class="st">&quot;snake&quot;</span>)</span>
<span id="cb314-3"><a href="SPC.html#cb314-3" aria-hidden="true" tabindex="-1"></a>tablet_weight <span class="sc">%&gt;%</span></span>
<span id="cb314-4"><a href="SPC.html#cb314-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb314-5"><a href="SPC.html#cb314-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">part_id</th>
<th align="right">weight_target_value</th>
<th align="right">weight_value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1001</td>
<td align="right">0.9</td>
<td align="right">0.84556</td>
</tr>
<tr class="even">
<td align="right">1002</td>
<td align="right">0.9</td>
<td align="right">0.91444</td>
</tr>
<tr class="odd">
<td align="right">1003</td>
<td align="right">0.9</td>
<td align="right">0.90111</td>
</tr>
</tbody>
</table>
<p>We’re now going to use the function <code>process_stats()</code> to calculate several statistical data for this dataset. This function returs a high number of outputs is large as we can see below:</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="SPC.html#cb315-1" aria-hidden="true" tabindex="-1"></a>weight_statistics_data <span class="ot">&lt;-</span> <span class="fu">process_stats</span>(tablet_weight, <span class="dv">10</span>)</span>
<span id="cb315-2"><a href="SPC.html#cb315-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(weight_statistics_data)</span></code></pre></div>
<pre><code> [1] &quot;part_id&quot;             &quot;weight_target_value&quot; &quot;weight_value&quot;       
 [4] &quot;part_spec_percent&quot;   &quot;spec_min&quot;            &quot;spec_max&quot;           
 [7] &quot;weight_mean&quot;         &quot;weight_sd&quot;           &quot;weight_out_perc&quot;    
[10] &quot;Cpk&quot;                 &quot;weight_MR&quot;           &quot;weight_MR_mean&quot;     
[13] &quot;MR_max&quot;              &quot;R_out_limits&quot;        &quot;I_LCL&quot;              
[16] &quot;I_UCL&quot;               &quot;weight_out_limits&quot;  </code></pre>
<p>Exploring the details on how the function calculates all the process statistics we have:</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="SPC.html#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(process_stats)</span></code></pre></div>
<pre><code>{
    process_data &lt;- data %&gt;% dplyr::filter(!is.na(.data$weight_value), 
        .data$weight_value &gt;= 0) %&gt;% dplyr::group_by(.data$weight_target_value) %&gt;% 
        dplyr::mutate(part_spec_percent = part_spec_percent, 
            spec_min = .data$weight_target_value - .data$weight_target_value * 
                part_spec_percent/100, spec_max = .data$weight_target_value + 
                .data$weight_target_value * part_spec_percent/100, 
            weight_mean = mean(.data$weight_value), weight_sd = stats::sd(.data$weight_value))
    process_data &lt;- process_data %&gt;% dplyr::mutate(weight_out_perc = industRial::off_spec(process_data$spec_max, 
        process_data$spec_min, process_data$weight_mean, process_data$weight_sd), 
        Cpk = industRial::process_Cpk(process_data$spec_max, 
            process_data$spec_min, process_data$weight_mean, 
            process_data$weight_sd), weight_MR = abs(.data$weight_value - 
            dplyr::lag(.data$weight_value)))
    process_data &lt;- process_data %&gt;% dplyr::mutate(weight_MR_mean = mean(process_data$weight_MR, 
        na.rm = TRUE))
    process_data &lt;- process_data %&gt;% dplyr::mutate(MR_max = 3.688 * 
        process_data$weight_MR_mean)
    process_data &lt;- process_data %&gt;% dplyr::mutate(R_out_limits = dplyr::if_else(condition = process_data$weight_MR &gt; 
        process_data$MR_max, process_data$weight_MR, NA_real_), 
        I_LCL = round((process_data$weight_mean - 2.66 * process_data$weight_MR_mean), 
            2), I_UCL = round((process_data$weight_mean + 2.66 * 
            process_data$weight_MR_mean), 2))
    process_data &lt;- process_data %&gt;% dplyr::mutate(weight_out_limits = dplyr::if_else(condition = (.data$weight_value &gt; 
        process_data$I_UCL | .data$weight_value &lt; process_data$I_LCL), 
        .data$weight_value, false = NA_real_))
}</code></pre>
<p>This being done we can now convert this data into an easy readable format for reporting of for a future integration in a shiny app for example. We’re exploring now the package <code>{gt}</code> that has a specific very neat look rather different from the <code>{kable}</code> package that has been the most used until now.</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="SPC.html#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="fu">process_stats_table</span>(weight_statistics_data)</span></code></pre></div>
<div id="jntxwastnm" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#jntxwastnm .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#jntxwastnm .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jntxwastnm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#jntxwastnm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#jntxwastnm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jntxwastnm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jntxwastnm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#jntxwastnm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#jntxwastnm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#jntxwastnm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#jntxwastnm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#jntxwastnm .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#jntxwastnm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#jntxwastnm .gt_from_md > :first-child {
  margin-top: 0;
}

#jntxwastnm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#jntxwastnm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#jntxwastnm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#jntxwastnm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jntxwastnm .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#jntxwastnm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jntxwastnm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#jntxwastnm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#jntxwastnm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jntxwastnm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jntxwastnm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#jntxwastnm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jntxwastnm .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#jntxwastnm .gt_left {
  text-align: left;
}

#jntxwastnm .gt_center {
  text-align: center;
}

#jntxwastnm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#jntxwastnm .gt_font_normal {
  font-weight: normal;
}

#jntxwastnm .gt_font_bold {
  font-weight: bold;
}

#jntxwastnm .gt_font_italic {
  font-style: italic;
}

#jntxwastnm .gt_super {
  font-size: 65%;
}

#jntxwastnm .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="3" class="gt_heading gt_title gt_font_normal gt_bottom_border" style>Process Summary Statistics</th>
    </tr>
    
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Variable</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Value</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Unit</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">Weight mean</td>
<td class="gt_row gt_right">0.94000</td>
<td class="gt_row gt_left">g</td></tr>
    <tr><td class="gt_row gt_left">Spec target</td>
<td class="gt_row gt_right">0.90000</td>
<td class="gt_row gt_left">g</td></tr>
    <tr><td class="gt_row gt_left">Spec min</td>
<td class="gt_row gt_right">0.81000</td>
<td class="gt_row gt_left">g</td></tr>
    <tr><td class="gt_row gt_left">Spec max</td>
<td class="gt_row gt_right">0.99000</td>
<td class="gt_row gt_left">g</td></tr>
    <tr><td class="gt_row gt_left" style="font-weight: bold;">Out of spec</td>
<td class="gt_row gt_right" style="font-weight: bold;">0.71000</td>
<td class="gt_row gt_left" style="font-weight: bold;">%</td></tr>
    <tr><td class="gt_row gt_left" style="font-weight: bold;">Cpk</td>
<td class="gt_row gt_right" style="font-weight: bold;">0.81785</td>
<td class="gt_row gt_left" style="font-weight: bold;"></td></tr>
    <tr><td class="gt_row gt_left">Sample size</td>
<td class="gt_row gt_right">137</td>
<td class="gt_row gt_left">parts</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<div id="chart_I" class="section level3">
<h3>Individual chart</h3>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="SPC.html#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chart_I</span>(weight_statistics_data)</span></code></pre></div>
<p><img src="10_spc_files/figure-html/unnamed-chunk-37-1.png" width="100%" /></p>
<p>Once the data set is available we’re feeding it into the chart_I() function. This is another function from the package that can be used as a starting point for explorations in SPC charts. It is built using <code>{ggplot2}</code> and another examples can be seen in the tutorials section.</p>
</div>
<div id="chart_IMR" class="section level3">
<h3>Moving range chart</h3>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="SPC.html#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chart_IMR</span>(weight_statistics_data)</span></code></pre></div>
<p><img src="10_spc_files/figure-html/unnamed-chunk-38-1.png" width="100%" /></p>
<p>The companion of the I chart is the MR chart, where MR stands for moving range.</p>
</div>
<div id="chart_Cpk" class="section level3">
<h3>Capability chart (custom)</h3>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="SPC.html#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chart_Cpk</span>(weight_statistics_data)</span></code></pre></div>
<p><img src="10_spc_files/figure-html/unnamed-chunk-39-1.png" width="100%" /></p>
<p>and this final chart presented a process capability histogram obtained with the function <code>chart_Cpk()</code>.</p>

</div>
</div>
</div>



<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Bass2007" class="csl-entry">
Bass, Issa. 2007. <em>Six Sigma Statistics with Excel and Minitab</em>. 1st ed. McGraw-Hill.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="DOE.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="contents.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
},
"search": false,
"info": false,
"toolbar": {
"position": "fixed"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
